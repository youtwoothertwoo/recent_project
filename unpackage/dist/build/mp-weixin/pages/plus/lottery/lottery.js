(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/plus/lottery/lottery"],{"16c5":function(t,e,n){"use strict";var i=n("1c8e"),o=n.n(i);o.a},"1c8e":function(t,e,n){},"420d":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={almostLottery:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/almost-lottery/components/almost-lottery/almost-lottery")]).then(n.bind(null,"1022"))}},o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.points_name()),i=t.points_name(),o=t.prizeList.length;t._isMounted||(t.e0=function(e){t.isRule=!0},t.e1=function(e){t.prizeIndex=-1},t.e2=function(e){t.isRule=!1}),t.$mp.data=Object.assign({},{$root:{m0:n,m1:i,g0:o}})},a=[]},b278:function(t,e,n){"use strict";n.r(e);var i=n("d03e"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},d03e:function(t,e,n){"use strict";(function(t){var i=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("7eb4")),a=i(n("af34")),s=i(n("ee10")),r={components:{AlmostLottery:function(){Promise.all([n.e("common/vendor"),n.e("uni_modules/almost-lottery/components/almost-lottery/almost-lottery")]).then(function(){return resolve(n("1022"))}.bind(null,n)).catch(n.oe)},popup:function(){n.e("components/uni-popup").then(function(){return resolve(n("f89c"))}.bind(null,n)).catch(n.oe)},uniLoadMore:function(){n.e("components/uni-load-more").then(function(){return resolve(n("7348"))}.bind(null,n)).catch(n.oe)}},data:function(){return{loading:!0,finish:!1,times:0,points:"",user_points:"",bg_image:"",content:"",prizeList:[],onStock:!0,prizeIndex:-1,result:{},listData:[],styleValue:"",index_num:0,lineHeight:0,maxSize:0,timer:null,isPopup:!1,isRecord:!1,recordList:[],list_rows:10,last_page:0,page:1,no_more:!1,isRule:!1}},computed:{loadingType:function(){return this.loading?1:0!=this.recordList.length&&this.no_more?2:0}},onShow:function(){this.isRecord=!1,this.restoreData(),this.handleInitCanvas()},methods:{init:function(){var e=this;this.listData.length>1&&t.getSystemInfo({success:function(t){e.lineHeight=t.windowWidth/750*60,e.maxSize=e.listData.length,e.timer=setInterval((function(){e.animation()}),3e3)}})},animation:function(){this.index_num++,this.index_num>=this.maxSize&&(this.index_num=0),this.styleValue=-this.lineHeight*this.index_num},getPrizeList:function(){var e=this;return(0,s.default)(o.default.mark((function n(){var i,a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.showLoading({title:"奖品准备中..."}),e.loading=!0,n.next=4,e.requestApiGetPrizeList();case 4:i=n.sent,i.ok?(a=i.data,a.length&&(e.prizeList=a)):(t.hideLoading(),t.showToast({title:"获取奖品失败"}));case 6:case"end":return n.stop()}}),n)})))()},requestApiGetPrizeList:function(){var t=this;return new Promise((function(e,n){t._post("plus.lottery.Lottery/getLottery",{},(function(n){t.loading=!1,t.bg_image=n.data.data.file_path,t.content=n.data.data.content,t.prizeList=n.data.data.prize,t.listData=n.data.recordList,t.listData.forEach((function(e,n){var i=t.GetDateDiff(e.create_time),o=e.user?e.user.nickName:"匿名用户";e.showText=i+o+"抽中了"+e.record_name})),t.times=n.data.nums,t.points=n.data.data.points,t.user_points=n.data.data.user_points,t.init(),e({ok:!0,data:t.prizeList})}))}))},GetDateDiff:function(t){var e=t,n=new Date(e.replace(/-/g,"/")),i=new Date,o=i.getTime()-n.getTime(),a=parseInt(o/864e5),s=o%864e5,r=parseInt(s/36e5),u=s%36e5,l=parseInt(u/6e4),c=u%6e4,d=parseInt(c/1e3),f="";return f=a>0?"".concat(a,"天前"):r>0?"".concat(r,"小时前"):l>0?"".concat(l,"分钟前"):"".concat(d,"秒前"),console.log(a),f},handleInitCanvas:function(){this.prizeList=[],this.getPrizeList()},handleDrawStart:function(){console.log("start");var t=this;!t.loading&&t.finish&&(t.times<=0?t.showError("次数不足"):(t.loading=!0,t._post("plus.lottery.Lottery/draw",{},(function(e){t.times--,t.loading=!1,t.result=e.data.result;for(var n=(0,a.default)(t.prizeList),i=e.data.result.prize_id,o=0;o<n.length;o++){var s=n[o];if(s.prize_id===i){t.prizeIndex=o;break}}console.log("本次抽中奖品 =>",t.prizeList[t.prizeIndex].name)}),(function(e){t.loading=!1}))))},hidePopup:function(){this.isPopup=!1},hideRecordPopup:function(){this.isRecord=!1},handleDrawEnd:function(){this.isPopup=!0,this.handleInitCanvas()},handleDrawFinish:function(t){this.finish=!0},restoreData:function(){this.recordList=[],this.page=1,this.no_more=!1,this.last_page=1},getList:function(){var t=this;t.loading=!0,t._post("plus.lottery.Lottery/record",{list_rows:t.list_rows,page:t.page||1},(function(e){t.loading=!1,t.recordList=t.recordList.concat(e.data.list.data),t.last_page=e.data.list.last_page,e.data.list.last_page<=1&&(t.no_more=!0)}))},getRecord:function(){this.restoreData(),this.getList(),this.isRecord=!0},scrolltolowerFunc:function(){if(this.page++,this.loading=!0,this.page>this.last_page)return this.loading=!1,void(this.no_more=!0);this.getList()}}};e.default=r}).call(this,n("df3c")["default"])},dbab:function(t,e,n){"use strict";n.r(e);var i=n("420d"),o=n("b278");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("16c5");var s=n("828b"),r=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=r.exports},dd75:function(t,e,n){"use strict";(function(t,e){var i=n("47a9");n("c163");i(n("3240"));var o=i(n("dbab"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])}},[["dd75","common/runtime","common/vendor"]]]);