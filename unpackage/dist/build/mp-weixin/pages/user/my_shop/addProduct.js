(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/my_shop/addProduct"],{"021e":function(e,t,i){"use strict";(function(e){var o=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(i("1727")),c=o(i("df56")),s={components:{Upload:n.default},data:function(){return{product_id:0,activeSpec:0,form:{product_name:"",image:[],video:{},video_id:0,poster:{},poster_id:0,selling_point:"",product_status:10,audit_status:0,category_id:0,is_virtual:0,product_sort:0,limit_num:0,virtual_auto:0,virtual_content:"",is_delivery_free:0,delivery_id:0,is_points_gift:0,is_points_discount:0,max_points_discount:"",is_agent:0,is_picture:1,contentImage:[],deduct_stock_type:10,spec_type:10,sku:{product_no:"",product_price:"",line_price:"",stock_num:"",product_weight:""},spec_many:{spec_attr:[],spec_list:[]}},delivery:[],deliveryIndex:-1,category:[],categoryIndex:-1,title:"",textType:"",showPop:!1,isContent:!1,isAdvanced:!1,isSpec:!1,specValue:"",specName:"",popValue:"",fileType:"",upload_type:"",isUpload:"",isVideo:!1,specValuesList:[],isMany:!1}},onLoad:function(e){this.product_id=e.product_id||0,this.getData()},methods:{deleteSpec:function(t){var i=this;e.showModal({title:"提示",content:"确认要删除吗?",success:function(e){e.confirm&&i.form.spec_many.spec_attr.splice(t,1)}})},deleteSpecValue:function(t,i){var o=this;e.showModal({title:"提示",content:"确认要删除吗?",success:function(e){e.confirm&&o.form.spec_many.spec_attr[t].spec_items.splice(i,1)}})},addApecValue:function(t){var i=this,o=this.specValuesList[t];o?i._post("supplier.Spec/addSpecValue",{spec_id:i.form.spec_many.spec_attr[t].group_id,spec_value:o},(function(e){i.form.spec_many.spec_attr[t].spec_items.push({item_id:e.data.spec_value_id,spec_value:o}),i.specValuesList[t]=""}),(function(e){i.specValuesList[t]=""})):e.showToast({title:"请输入规格值",icon:"none"})},addSpec:function(){this.isSpec=!0},getData:function(){var e=this,t="supplier.Product/add",i={};e.product_id&&(t="supplier.Product/edit",i.product_id=e.product_id),e._get(t,i,(function(t){var i=[],o=[];o=t.data.category,o.length>0&&o.forEach((function(e,t){i.push({name:e.name,category_id:e.category_id}),e.child&&e.child.length>0&&e.child.forEach((function(t,o){i.push({name:e.name+"—"+t.name,category_id:t.category_id})}))})),e.category=i,e.delivery=t.data.delivery,e.product_id&&(Object.assign(e.form,t.data.model),e.form.product_status=t.data.model.product_status.value,t.data.specData?e.$set(e.form,"spec_many",t.data.specData):(e.$set(e.form,"spec_many",{spec_attr:[],spec_list:[]}),e.form.sku=t.data.model.sku[0]),0==e.form.delivery_id?e.$set(e.form,"is_delivery_free",0):e.$set(e.form,"is_delivery_free",1),1==t.data.audit_setting.edit_audit&&e.product_id&&(e.form.audit_status=0),e.category.forEach((function(t,i){t.category_id!=e.form.category_id||(e.categoryIndex=i)})),e.delivery.forEach((function(t,i){t.delivery_id!=e.form.delivery_id||(e.deliveryIndex=i)})),console.log(e.deliveryIndex))}))},submitFunc:function(){var t=this.form;if(-1!=this.categoryIndex){t.category_id=this.category[this.categoryIndex].category_id;var i=c.default.validate(t);if(i){var o="supplier.Product/add",n={params:JSON.stringify(t)};this.product_id&&(o="supplier.Product/edit",n.product_id=this.product_id),this._post(o,n,(function(t){e.showModal({title:"提示",content:t.msg,success:function(){e.navigateBack()}})}))}console.log(i)}else e.showToast({title:"请选择商品分类",icon:"none"})},openTextarea:function(e,t){this.title=t,this.textType=e,this.popValue=this.form[e],this.showPop=!0},changeType:function(e,t){this[t+"Index"]=e.detail.value,this.form[t+"_id"]=this[t][this[t+"Index"]]},closeFunc:function(e){e&&(this.form[this.textType]=this.popValue),this.popValue="",this.title="",this.showPop=!1},closeSpec:function(t){var i=this;if(t){if(""===i.specName||""===i.specValue)return e.showToast({title:"请填写规则名或规则值",icon:"none"}),!1;i._post("supplier.Spec/addSpec",{spec_name:i.specName,spec_value:i.specValue},(function(e){i.form.spec_many.spec_attr.push({group_id:e.data.spec_id,group_name:i.specName,spec_items:[{item_id:e.data.spec_value_id,spec_value:i.specValue}],tempValue:"",loading:!1}),i.specValue="",i.specName=""}),(function(e){i.specValue="",i.specName=""}))}this.isSpec=!1},closeContent:function(e){this.isContent=!1},closeMany:function(e){this.isMany=!1},closeAdvanced:function(e){this.isAdvanced=!1},switchChange:function(e,t){this.form[t]=e.detail.value?1:0},deleteImg:function(t,i){var o=this;e.showModal({title:"提示",content:"确定要删除吗?",success:function(e){if(e.confirm)if(i>=0){var n=o.form[t];n.splice(i,1)}else o.form[t]={},o.form[t+"_id"]=0}})},getImgsFunc:function(e){this.isUpload=!1,e&&"undefined"!=typeof e&&("poster"==this.upload_type?(this.form.poster_id=e[0].file_id,this.form[this.upload_type]=e[0]):"video"==this.upload_type?(this.form.video_id=e[0].file_id,this.form[this.upload_type]=e[0]):"poster"!=this.upload_type?this.form[this.upload_type].push(e[0]):this.form[this.upload_type]=e[0])},openUpload:function(e,t){this.upload_type=e,this.isVideo=t||!1,this.isUpload=!0},clearImage:function(e,t){t?this.form[e].splice(t,1):this.form[e]=""},openMany:function(){this.buildSkulist(),this.isMany=!0},buildSkulist:function(){for(var e=this,t=e.form.spec_many.spec_attr,i=[],o=0;o<t.length;o++)i.push(t[o].spec_items);for(var n=e.calcDescartes(i),c=[],s=0;s<n.length;s++){var a=[],r=[];Array.isArray(n[s])?a=n[s]:a.push(n[s]);for(var u=0;u<a.length;u++)r.push(a[u].item_id);c.push({product_sku_id:0,spec_sku_id:r.join("_"),rows:a,spec_form:{product_no:"",product_price:"",line_price:"",stock_num:"",product_weight:""}})}if(e.form.spec_many.spec_list.length>0&&c.length>0)for(var d=function(t){var i=e.form.spec_many.spec_list.filter((function(e){return e.spec_sku_id===c[t].spec_sku_id}));i.length>0&&(c[t].spec_form=i[0].spec_form,c[t].product_sku_id=i[0].product_sku_id)},p=0;p<c.length;p++)d(p);e.form.spec_many.spec_list=c,console.log(t),console.log(c)},calcDescartes:function(e){return e.length<2?e[0]||[]:[].reduce.call(e,(function(e,t){var i=[];return e.forEach((function(e){t.forEach((function(t){var o=[].concat(Array.isArray(e)?e:[e]);o.push(t),i.push(o)}))})),i}))},getSpecName:function(e){var t=e.split("_"),i=[],o=this.form.spec_many.spec_attr;return t.forEach((function(e,t){o.forEach((function(t,o){t.spec_items.forEach((function(t,o){e==t.item_id&&i.push(t.spec_value)}))}))})),i.join("/")}}};t.default=s}).call(this,i("df3c")["default"])},1727:function(e,t,i){"use strict";i.r(t);var o=i("db94"),n=i("1fb8");for(var c in n)["default"].indexOf(c)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(c);var s=i("828b"),a=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=a.exports},"1fb8":function(e,t,i){"use strict";i.r(t);var o=i("6745"),n=i.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(c);t["default"]=n.a},"2a90":function(e,t,i){"use strict";(function(e,t){var o=i("47a9");i("112d");o(i("3240"));var n=o(i("6523"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(n.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"314b":function(e,t,i){},"44e4":function(e,t,i){"use strict";i.r(t);var o=i("021e"),n=i.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(c);t["default"]=n.a},6523:function(e,t,i){"use strict";i.r(t);var o=i("b8e7"),n=i("44e4");for(var c in n)["default"].indexOf(c)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(c);i("f611");var s=i("828b"),a=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=a.exports},6745:function(e,t,i){"use strict";(function(e){var o=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(i("3b2d")),c={data:function(){return{imageList:[]}},props:["num","isVideo"],onLoad:function(){},mounted:function(){this.chooseImageFunc()},methods:{chooseImageFunc:function(){var t=this;this.isVideo?e.chooseVideo({maxDuration:60,camera:"back",success:function(e){if(console.log(e),e){var i=[];i.push(e.tempFilePath),console.log(i),t.uploadFile(i)}},fail:function(e){console.log(e),t.$emit("getImgs",null)}}):e.chooseImage({count:t.num||9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){t.uploadFile(e.tempFilePaths)},fail:function(e){t.$emit("getImgs",null)},complete:function(e){}})},uploadFile:function(t){var i=this,o=0,c=t.length,s={token:e.getStorageSync("token"),app_id:i.getAppId(),file_type:i.isVideo?"video":"image"};e.showLoading({title:"上传中"}),t.forEach((function(t,a){e.uploadFile({url:i.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:t,name:"iFile",formData:s,success:function(e){var t="object"===(0,n.default)(e.data)?e.data:JSON.parse(e.data);if(-1===t.code)return console.log("登录态失效, 重新登录"),void i.doLogin();1===t.code&&i.imageList.push(t.data)},complete:function(){o++,c===o&&(e.hideLoading(),i.$emit("getImgs",i.imageList))}})}))}}};t.default=c}).call(this,i("df3c")["default"])},b8e7:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){}));var o=function(){var e=this,t=e.$createElement,i=(e._self._c,e.theme()||""),o=e.theme(),n=e.form.product_name.length,c=20==e.form.spec_type?e.form.spec_many&&e.form.spec_many.spec_attr.length<=1:null,s=20==e.form.spec_type?e.form.spec_many&&e.form.spec_many.spec_attr.length>1:null,a=20==e.form.spec_type&&e.form.spec_many&&e.form.spec_many.spec_attr?e.__map(e.form.spec_many.spec_attr,(function(t,i){var o=e.__get_orig(t),n=t.spec_items.length;return{$orig:o,g3:n}})):null,r=e.isAdvanced?e.getThemeColor():null,u=e.isAdvanced?e.getThemeColor():null,d=e.isAdvanced?e.getThemeColor():null,p=e.isMany?e.__map(e.form.spec_many.spec_list,(function(t,i){var o=e.__get_orig(t),n=e.getSpecName(t.spec_sku_id);return{$orig:o,m5:n}})):null;e._isMounted||(e.e0=function(t){e.form.product_status=10},e.e1=function(t){e.form.product_status=20},e.e2=function(t){e.form.is_virtual=0},e.e3=function(t){e.form.is_virtual=1},e.e4=function(t){e.form.is_delivery_free=0},e.e5=function(t){e.form.is_delivery_free=1},e.e6=function(t){e.form.virtual_auto=1},e.e7=function(t){e.form.virtual_auto=0},e.e8=function(t){e.form.deduct_stock_type=10},e.e9=function(t){e.form.deduct_stock_type=20},e.e10=function(t){e.form.spec_type=10},e.e11=function(t){e.form.spec_type=20},e.e12=function(t){e.isContent=!0},e.e13=function(t){e.isAdvanced=!0},e.e14=function(t){e.form.is_picture=1},e.e15=function(t){e.form.is_picture=0},e.e16=function(t,i){var o=arguments[arguments.length-1].currentTarget.dataset,n=o.eventParams||o["event-params"];i=n.index;e.activeSpec=i}),e.$mp.data=Object.assign({},{$root:{m0:i,m1:o,g0:n,g1:c,g2:s,l0:a,m2:r,m3:u,m4:d,l1:p}})},n=[]},db94:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){}));var o=function(){var e=this.$createElement;this._self._c},n=[]},f611:function(e,t,i){"use strict";var o=i("314b"),n=i.n(o);n.a}},[["2a90","common/runtime","common/vendor"]]]);