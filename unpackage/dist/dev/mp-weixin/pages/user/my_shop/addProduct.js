(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/my_shop/addProduct"],{209:function(e,t,n){"use strict";n.r(t);var i=n(210),o=n(212);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);var r,s=n(34),a=Object(s["default"])(o["default"],i["render"],i["staticRenderFns"],!1,null,null,null,!1,i["components"],r);a.options.__file="components/upload/upload.vue",t["default"]=a.exports},210:function(e,t,n){"use strict";n.r(t);var i=n(211);n.d(t,"render",(function(){return i["render"]})),n.d(t,"staticRenderFns",(function(){return i["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return i["recyclableRender"]})),n.d(t,"components",(function(){return i["components"]}))},211:function(e,t,n){"use strict";var i;n.r(t),n.d(t,"render",(function(){return o})),n.d(t,"staticRenderFns",(function(){return r})),n.d(t,"recyclableRender",(function(){return c})),n.d(t,"components",(function(){return i}));var o=function(){var e=this,t=e.$createElement;e._self._c},c=!1,r=[];o._withStripped=!0},212:function(e,t,n){"use strict";n.r(t);var i=n(213),o=n.n(i);for(var c in i)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(c);t["default"]=o.a},213:function(e,t,n){"use strict";(function(e){var i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(13)),c={data:function(){return{imageList:[]}},props:["num","isVideo"],onLoad:function(){},mounted:function(){this.chooseImageFunc()},methods:{chooseImageFunc:function(){var t=this;this.isVideo?e.chooseVideo({maxDuration:60,camera:"back",success:function(e){if(console.log(e),e){var n=[];n.push(e.tempFilePath),console.log(n),t.uploadFile(n)}},fail:function(e){console.log(e),t.$emit("getImgs",null)}}):e.chooseImage({count:t.num||9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){t.uploadFile(e.tempFilePaths)},fail:function(e){t.$emit("getImgs",null)},complete:function(e){}})},uploadFile:function(t){var n=this,i=0,c=t.length,r={token:e.getStorageSync("token"),app_id:n.getAppId(),file_type:n.isVideo?"video":"image"};e.showLoading({title:"上传中"}),t.forEach((function(t,s){e.uploadFile({url:n.websiteUrl+"/index.php?s=/api/file.upload/image",filePath:t,name:"iFile",formData:r,success:function(e){var t="object"===(0,o.default)(e.data)?e.data:JSON.parse(e.data);if(-1===t.code)return console.log("登录态失效, 重新登录"),void n.doLogin();1===t.code&&n.imageList.push(t.data)},complete:function(){i++,c===i&&(e.hideLoading(),n.$emit("getImgs",n.imageList))}})}))}}};t.default=c}).call(this,n(2)["default"])},846:function(e,t,n){"use strict";(function(e,t){var i=n(4);n(26);i(n(25));var o=i(n(847));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n(1)["default"],n(2)["createPage"])},847:function(e,t,n){"use strict";n.r(t);var i=n(848),o=n(850);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);n(853);var r,s=n(34),a=Object(s["default"])(o["default"],i["render"],i["staticRenderFns"],!1,null,null,null,!1,i["components"],r);a.options.__file="pages/user/my_shop/addProduct.vue",t["default"]=a.exports},848:function(e,t,n){"use strict";n.r(t);var i=n(849);n.d(t,"render",(function(){return i["render"]})),n.d(t,"staticRenderFns",(function(){return i["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return i["recyclableRender"]})),n.d(t,"components",(function(){return i["components"]}))},849:function(e,t,n){"use strict";var i;n.r(t),n.d(t,"render",(function(){return o})),n.d(t,"staticRenderFns",(function(){return r})),n.d(t,"recyclableRender",(function(){return c})),n.d(t,"components",(function(){return i}));var o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.theme()||""),i=e.theme(),o=e.form.product_name.length,c=20==e.form.spec_type?e.form.spec_many&&e.form.spec_many.spec_attr.length<=1:null,r=20==e.form.spec_type?e.form.spec_many&&e.form.spec_many.spec_attr.length>1:null,s=20==e.form.spec_type&&e.form.spec_many&&e.form.spec_many.spec_attr?e.__map(e.form.spec_many.spec_attr,(function(t,n){var i=e.__get_orig(t),o=t.spec_items.length;return{$orig:i,g3:o}})):null,a=e.isAdvanced?e.getThemeColor():null,u=e.isAdvanced?e.getThemeColor():null,d=e.isAdvanced?e.getThemeColor():null,p=e.isMany?e.__map(e.form.spec_many.spec_list,(function(t,n){var i=e.__get_orig(t),o=e.getSpecName(t.spec_sku_id);return{$orig:i,m5:o}})):null;e._isMounted||(e.e0=function(t){e.form.product_status=10},e.e1=function(t){e.form.product_status=20},e.e2=function(t){e.form.is_virtual=0},e.e3=function(t){e.form.is_virtual=1},e.e4=function(t){e.form.is_delivery_free=0},e.e5=function(t){e.form.is_delivery_free=1},e.e6=function(t){e.form.virtual_auto=1},e.e7=function(t){e.form.virtual_auto=0},e.e8=function(t){e.form.deduct_stock_type=10},e.e9=function(t){e.form.deduct_stock_type=20},e.e10=function(t){e.form.spec_type=10},e.e11=function(t){e.form.spec_type=20},e.e12=function(t){e.isContent=!0},e.e13=function(t){e.isAdvanced=!0},e.e14=function(t){e.form.is_picture=1},e.e15=function(t){e.form.is_picture=0},e.e16=function(t,n){var i=arguments[arguments.length-1].currentTarget.dataset,o=i.eventParams||i["event-params"];n=o.index;e.activeSpec=n}),e.$mp.data=Object.assign({},{$root:{m0:n,m1:i,g0:o,g1:c,g2:r,l0:s,m2:a,m3:u,m4:d,l1:p}})},c=!1,r=[];o._withStripped=!0},850:function(e,t,n){"use strict";n.r(t);var i=n(851),o=n.n(i);for(var c in i)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(c);t["default"]=o.a},851:function(e,t,n){"use strict";(function(e){var i=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n(209)),c=i(n(852)),r={components:{Upload:o.default},data:function(){return{product_id:0,activeSpec:0,form:{product_name:"",image:[],video:{},video_id:0,poster:{},poster_id:0,selling_point:"",product_status:10,audit_status:0,category_id:0,is_virtual:0,product_sort:0,limit_num:0,virtual_auto:0,virtual_content:"",is_delivery_free:0,delivery_id:0,is_points_gift:0,is_points_discount:0,max_points_discount:"",is_agent:0,is_picture:1,contentImage:[],deduct_stock_type:10,spec_type:10,sku:{product_no:"",product_price:"",line_price:"",stock_num:"",product_weight:""},spec_many:{spec_attr:[],spec_list:[]}},delivery:[],deliveryIndex:-1,category:[],categoryIndex:-1,title:"",textType:"",showPop:!1,isContent:!1,isAdvanced:!1,isSpec:!1,specValue:"",specName:"",popValue:"",fileType:"",upload_type:"",isUpload:"",isVideo:!1,specValuesList:[],isMany:!1}},onLoad:function(e){this.product_id=e.product_id||0,this.getData()},methods:{deleteSpec:function(t){var n=this;e.showModal({title:"提示",content:"确认要删除吗?",success:function(e){e.confirm&&n.form.spec_many.spec_attr.splice(t,1)}})},deleteSpecValue:function(t,n){var i=this;e.showModal({title:"提示",content:"确认要删除吗?",success:function(e){e.confirm&&i.form.spec_many.spec_attr[t].spec_items.splice(n,1)}})},addApecValue:function(t){var n=this,i=this.specValuesList[t];i?n._post("supplier.Spec/addSpecValue",{spec_id:n.form.spec_many.spec_attr[t].group_id,spec_value:i},(function(e){n.form.spec_many.spec_attr[t].spec_items.push({item_id:e.data.spec_value_id,spec_value:i}),n.specValuesList[t]=""}),(function(e){n.specValuesList[t]=""})):e.showToast({title:"请输入规格值",icon:"none"})},addSpec:function(){var e=this;e.isSpec=!0},getData:function(){var e=this,t="supplier.Product/add",n={};e.product_id&&(t="supplier.Product/edit",n.product_id=e.product_id),e._get(t,n,(function(t){var n=[],i=[];i=t.data.category,i.length>0&&i.forEach((function(e,t){n.push({name:e.name,category_id:e.category_id}),e.child&&e.child.length>0&&e.child.forEach((function(t,i){n.push({name:e.name+"—"+t.name,category_id:t.category_id})}))})),e.category=n,e.delivery=t.data.delivery,e.product_id&&(Object.assign(e.form,t.data.model),e.form.product_status=t.data.model.product_status.value,t.data.specData?e.$set(e.form,"spec_many",t.data.specData):(e.$set(e.form,"spec_many",{spec_attr:[],spec_list:[]}),e.form.sku=t.data.model.sku[0]),0==e.form.delivery_id?e.$set(e.form,"is_delivery_free",0):e.$set(e.form,"is_delivery_free",1),1==t.data.audit_setting.edit_audit&&e.product_id&&(e.form.audit_status=0),e.category.forEach((function(t,n){t.category_id!=e.form.category_id||(e.categoryIndex=n)})),e.delivery.forEach((function(t,n){t.delivery_id!=e.form.delivery_id||(e.deliveryIndex=n)})),console.log(e.deliveryIndex))}))},submitFunc:function(){var t=this,n=t.form;if(-1!=t.categoryIndex){n.category_id=t.category[t.categoryIndex].category_id;var i=c.default.validate(n);if(i){var o="supplier.Product/add",r={params:JSON.stringify(n)};t.product_id&&(o="supplier.Product/edit",r.product_id=t.product_id),t._post(o,r,(function(t){e.showModal({title:"提示",content:t.msg,success:function(){e.navigateBack()}})}))}console.log(i)}else e.showToast({title:"请选择商品分类",icon:"none"})},openTextarea:function(e,t){this.title=t,this.textType=e,this.popValue=this.form[e],this.showPop=!0},changeType:function(e,t){this[t+"Index"]=e.detail.value,this.form[t+"_id"]=this[t][this[t+"Index"]]},closeFunc:function(e){e&&(this.form[this.textType]=this.popValue),this.popValue="",this.title="",this.showPop=!1},closeSpec:function(t){var n=this;if(t){if(""===n.specName||""===n.specValue)return e.showToast({title:"请填写规则名或规则值",icon:"none"}),!1;n._post("supplier.Spec/addSpec",{spec_name:n.specName,spec_value:n.specValue},(function(e){n.form.spec_many.spec_attr.push({group_id:e.data.spec_id,group_name:n.specName,spec_items:[{item_id:e.data.spec_value_id,spec_value:n.specValue}],tempValue:"",loading:!1}),n.specValue="",n.specName=""}),(function(e){n.specValue="",n.specName=""}))}this.isSpec=!1},closeContent:function(e){this.isContent=!1},closeMany:function(e){this.isMany=!1},closeAdvanced:function(e){this.isAdvanced=!1},switchChange:function(e,t){this.form[t]=e.detail.value?1:0},deleteImg:function(t,n){var i=this;e.showModal({title:"提示",content:"确定要删除吗?",success:function(e){if(e.confirm)if(n>=0){var o=i.form[t];o.splice(n,1)}else i.form[t]={},i.form[t+"_id"]=0}})},getImgsFunc:function(e){var t=this;t.isUpload=!1,e&&"undefined"!=typeof e&&("poster"==t.upload_type?(t.form.poster_id=e[0].file_id,t.form[t.upload_type]=e[0]):"video"==t.upload_type?(t.form.video_id=e[0].file_id,t.form[t.upload_type]=e[0]):"poster"!=t.upload_type?t.form[t.upload_type].push(e[0]):t.form[t.upload_type]=e[0])},openUpload:function(e,t){this.upload_type=e,this.isVideo=t||!1,this.isUpload=!0},clearImage:function(e,t){t?this.form[e].splice(t,1):this.form[e]=""},openMany:function(){this.buildSkulist(),this.isMany=!0},buildSkulist:function(){for(var e=this,t=e.form.spec_many.spec_attr,n=[],i=0;i<t.length;i++)n.push(t[i].spec_items);for(var o=e.calcDescartes(n),c=[],r=0;r<o.length;r++){var s=[],a=[];Array.isArray(o[r])?s=o[r]:s.push(o[r]);for(var u=0;u<s.length;u++)a.push(s[u].item_id);c.push({product_sku_id:0,spec_sku_id:a.join("_"),rows:s,spec_form:{product_no:"",product_price:"",line_price:"",stock_num:"",product_weight:""}})}if(e.form.spec_many.spec_list.length>0&&c.length>0)for(var d=function(t){var n=e.form.spec_many.spec_list.filter((function(e){return e.spec_sku_id===c[t].spec_sku_id}));n.length>0&&(c[t].spec_form=n[0].spec_form,c[t].product_sku_id=n[0].product_sku_id)},p=0;p<c.length;p++)d(p);e.form.spec_many.spec_list=c,console.log(t),console.log(c)},calcDescartes:function(e){return e.length<2?e[0]||[]:[].reduce.call(e,(function(e,t){var n=[];return e.forEach((function(e){t.forEach((function(t){var i=[].concat(Array.isArray(e)?e:[e]);i.push(t),n.push(i)}))})),n}))},getSpecName:function(e){var t=this,n=e.split("_"),i=[],o=t.form.spec_many.spec_attr;return n.forEach((function(e,t){o.forEach((function(t,n){t.spec_items.forEach((function(t,n){e==t.item_id&&i.push(t.spec_value)}))}))})),i.join("/")}}};t.default=r}).call(this,n(2)["default"])},853:function(e,t,n){"use strict";n.r(t);var i=n(854),o=n.n(i);for(var c in i)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(c);t["default"]=o.a},854:function(e,t,n){}},[[846,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/user/my_shop/addProduct.js.map