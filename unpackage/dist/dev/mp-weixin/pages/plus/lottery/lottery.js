(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/plus/lottery/lottery"],{737:function(t,e,n){"use strict";(function(t,e){var i=n(4);n(26);i(n(25));var o=i(n(738));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n(1)["default"],n(2)["createPage"])},738:function(t,e,n){"use strict";n.r(e);var i=n(739),o=n(741);for(var r in o)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(r);n(746);var a,s=n(34),u=Object(s["default"])(o["default"],i["render"],i["staticRenderFns"],!1,null,null,null,!1,i["components"],a);u.options.__file="pages/plus/lottery/lottery.vue",e["default"]=u.exports},739:function(t,e,n){"use strict";n.r(e);var i=n(740);n.d(e,"render",(function(){return i["render"]})),n.d(e,"staticRenderFns",(function(){return i["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return i["recyclableRender"]})),n.d(e,"components",(function(){return i["components"]}))},740:function(t,e,n){"use strict";var i;n.r(e),n.d(e,"render",(function(){return o})),n.d(e,"staticRenderFns",(function(){return a})),n.d(e,"recyclableRender",(function(){return r})),n.d(e,"components",(function(){return i}));try{i={almostLottery:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/almost-lottery/components/almost-lottery/almost-lottery")]).then(n.bind(null,1153))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.points_name()),i=t.points_name(),o=t.prizeList.length;t._isMounted||(t.e0=function(e){t.isRule=!0},t.e1=function(e){t.prizeIndex=-1},t.e2=function(e){t.isRule=!1}),t.$mp.data=Object.assign({},{$root:{m0:n,m1:i,g0:o}})},r=!1,a=[];o._withStripped=!0},741:function(t,e,n){"use strict";n.r(e);var i=n(742),o=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=o.a},742:function(t,e,n){"use strict";(function(t){var i=n(4);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n(743)),r=i(n(18)),a=i(n(745)),s=function(){n.e("components/uni-popup").then(function(){return resolve(n(115))}.bind(null,n)).catch(n.oe)},u=function(){Promise.all([n.e("common/vendor"),n.e("uni_modules/almost-lottery/components/almost-lottery/almost-lottery")]).then(function(){return resolve(n(1153))}.bind(null,n)).catch(n.oe)},c=function(){n.e("components/uni-load-more").then(function(){return resolve(n(937))}.bind(null,n)).catch(n.oe)},l={components:{AlmostLottery:u,popup:s,uniLoadMore:c},data:function(){return{loading:!0,finish:!1,times:0,points:"",user_points:"",bg_image:"",content:"",prizeList:[],onStock:!0,prizeIndex:-1,result:{},listData:[],styleValue:"",index_num:0,lineHeight:0,maxSize:0,timer:null,isPopup:!1,isRecord:!1,recordList:[],list_rows:10,last_page:0,page:1,no_more:!1,isRule:!1}},computed:{loadingType:function(){return this.loading?1:0!=this.recordList.length&&this.no_more?2:0}},onShow:function(){this.isRecord=!1,this.restoreData(),this.handleInitCanvas()},methods:{init:function(){var e=this;this.listData.length>1&&t.getSystemInfo({success:function(t){e.lineHeight=t.windowWidth/750*60,e.maxSize=e.listData.length,e.timer=setInterval((function(){e.animation()}),3e3)}})},animation:function(){var t=this;t.index_num++,t.index_num>=t.maxSize&&(t.index_num=0),this.styleValue=-t.lineHeight*t.index_num},getPrizeList:function(){var e=this;return(0,a.default)(o.default.mark((function n(){var i,r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.showLoading({title:"奖品准备中..."}),e.loading=!0,n.next=4,e.requestApiGetPrizeList();case 4:i=n.sent,i.ok?(r=i.data,r.length&&(e.prizeList=r)):(t.hideLoading(),t.showToast({title:"获取奖品失败"}));case 6:case"end":return n.stop()}}),n)})))()},requestApiGetPrizeList:function(){var t=this;return new Promise((function(e,n){t._post("plus.lottery.Lottery/getLottery",{},(function(n){t.loading=!1,t.bg_image=n.data.data.file_path,t.content=n.data.data.content,t.prizeList=n.data.data.prize,t.listData=n.data.recordList,t.listData.forEach((function(e,n){var i=t.GetDateDiff(e.create_time),o=e.user?e.user.nickName:"匿名用户";e.showText=i+o+"抽中了"+e.record_name})),t.times=n.data.nums,t.points=n.data.data.points,t.user_points=n.data.data.user_points,t.init(),e({ok:!0,data:t.prizeList})}))}))},GetDateDiff:function(t){var e=t,n=new Date(e.replace(/-/g,"/")),i=new Date,o=i.getTime()-n.getTime(),r=parseInt(o/864e5),a=o%864e5,s=parseInt(a/36e5),u=a%36e5,c=parseInt(u/6e4),l=u%6e4,d=parseInt(l/1e3),f="";return f=r>0?"".concat(r,"天前"):s>0?"".concat(s,"小时前"):c>0?"".concat(c,"分钟前"):"".concat(d,"秒前"),console.log(r),f},handleInitCanvas:function(){this.prizeList=[],this.getPrizeList()},handleDrawStart:function(){console.log("start");var t=this;!t.loading&&t.finish&&(t.times<=0?t.showError("次数不足"):(t.loading=!0,t._post("plus.lottery.Lottery/draw",{},(function(e){t.times--,t.loading=!1,t.result=e.data.result;for(var n=(0,r.default)(t.prizeList),i=e.data.result.prize_id,o=0;o<n.length;o++){var a=n[o];if(a.prize_id===i){t.prizeIndex=o;break}}console.log("本次抽中奖品 =>",t.prizeList[t.prizeIndex].name)}),(function(e){t.loading=!1}))))},hidePopup:function(){this.isPopup=!1},hideRecordPopup:function(){this.isRecord=!1},handleDrawEnd:function(){this.isPopup=!0,this.handleInitCanvas()},handleDrawFinish:function(t){this.finish=!0},restoreData:function(){this.recordList=[],this.page=1,this.no_more=!1,this.last_page=1},getList:function(){var t=this;t.loading=!0,t._post("plus.lottery.Lottery/record",{list_rows:t.list_rows,page:t.page||1},(function(e){t.loading=!1,t.recordList=t.recordList.concat(e.data.list.data),t.last_page=e.data.list.last_page,e.data.list.last_page<=1&&(t.no_more=!0)}))},getRecord:function(){this.restoreData(),this.getList(),this.isRecord=!0},scrolltolowerFunc:function(){var t=this;if(t.page++,t.loading=!0,t.page>t.last_page)return t.loading=!1,void(t.no_more=!0);t.getList()}}};e.default=l}).call(this,n(2)["default"])},746:function(t,e,n){"use strict";n.r(e);var i=n(747),o=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=o.a},747:function(t,e,n){}},[[737,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/plus/lottery/lottery.js.map