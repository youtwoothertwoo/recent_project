let RtmStatusCode;!function(e){let t,r,n,o,a,c,l;!function(e){e.LOGIN="LOGIN",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.LOGIN_FAILURE="LOGIN_FAILURE",e.LOGIN_TIMEOUT="LOGIN_TIMEOUT",e.INTERRUPTED="INTERRUPTED",e.LOGOUT="LOGOUT",e.BANNED_BY_SERVER="BANNED_BY_SERVER",e.REMOTE_LOGIN="REMOTE_LOGIN"}(t||(t={})),e.ConnectionChangeReason=t,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECTING="RECONNECTING",e.ABORTED="ABORTED"}(r||(r={})),e.ConnectionState=r,function(e){e.TEXT="TEXT"}(n||(n={})),e.MessageType=n,function(e){e.IDLE="IDLE",e.SENT_TO_REMOTE="SENT_TO_REMOTE",e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(o||(o={})),e.LocalInvitationState=o,function(e){e.INVITATION_RECEIVED="INVITATION_RECEIVED",e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",e.REFUSED="REFUSED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(a||(a={})),e.RemoteInvitationState=a,function(e){e.UNKNOWN="UNKNOWN",e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",e.INVITATION_EXPIRE="INVITATION_EXPIRE",e.PEER_OFFLINE="PEER_OFFLINE",e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(c||(c={})),e.LocalInvitationFailureReason=c,function(e){e.UNKNOWN="UNKNOWN",e.PEER_OFFLINE="PEER_OFFLINE",e.ACCEPT_FAILURE="ACCEPT_FAILURE",e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(l||(l={})),e.RemoteInvitationFailureReason=l}(RtmStatusCode||(RtmStatusCode={}));var RtmStatusCode$1=RtmStatusCode;function _applyDecoratedDescriptor(e,t,r,n,o){var a={};return Object.keys(n).forEach((function(e){a[e]=n[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}var R="object"==typeof Reflect?Reflect:null,ReflectApply=R&&"function"==typeof R.apply?R.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},ReflectOwnKeys;function ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}ReflectOwnKeys=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var NumberIsNaN=Number.isNaN||function(e){return e!=e};function EventEmitter(){EventEmitter.init.call(this)}var events=EventEmitter,once_1=once;EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function _getMaxListeners(e){return void 0===e._maxListeners?EventEmitter.defaultMaxListeners:e._maxListeners}function _addListener(e,t,r,n){var o,a,c;if(checkListener(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),c=a[t]),void 0===c)c=a[t]=r,++e._eventsCount;else if("function"==typeof c?c=a[t]=n?[r,c]:[c,r]:n?c.unshift(r):c.push(r),(o=_getMaxListeners(e))>0&&c.length>o&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=c.length,ProcessEmitWarning(l)}return e}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=onceWrapper.bind(n);return o.listener=r,n.wrapFn=o,o}function _listeners(e,t,r){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?unwrapListeners(o):arrayClone(o,o.length)}function listenerCount(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function arrayClone(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function spliceOne(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function unwrapListeners(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function once(e,t){return new Promise((function(r,n){function o(){void 0!==a&&e.removeListener("error",a),r([].slice.call(arguments))}var a;"error"!==t&&(a=function(r){e.removeListener(t,o),n(r)},e.once("error",a)),e.once(t,o)}))}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if("number"!=typeof e||e<0||NumberIsNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");defaultMaxListeners=e}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||NumberIsNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},EventEmitter.prototype.getMaxListeners=function(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)ReflectApply(l,this,t);else{var u=l.length,_=arrayClone(l,u);for(r=0;r<u;++r)ReflectApply(_[r],this,t)}return!0},EventEmitter.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)},EventEmitter.prototype.once=function(e,t){return checkListener(t),this.on(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.prependOnceListener=function(e,t){return checkListener(t),this.prependListener(e,_onceWrap(this,e,t)),this},EventEmitter.prototype.removeListener=function(e,t){var r,n,o,a,c;if(checkListener(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){c=r[a].listener,o=a;break}if(o<0)return this;0===o?r.shift():spliceOne(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,c||t)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(o=a[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},EventEmitter.prototype.listeners=function(e){return _listeners(this,e,!0)},EventEmitter.prototype.rawListeners=function(e){return _listeners(this,e,!1)},EventEmitter.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):listenerCount.call(e,t)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]},events.once=once_1;const SEMAPHORE=Symbol(),NO_OP=()=>{},assert=(()=>{try{return"production"!==process.env.NODE_ENV||"1"===process.env.UMBRELLA_ASSERTS}catch(e){}return!1})()?(e,t="assertion failed")=>{if("function"==typeof e&&!e()||!e)throw new Error("function"==typeof t?t():t)}:NO_OP,implementsFunction=(e,t)=>null!=e&&"function"==typeof e[t],isArrayLike=e=>null!=e&&"function"!=typeof e&&void 0!==e.length,isIterable=e=>null!=e&&"function"==typeof e[Symbol.iterator],compare=(e,t)=>e===t?0:null==e?null==t?0:-1:null==t?null==e?0:1:"function"==typeof e.compare?e.compare(t):"function"==typeof t.compare?-t.compare(e):e<t?-1:e>t?1:0,OBJP=Object.getPrototypeOf({}),FN="function",STR="string",equiv=(e,t)=>{let r;return e===t||(null==e?e==t:typeof e.equiv===FN?e.equiv(t):null==t?e==t:typeof t.equiv===FN?t.equiv(e):typeof e!==STR&&typeof t!==STR&&(r=Object.getPrototypeOf(e),null!=r&&r!==OBJP||(r=Object.getPrototypeOf(t),null!=r&&r!==OBJP)?typeof e!==FN&&void 0!==e.length&&typeof t!==FN&&void 0!==t.length?equivArrayLike(e,t):e instanceof Set&&t instanceof Set?equivSet(e,t):e instanceof Map&&t instanceof Map?equivMap(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:equivObject(e,t)))},equivArrayLike=(e,t,r=equiv)=>{let n=e.length;if(n===t.length)for(;--n>=0&&r(e[n],t[n]););return n<0},equivSet=(e,t,r=equiv)=>e.size===t.size&&r([...e.keys()].sort(),[...t.keys()].sort()),equivMap=(e,t,r=equiv)=>e.size===t.size&&r([...e].sort(),[...t].sort()),equivObject=(e,t,r=equiv)=>{if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(!t.hasOwnProperty(n)||!r(e[n],t[n]))return!1;return!0},defError=(e,t=(e=>void 0!==e?": "+e:""))=>class extends Error{constructor(r){super(e(r)+t(r))}},IllegalArgumentError=defError((()=>"illegal argument(s)")),illegalArgs=e=>{throw new IllegalArgumentError(e)},INV_MAX=1/4294967295;class ARandom{float(e=1){return this.int()*INV_MAX*e}norm(e=1){return 2*(this.int()*INV_MAX-.5)*e}minmax(e,t){return this.float()*(t-e)+e}}const random=Math.random;class SystemRandom extends ARandom{int(){return 4294967296*random()>>>0}float(e=1){return random()*e}norm(e=1){return 2*(random()-.5)*e}}const SYSTEM=new SystemRandom,ensureTransducer=e=>implementsFunction(e,"xform")?e.xform():e;class Reduced{constructor(e){this.value=e}deref(){return this.value}}const isReduced=e=>e instanceof Reduced,unreduced=e=>e instanceof Reduced?e.deref():e;function*iterator1(e,t){const r=ensureTransducer(e)([NO_OP,NO_OP,(e,t)=>t])[2];for(let e of t){let t=r(SEMAPHORE,e);if(isReduced(t))return t=unreduced(t.deref()),void(t!==SEMAPHORE&&(yield t));t!==SEMAPHORE&&(yield t)}}const compR=(e,t)=>[e[0],e[1],t];function map(e,t){return isIterable(t)?iterator1(map(e),t):t=>{const r=t[2];return compR(t,((t,n)=>r(t,e(n))))}}class DCons{constructor(e){this._length=0,e&&this.into(e)}get length(){return this._length}copy(){return new DCons(this)}empty(){return new DCons}clear(){this.release()}release(){let e,t=this.head;for(;t;)e=t.next,delete t.value,delete t.prev,delete t.next,t=e;return delete this.head,delete this.tail,this._length=0,!0}compare(e){const t=this._length;if(t<e._length)return-1;if(t>e._length)return 1;if(0===t)return 0;{let t=this.head,r=e.head,n=0;for(;t&&0==n;)n=compare(t.value,r.value),t=t.next,r=r.next;return n}}equiv(e){if(!(e instanceof DCons||isArrayLike(e))||this._length!==e.length)return!1;if(!this._length||this===e)return!0;let t=this.head;for(let r of e){if(!equiv(t.value,r))return!1;t=t.next}return!0}*[Symbol.iterator](){let e=this.head;for(;e;)yield e.value,e=e.next}seq(e=0,t=this.length){if(e>=t||e<0)return;let r=this.nthCell(e);const n=this.nthCell(t-1),o=e=>({first:()=>e.value,next:()=>e!==n&&e.next?o(e.next):void 0});return r?o(r):void 0}*cycle(){for(;;)yield*this}$reduce(e,t){let r=this.head;for(;r&&!isReduced(t);)t=e(t,r.value),r=r.next;return t}drop(){const e=this.head;if(e)return this.head=e.next,this.head?delete this.head.prev:delete this.tail,this._length--,e.value}cons(e){const t={value:e,next:this.head};return this.head?this.head.prev=t:this.tail=t,this.head=t,this._length++,this}insertBefore(e,t){e||illegalArgs("cell is undefined");const r={value:t,next:e,prev:e.prev};return e.prev?e.prev.next=r:this.head=r,e.prev=r,this._length++,this}insertAfter(e,t){e||illegalArgs("cell is undefined");const r={value:t,next:e.next,prev:e};return e.next?e.next.prev=r:this.tail=r,e.next=r,this._length++,this}insertBeforeNth(e,t){return e<0&&(e+=this._length),e<=0?this.cons(t):(this.ensureIndex(e),this.insertBefore(this.nthCellUnsafe(e),t))}insertAfterNth(e,t){return e<0&&(e+=this._length),e>=this._length-1?this.push(t):(this.ensureIndex(e),this.insertAfter(this.nthCellUnsafe(e),t))}insertSorted(e,t){t=t||compare;let r=this.head;for(;r;){if(t(e,r.value)<=0)return this.insertBefore(r,e);r=r.next}return this.push(e)}find(e){let t=this.head;for(;t;){if(t.value===e)return t;t=t.next}}findWith(e){let t=this.head;for(;t;){if(e(t.value))return t;t=t.next}}concat(...e){const t=this.copy();for(let r of e)t.into(r);return t}into(e){for(let t of e)this.push(t)}slice(e=0,t=this.length){let r=e<0?e+this._length:e,n=t<0?t+this._length:t;(r<0||n<0)&&illegalArgs("invalid indices: ${from} / ${to}");const o=new DCons;let a=this.nthCell(r);for(;a&&++r<=n;)o.push(a.value),a=a.next;return o}splice(e,t=0,r){let n;"number"==typeof e?(e<0&&(e+=this._length),this.ensureIndex(e),n=this.nthCellUnsafe(e)):n=e;const o=new DCons;if(t>0)for(;n&&t-- >0;)this.remove(n),o.push(n.value),n=n.next;else n&&(n=n.next);if(r)if(n)for(let e of r)this.insertBefore(n,e);else for(let e of r)this.push(e);return o}remove(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}swap(e,t){if(e!==t){const r=e.value;e.value=t.value,t.value=r}return this}push(e){if(this.tail){const t={value:e,prev:this.tail};return this.tail.next=t,this.tail=t,this._length++,this}return this.cons(e)}pop(){const e=this.tail;if(e)return this.tail=e.prev,this.tail?delete this.tail.next:delete this.head,this._length--,e.value}first(){return this.head&&this.head.value}peek(){return this.tail&&this.tail.value}setHead(e){return this.head?(this.head.value=e,this):this.cons(e)}setTail(e){return this.tail?(this.tail.value=e,this):this.push(e)}setNth(e,t){const r=this.nthCell(e);return!r&&illegalArgs(`index out of bounds: ${e}`),r.value=t,this}nth(e,t){const r=this.nthCell(e);return r?r.value:t}nthCell(e){if(e<0&&(e+=this._length),!(e<0||e>=this._length))return this.nthCellUnsafe(e)}rotateLeft(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}rotateRight(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:const e=this.peek();return this.pop(),this.cons(e)}}map(e){const t=new DCons;let r=this.head;for(;r;)t.push(e(r.value)),r=r.next;return t}filter(e){const t=new DCons;let r=this.head;for(;r;)e(r.value)&&t.push(r.value),r=r.next;return t}reduce(e,t){let r=t,n=this.head;for(;n;)r=e(r,n.value),n=n.next;return r}shuffle(e,t=SYSTEM){if(this._length<2)return this;for(e=null!=e?e:Math.ceil(1.5*Math.log2(this._length));e>0;e--){let e=this.head;for(;e;){const r=e.next;t.float()<.5?this.asHead(e):this.asTail(e),e=r}}return this}sort(e=compare){if(!this._length)return this;let t=1;for(;;){let r=this.head;this.head=void 0,this.tail=void 0;let n=0;for(;r;){n++;let o=r,a=0;for(let e=0;e<t&&(a++,o=o.next,o);e++);let c=t;for(;a>0||c>0&&o;){let t;0===a?(t=o,o=o.next,c--):o&&0!==c?e(r.value,o.value)<=0?(t=r,r=r.next,a--):(t=o,o=o.next,c--):(t=r,r=r.next,a--),this.tail?this.tail.next=t:this.head=t,t.prev=this.tail,this.tail=t}r=o}if(this.tail.next=void 0,n<=1)return this;t*=2}}reverse(){let e=this.head,t=this.tail,r=(this._length>>>1)+(1&this._length);for(;e&&t&&r>0;){const n=e.value;e.value=t.value,t.value=n,e=e.next,t=t.prev,r--}return this}asHead(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}asTail(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}toString(){let e=[],t=this.head;for(;t;)e.push(null!=t.value?String(t.value):void 0===t.value?"undefined":"null"),t=t.next;return e.join(", ")}toJSON(){return[...this]}ensureIndex(e){assert(e>=0&&e<this._length,`index out of range: ${e}`)}nthCellUnsafe(e){let t,r;for(e<=this._length>>1?(t=this.head,r="next"):(t=this.tail,r="prev",e=this._length-e-1);e-- >0&&t;)t=t[r];return t}}class LRUCache{constructor(e,t){const r=Object.assign({maxlen:1/0,maxsize:1/0,map:()=>new Map,ksize:()=>0,vsize:()=>0},t);this.map=r.map(),this.items=new DCons,this._size=0,this.opts=r,e&&this.into(e)}get length(){return this.items.length}get size(){return this._size}[Symbol.iterator](){return this.entries()}entries(){return map((e=>[e.k,e]),this.items)}keys(){return map((e=>e.k),this.items)}values(){return map((e=>e.v),this.items)}copy(){const e=this.empty();e.items=this.items.copy();let t=e.items.head;for(;t;)e.map.set(t.value.k,t),t=t.next;return e}empty(){return new LRUCache(null,this.opts)}release(){this._size=0,this.map.clear();const e=this.opts.release;if(e){let t;for(;t=this.items.drop();)e(t.k,t.v);return!0}return this.items.release()}has(e){return this.map.has(e)}get(e,t){const r=this.map.get(e);return r?this.resetEntry(r):t}set(e,t){const r=this.opts.ksize(e)+this.opts.vsize(t),n=this.map.get(e);return this._size+=Math.max(0,r-(n?n.value.s:0)),this.ensureSize()&&this.doSetEntry(n,e,t,r),t}into(e){for(let t of e)this.set(t[0],t[1]);return this}getSet(e,t){const r=this.map.get(e);return r?Promise.resolve(this.resetEntry(r)):t().then((t=>this.set(e,t)))}delete(e){const t=this.map.get(e);return!!t&&(this.removeEntry(t),!0)}resetEntry(e){return this.items.asTail(e),e.value.v}ensureSize(){const e=this.opts.release,t=this.opts.maxsize,r=this.opts.maxlen;for(;this._size>t||this.length>=r;){const t=this.items.drop();if(!t)return!1;this.map.delete(t.k),e&&e(t.k,t.v),this._size-=t.s}return!0}removeEntry(e){const t=e.value;this.map.delete(t.k),this.items.remove(e),this.opts.release&&this.opts.release(t.k,t.v),this._size-=t.s}doSetEntry(e,t,r,n){e?(e.value.v=r,e.value.s=n,this.items.asTail(e)):(this.items.push({k:t,v:r,s:n}),this.map.set(t,this.items.tail))}}class TLRUCache extends LRUCache{constructor(e,t){super(e,t=Object.assign({ttl:36e5},t))}empty(){return new TLRUCache(null,this.opts)}has(e){return void 0!==this.get(e)}get(e,t){const r=this.map.get(e);if(r){if(r.value.t>=Date.now())return this.resetEntry(r);this.removeEntry(r)}return t}set(e,t,r=this.opts.ttl){const n=this.opts.ksize(e)+this.opts.vsize(t),o=this.map.get(e);if(this._size+=Math.max(0,n-(o?o.value.s:0)),this.ensureSize()){const a=Date.now()+r;o?(o.value.v=t,o.value.s=n,o.value.t=a,this.items.asTail(o)):(this.items.push({k:e,v:t,s:n,t:a}),this.map.set(e,this.items.tail))}return t}getSet(e,t,r=this.opts.ttl){const n=this.get(e);return n?Promise.resolve(n):t().then((t=>this.set(e,t,r)))}prune(){const e=Date.now();let t=this.items.head;for(;t;)t.value.t<e&&this.removeEntry(t),t=t.next}ensureSize(){const e=this.opts.maxsize,t=this.opts.maxlen,r=Date.now();let n=this.items.head;for(;n&&(this._size>e||this.length>=t);)n.value.t<r&&this.removeEntry(n),n=n.next;return super.ensureSize()}}function getType(e){return Object.prototype.toString.call(e).slice(8,-1)}function isPlainObject(e){return"Object"===getType(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function isNil(e){return null==e}var isNil_1=isNil,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return commonjsRequire(e,null==t?r.path:t)}},r.exports),r.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=_freeGlobal||freeSelf||Function("return this")(),_root=root,Symbol$1=_root.Symbol,_Symbol=Symbol$1,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=_Symbol?_Symbol.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty.call(e,symToStringTag),r=e[symToStringTag];try{e[symToStringTag]=void 0;var n=!0}catch(e){}var o=nativeObjectToString.call(e);return n&&(t?e[symToStringTag]=r:delete e[symToStringTag]),o}var _getRawTag=getRawTag,objectProto$1=Object.prototype,nativeObjectToString$1=objectProto$1.toString;function objectToString(e){return nativeObjectToString$1.call(e)}var _objectToString=objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag$1=_Symbol?_Symbol.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag$1&&symToStringTag$1 in Object(e)?_getRawTag(e):_objectToString(e)}var _baseGetTag=baseGetTag;function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var isObject_1=isObject,asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(e){if(!isObject_1(e))return!1;var t=_baseGetTag(e);return t==funcTag||t==genTag||t==asyncTag||t==proxyTag}var isFunction_1=isFunction,coreJsData=_root["__core-js_shared__"],_coreJsData=coreJsData,maskSrcKey=(uid=/[^.]+$/.exec(_coreJsData&&_coreJsData.keys&&_coreJsData.keys.IE_PROTO||""),uid?"Symbol(src)_1."+uid:""),uid;function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked,funcProto=Function.prototype,funcToString=funcProto.toString;function toSource(e){if(null!=e){try{return funcToString.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var _toSource=toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$2=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$1=objectProto$2.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$1).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject_1(e)||_isMasked(e))&&(isFunction_1(e)?reIsNative:reIsHostCtor).test(_toSource(e))}var _baseIsNative=baseIsNative;function getValue(e,t){return null==e?void 0:e[t]}var _getValue=getValue;function getNative(e,t){var r=_getValue(e,t);return _baseIsNative(r)?r:void 0}var _getNative=getNative,defineProperty=function(){try{var e=_getNative(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),_defineProperty=defineProperty;function baseAssignValue(e,t,r){"__proto__"==t&&_defineProperty?_defineProperty(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var _baseAssignValue=baseAssignValue;function createBaseFor(e){return function(t,r,n){for(var o=-1,a=Object(t),c=n(t),l=c.length;l--;){var u=c[e?l:++o];if(!1===r(a[u],u,a))break}return t}}var _createBaseFor=createBaseFor,baseFor=_createBaseFor(),_baseFor=baseFor;function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes;function isObjectLike(e){return null!=e&&"object"==typeof e}var isObjectLike_1=isObjectLike,argsTag="[object Arguments]";function baseIsArguments(e){return isObjectLike_1(e)&&_baseGetTag(e)==argsTag}var _baseIsArguments=baseIsArguments,objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,isArguments=_baseIsArguments(function(){return arguments}())?_baseIsArguments:function(e){return isObjectLike_1(e)&&hasOwnProperty$2.call(e,"callee")&&!propertyIsEnumerable.call(e,"callee")},isArguments_1=isArguments,isArray=Array.isArray,isArray_1=isArray;function stubFalse(){return!1}var stubFalse_1=stubFalse,isBuffer_1=createCommonjsModule((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?_root.Buffer:void 0,a=(o?o.isBuffer:void 0)||stubFalse_1;e.exports=a})),MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var r=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex,MAX_SAFE_INTEGER$1=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$1}var isLength_1=isLength,argsTag$1="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag$1="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike_1(e)&&isLength_1(e.length)&&!!typedArrayTags[_baseGetTag(e)]}typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var _baseIsTypedArray=baseIsTypedArray;function baseUnary(e){return function(t){return e(t)}}var _baseUnary=baseUnary,isTypedArray=_baseIsTypedArray,isTypedArray_1=isTypedArray,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function arrayLikeKeys(e,t){var r=isArray_1(e),n=!r&&isArguments_1(e),o=!r&&!n&&isBuffer_1(e),a=!r&&!n&&!o&&isTypedArray_1(e),c=r||n||o||a,l=c?_baseTimes(e.length,String):[],u=l.length;for(var _ in e)!t&&!hasOwnProperty$3.call(e,_)||c&&("length"==_||o&&("offset"==_||"parent"==_)||a&&("buffer"==_||"byteLength"==_||"byteOffset"==_)||_isIndex(_,u))||l.push(_);return l}var _arrayLikeKeys=arrayLikeKeys,objectProto$5=Object.prototype;function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$5)}var _isPrototype=isPrototype;function overArg(e,t){return function(r){return e(t(r))}}var _overArg=overArg,nativeKeys=_overArg(Object.keys,Object),_nativeKeys=nativeKeys,objectProto$6=Object.prototype,hasOwnProperty$4=objectProto$6.hasOwnProperty;function baseKeys(e){if(!_isPrototype(e))return _nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$4.call(e,r)&&"constructor"!=r&&t.push(r);return t}var _baseKeys=baseKeys;function isArrayLike$1(e){return null!=e&&isLength_1(e.length)&&!isFunction_1(e)}var isArrayLike_1=isArrayLike$1;function keys(e){return isArrayLike_1(e)?_arrayLikeKeys(e):_baseKeys(e)}var keys_1=keys;function baseForOwn(e,t){return e&&_baseFor(e,t,keys_1)}var _baseForOwn=baseForOwn;function listCacheClear(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear;function eq(e,t){return e===t||e!=e&&t!=t}var eq_1=eq;function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq_1(e[r][0],t))return r;return-1}var _assocIndexOf=assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,r=_assocIndexOf(t,e);return!(r<0)&&(r==t.length-1?t.pop():splice.call(t,r,1),--this.size,!0)}var _listCacheDelete=listCacheDelete;function listCacheGet(e){var t=this.__data__,r=_assocIndexOf(t,e);return r<0?void 0:t[r][1]}var _listCacheGet=listCacheGet;function listCacheHas(e){return _assocIndexOf(this.__data__,e)>-1}var _listCacheHas=listCacheHas;function listCacheSet(e,t){var r=this.__data__,n=_assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var _listCacheSet=listCacheSet;function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache.prototype.clear=_listCacheClear,ListCache.prototype.delete=_listCacheDelete,ListCache.prototype.get=_listCacheGet,ListCache.prototype.has=_listCacheHas,ListCache.prototype.set=_listCacheSet;var _ListCache=ListCache;function stackClear(){this.__data__=new _ListCache,this.size=0}var _stackClear=stackClear;function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var _stackDelete=stackDelete;function stackGet(e){return this.__data__.get(e)}var _stackGet=stackGet;function stackHas(e){return this.__data__.has(e)}var _stackHas=stackHas,Map$1=_getNative(_root,"Map"),_Map=Map$1,nativeCreate=_getNative(Object,"create"),_nativeCreate=nativeCreate;function hashClear(){this.__data__=_nativeCreate?_nativeCreate(null):{},this.size=0}var _hashClear=hashClear;function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _hashDelete=hashDelete,HASH_UNDEFINED="__lodash_hash_undefined__",objectProto$7=Object.prototype,hasOwnProperty$5=objectProto$7.hasOwnProperty;function hashGet(e){var t=this.__data__;if(_nativeCreate){var r=t[e];return r===HASH_UNDEFINED?void 0:r}return hasOwnProperty$5.call(t,e)?t[e]:void 0}var _hashGet=hashGet,objectProto$8=Object.prototype,hasOwnProperty$6=objectProto$8.hasOwnProperty;function hashHas(e){var t=this.__data__;return _nativeCreate?void 0!==t[e]:hasOwnProperty$6.call(t,e)}var _hashHas=hashHas,HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=_nativeCreate&&void 0===t?HASH_UNDEFINED$1:t,this}var _hashSet=hashSet;function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash.prototype.clear=_hashClear,Hash.prototype.delete=_hashDelete,Hash.prototype.get=_hashGet,Hash.prototype.has=_hashHas,Hash.prototype.set=_hashSet;var _Hash=Hash;function mapCacheClear(){this.size=0,this.__data__={hash:new _Hash,map:new(_Map||_ListCache),string:new _Hash}}var _mapCacheClear=mapCacheClear;function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}var _isKeyable=isKeyable;function getMapData(e,t){var r=e.__data__;return _isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}var _getMapData=getMapData;function mapCacheDelete(e){var t=_getMapData(this,e).delete(e);return this.size-=t?1:0,t}var _mapCacheDelete=mapCacheDelete;function mapCacheGet(e){return _getMapData(this,e).get(e)}var _mapCacheGet=mapCacheGet;function mapCacheHas(e){return _getMapData(this,e).has(e)}var _mapCacheHas=mapCacheHas;function mapCacheSet(e,t){var r=_getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var _mapCacheSet=mapCacheSet;function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache.prototype.clear=_mapCacheClear,MapCache.prototype.delete=_mapCacheDelete,MapCache.prototype.get=_mapCacheGet,MapCache.prototype.has=_mapCacheHas,MapCache.prototype.set=_mapCacheSet;var _MapCache=MapCache,LARGE_ARRAY_SIZE=200;function stackSet(e,t){var r=this.__data__;if(r instanceof _ListCache){var n=r.__data__;if(!_Map||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new _MapCache(n)}return r.set(e,t),this.size=r.size,this}var _stackSet=stackSet;function Stack(e){var t=this.__data__=new _ListCache(e);this.size=t.size}Stack.prototype.clear=_stackClear,Stack.prototype.delete=_stackDelete,Stack.prototype.get=_stackGet,Stack.prototype.has=_stackHas,Stack.prototype.set=_stackSet;var _Stack=Stack,HASH_UNDEFINED$2="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED$2),this}var _setCacheAdd=setCacheAdd;function setCacheHas(e){return this.__data__.has(e)}var _setCacheHas=setCacheHas;function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new _MapCache;++t<r;)this.add(e[t])}SetCache.prototype.add=SetCache.prototype.push=_setCacheAdd,SetCache.prototype.has=_setCacheHas;var _SetCache=SetCache;function arraySome(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var _arraySome=arraySome;function cacheHas(e,t){return e.has(t)}var _cacheHas=cacheHas,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function equalArrays(e,t,r,n,o,a){var c=r&COMPARE_PARTIAL_FLAG,l=e.length,u=t.length;if(l!=u&&!(c&&u>l))return!1;var _=a.get(e),p=a.get(t);if(_&&p)return _==t&&p==e;var f=-1,E=!0,g=r&COMPARE_UNORDERED_FLAG?new _SetCache:void 0;for(a.set(e,t),a.set(t,e);++f<l;){var b=e[f],v=t[f];if(n)var T=c?n(v,b,f,t,e,a):n(b,v,f,e,t,a);if(void 0!==T){if(T)continue;E=!1;break}if(g){if(!_arraySome(t,(function(e,t){if(!_cacheHas(g,t)&&(b===e||o(b,e,r,n,a)))return g.push(t)}))){E=!1;break}}else if(b!==v&&!o(b,v,r,n,a)){E=!1;break}}return a.delete(e),a.delete(t),E}var _equalArrays=equalArrays,Uint8Array$1=_root.Uint8Array,_Uint8Array=Uint8Array$1;function mapToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}var _mapToArray=mapToArray;function setToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var _setToArray=setToArray,COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2,boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",mapTag$1="[object Map]",numberTag$1="[object Number]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$1="[object String]",symbolTag="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",symbolProto=_Symbol?_Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(e,t,r,n,o,a,c){switch(r){case dataViewTag$1:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag$1:return!(e.byteLength!=t.byteLength||!a(new _Uint8Array(e),new _Uint8Array(t)));case boolTag$1:case dateTag$1:case numberTag$1:return eq_1(+e,+t);case errorTag$1:return e.name==t.name&&e.message==t.message;case regexpTag$1:case stringTag$1:return e==t+"";case mapTag$1:var l=_mapToArray;case setTag$1:var u=n&COMPARE_PARTIAL_FLAG$1;if(l||(l=_setToArray),e.size!=t.size&&!u)return!1;var _=c.get(e);if(_)return _==t;n|=COMPARE_UNORDERED_FLAG$1,c.set(e,t);var p=_equalArrays(l(e),l(t),n,o,a,c);return c.delete(e),p;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var _equalByTag=equalByTag;function arrayPush(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}var _arrayPush=arrayPush;function baseGetAllKeys(e,t,r){var n=t(e);return isArray_1(e)?n:_arrayPush(n,r(e))}var _baseGetAllKeys=baseGetAllKeys;function arrayFilter(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var c=e[r];t(c,r,e)&&(a[o++]=c)}return a}var _arrayFilter=arrayFilter;function stubArray(){return[]}var stubArray_1=stubArray,objectProto$9=Object.prototype,propertyIsEnumerable$1=objectProto$9.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols?function(e){return null==e?[]:(e=Object(e),_arrayFilter(nativeGetSymbols(e),(function(t){return propertyIsEnumerable$1.call(e,t)})))}:stubArray_1,_getSymbols=getSymbols;function getAllKeys(e){return _baseGetAllKeys(e,keys_1,_getSymbols)}var _getAllKeys=getAllKeys,COMPARE_PARTIAL_FLAG$2=1,objectProto$a=Object.prototype,hasOwnProperty$7=objectProto$a.hasOwnProperty;function equalObjects(e,t,r,n,o,a){var c=r&COMPARE_PARTIAL_FLAG$2,l=_getAllKeys(e),u=l.length;if(u!=_getAllKeys(t).length&&!c)return!1;for(var _=u;_--;){var p=l[_];if(!(c?p in t:hasOwnProperty$7.call(t,p)))return!1}var f=a.get(e),E=a.get(t);if(f&&E)return f==t&&E==e;var g=!0;a.set(e,t),a.set(t,e);for(var b=c;++_<u;){var v=e[p=l[_]],T=t[p];if(n)var I=c?n(T,v,p,t,e,a):n(v,T,p,e,t,a);if(!(void 0===I?v===T||o(v,T,r,n,a):I)){g=!1;break}b||(b="constructor"==p)}if(g&&!b){var O=e.constructor,A=t.constructor;O==A||!("constructor"in e)||!("constructor"in t)||"function"==typeof O&&O instanceof O&&"function"==typeof A&&A instanceof A||(g=!1)}return a.delete(e),a.delete(t),g}var _equalObjects=equalObjects,DataView=_getNative(_root,"DataView"),_DataView=DataView,Promise$1=_getNative(_root,"Promise"),_Promise=Promise$1,Set$1=_getNative(_root,"Set"),_Set=Set$1,WeakMap=_getNative(_root,"WeakMap"),_WeakMap=WeakMap,mapTag$2="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag$2="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$2="[object DataView]",dataViewCtorString=_toSource(_DataView),mapCtorString=_toSource(_Map),promiseCtorString=_toSource(_Promise),setCtorString=_toSource(_Set),weakMapCtorString=_toSource(_WeakMap),getTag=_baseGetTag;(_DataView&&getTag(new _DataView(new ArrayBuffer(1)))!=dataViewTag$2||_Map&&getTag(new _Map)!=mapTag$2||_Promise&&getTag(_Promise.resolve())!=promiseTag||_Set&&getTag(new _Set)!=setTag$2||_WeakMap&&getTag(new _WeakMap)!=weakMapTag$1)&&(getTag=function(e){var t=_baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,n=r?_toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag$2;case mapCtorString:return mapTag$2;case promiseCtorString:return promiseTag;case setCtorString:return setTag$2;case weakMapCtorString:return weakMapTag$1}return t});var _getTag=getTag,COMPARE_PARTIAL_FLAG$3=1,argsTag$2="[object Arguments]",arrayTag$1="[object Array]",objectTag$2="[object Object]",objectProto$b=Object.prototype,hasOwnProperty$8=objectProto$b.hasOwnProperty;function baseIsEqualDeep(e,t,r,n,o,a){var c=isArray_1(e),l=isArray_1(t),u=c?arrayTag$1:_getTag(e),_=l?arrayTag$1:_getTag(t),p=(u=u==argsTag$2?objectTag$2:u)==objectTag$2,f=(_=_==argsTag$2?objectTag$2:_)==objectTag$2,E=u==_;if(E&&isBuffer_1(e)){if(!isBuffer_1(t))return!1;c=!0,p=!1}if(E&&!p)return a||(a=new _Stack),c||isTypedArray_1(e)?_equalArrays(e,t,r,n,o,a):_equalByTag(e,t,u,r,n,o,a);if(!(r&COMPARE_PARTIAL_FLAG$3)){var g=p&&hasOwnProperty$8.call(e,"__wrapped__"),b=f&&hasOwnProperty$8.call(t,"__wrapped__");if(g||b){var v=g?e.value():e,T=b?t.value():t;return a||(a=new _Stack),o(v,T,r,n,a)}}return!!E&&(a||(a=new _Stack),_equalObjects(e,t,r,n,o,a))}var _baseIsEqualDeep=baseIsEqualDeep;function baseIsEqual(e,t,r,n,o){return e===t||(null==e||null==t||!isObjectLike_1(e)&&!isObjectLike_1(t)?e!=e&&t!=t:_baseIsEqualDeep(e,t,r,n,baseIsEqual,o))}var _baseIsEqual=baseIsEqual,COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2;function baseIsMatch(e,t,r,n){var o=r.length,a=o,c=!n;if(null==e)return!a;for(e=Object(e);o--;){var l=r[o];if(c&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<a;){var u=(l=r[o])[0],_=e[u],p=l[1];if(c&&l[2]){if(void 0===_&&!(u in e))return!1}else{var f=new _Stack;if(n)var E=n(_,p,u,e,t,f);if(!(void 0===E?_baseIsEqual(p,_,COMPARE_PARTIAL_FLAG$4|COMPARE_UNORDERED_FLAG$2,n,f):E))return!1}}return!0}var _baseIsMatch=baseIsMatch;function isStrictComparable(e){return e==e&&!isObject_1(e)}var _isStrictComparable=isStrictComparable;function getMatchData(e){for(var t=keys_1(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,_isStrictComparable(o)]}return t}var _getMatchData=getMatchData;function matchesStrictComparable(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}var _matchesStrictComparable=matchesStrictComparable;function baseMatches(e){var t=_getMatchData(e);return 1==t.length&&t[0][2]?_matchesStrictComparable(t[0][0],t[0][1]):function(r){return r===e||_baseIsMatch(r,e,t)}}var _baseMatches=baseMatches,symbolTag$1="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike_1(e)&&_baseGetTag(e)==symbolTag$1}var isSymbol_1=isSymbol,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){if(isArray_1(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!isSymbol_1(e))||(reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}var _isKey=isKey,FUNC_ERROR_TEXT="Expected a function";function memoize(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var c=e.apply(this,n);return r.cache=a.set(o,c)||a,c};return r.cache=new(memoize.Cache||_MapCache),r}memoize.Cache=_MapCache;var memoize_1=memoize,MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var t=memoize_1(e,(function(e){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),e})),r=t.cache;return t}var _memoizeCapped=memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=_memoizeCapped((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,(function(e,r,n,o){t.push(n?o.replace(reEscapeChar,"$1"):r||e)})),t})),_stringToPath=stringToPath;function arrayMap(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}var _arrayMap=arrayMap,INFINITY=1/0,symbolProto$1=_Symbol?_Symbol.prototype:void 0,symbolToString=symbolProto$1?symbolProto$1.toString:void 0;function baseToString(e){if("string"==typeof e)return e;if(isArray_1(e))return _arrayMap(e,baseToString)+"";if(isSymbol_1(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY?"-0":t}var _baseToString=baseToString;function toString(e){return null==e?"":_baseToString(e)}var toString_1=toString;function castPath(e,t){return isArray_1(e)?e:_isKey(e,t)?[e]:_stringToPath(toString_1(e))}var _castPath=castPath,INFINITY$1=1/0;function toKey(e){if("string"==typeof e||isSymbol_1(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY$1?"-0":t}var _toKey=toKey;function baseGet(e,t){for(var r=0,n=(t=_castPath(t,e)).length;null!=e&&r<n;)e=e[_toKey(t[r++])];return r&&r==n?e:void 0}var _baseGet=baseGet;function get(e,t,r){var n=null==e?void 0:_baseGet(e,t);return void 0===n?r:n}var get_1=get;function baseHasIn(e,t){return null!=e&&t in Object(e)}var _baseHasIn=baseHasIn;function hasPath(e,t,r){for(var n=-1,o=(t=_castPath(t,e)).length,a=!1;++n<o;){var c=_toKey(t[n]);if(!(a=null!=e&&r(e,c)))break;e=e[c]}return a||++n!=o?a:!!(o=null==e?0:e.length)&&isLength_1(o)&&_isIndex(c,o)&&(isArray_1(e)||isArguments_1(e))}var _hasPath=hasPath;function hasIn(e,t){return null!=e&&_hasPath(e,t,_baseHasIn)}var hasIn_1=hasIn,COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function baseMatchesProperty(e,t){return _isKey(e)&&_isStrictComparable(t)?_matchesStrictComparable(_toKey(e),t):function(r){var n=get_1(r,e);return void 0===n&&n===t?hasIn_1(r,e):_baseIsEqual(t,n,COMPARE_PARTIAL_FLAG$5|COMPARE_UNORDERED_FLAG$3)}}var _baseMatchesProperty=baseMatchesProperty;function identity(e){return e}var identity_1=identity;function baseProperty(e){return function(t){return null==t?void 0:t[e]}}var _baseProperty=baseProperty;function basePropertyDeep(e){return function(t){return _baseGet(t,e)}}var _basePropertyDeep=basePropertyDeep;function property(e){return _isKey(e)?_baseProperty(_toKey(e)):_basePropertyDeep(e)}var property_1=property;function baseIteratee(e){return"function"==typeof e?e:null==e?identity_1:"object"==typeof e?isArray_1(e)?_baseMatchesProperty(e[0],e[1]):_baseMatches(e):property_1(e)}var _baseIteratee=baseIteratee;function mapValues(e,t){var r={};return t=_baseIteratee(t),_baseForOwn(e,(function(e,n,o){_baseAssignValue(r,n,t(e,n,o))})),r}var mapValues_1=mapValues,long_1=Long;function Long(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function isLong(e){return!0===(e&&e.__isLong__)}Long.prototype.__isLong__,Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(e,t){var r,n,o;return t?(o=0<=(e>>>=0)&&e<256)&&(n=UINT_CACHE[e])?n:(r=fromBits(e,(0|e)<0?-1:0,!0),o&&(UINT_CACHE[e]=r),r):(o=-128<=(e|=0)&&e<128)&&(n=INT_CACHE[e])?n:(r=fromBits(e,e<0?-1:0,!1),o&&(INT_CACHE[e]=r),r)}function fromNumber(e,t){if(isNaN(e))return t?UZERO:ZERO;if(t){if(e<0)return UZERO;if(e>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(e<=-TWO_PWR_63_DBL)return MIN_VALUE;if(e+1>=TWO_PWR_63_DBL)return MAX_VALUE}return e<0?fromNumber(-e,t).neg():fromBits(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0,t)}function fromBits(e,t,r){return new Long(e,t,r)}Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return ZERO;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return fromString(e.substring(1),t,r).neg();for(var o=fromNumber(pow_dbl(r,8)),a=ZERO,c=0;c<e.length;c+=8){var l=Math.min(8,e.length-c),u=parseInt(e.substring(c,c+l),r);if(l<8){var _=fromNumber(pow_dbl(r,l));a=a.mul(_).add(fromNumber(u))}else a=(a=a.mul(o)).add(fromNumber(u))}return a.unsigned=t,a}function fromValue(e,t){return"number"==typeof e?fromNumber(e,t):"string"==typeof e?fromString(e,t):fromBits(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Long.fromString=fromString,Long.fromValue=fromValue;var TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)},LongPrototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var t=fromNumber(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var o=fromNumber(pow_dbl(e,6),this.unsigned),a=this,c="";;){var l=a.div(o),u=(a.sub(l.mul(o)).toInt()>>>0).toString(e);if((a=l).isZero())return u+c;for(;u.length<6;)u="0"+u;c=""+u+c}},LongPrototype.getHighBits=function(){return this.high},LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0},LongPrototype.getLowBits=function(){return this.low},LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0},LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},LongPrototype.isZero=function(){return 0===this.high&&0===this.low},LongPrototype.eqz=LongPrototype.isZero,LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0},LongPrototype.isPositive=function(){return this.unsigned||this.high>=0},LongPrototype.isOdd=function(){return 1==(1&this.low)},LongPrototype.isEven=function(){return 0==(1&this.low)},LongPrototype.equals=function(e){return isLong(e)||(e=fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},LongPrototype.eq=LongPrototype.equals,LongPrototype.notEquals=function(e){return!this.eq(e)},LongPrototype.neq=LongPrototype.notEquals,LongPrototype.ne=LongPrototype.notEquals,LongPrototype.lessThan=function(e){return this.comp(e)<0},LongPrototype.lt=LongPrototype.lessThan,LongPrototype.lessThanOrEqual=function(e){return this.comp(e)<=0},LongPrototype.lte=LongPrototype.lessThanOrEqual,LongPrototype.le=LongPrototype.lessThanOrEqual,LongPrototype.greaterThan=function(e){return this.comp(e)>0},LongPrototype.gt=LongPrototype.greaterThan,LongPrototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},LongPrototype.gte=LongPrototype.greaterThanOrEqual,LongPrototype.ge=LongPrototype.greaterThanOrEqual,LongPrototype.compare=function(e){if(isLong(e)||(e=fromValue(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},LongPrototype.comp=LongPrototype.compare,LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)},LongPrototype.neg=LongPrototype.negate,LongPrototype.add=function(e){isLong(e)||(e=fromValue(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,a=e.high>>>16,c=65535&e.high,l=e.low>>>16,u=0,_=0,p=0,f=0;return p+=(f+=o+(65535&e.low))>>>16,_+=(p+=n+l)>>>16,u+=(_+=r+c)>>>16,u+=t+a,fromBits((p&=65535)<<16|(f&=65535),(u&=65535)<<16|(_&=65535),this.unsigned)},LongPrototype.subtract=function(e){return isLong(e)||(e=fromValue(e)),this.add(e.neg())},LongPrototype.sub=LongPrototype.subtract,LongPrototype.multiply=function(e){if(this.isZero())return ZERO;if(isLong(e)||(e=fromValue(e)),e.isZero())return ZERO;if(this.eq(MIN_VALUE))return e.isOdd()?MIN_VALUE:ZERO;if(e.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(TWO_PWR_24)&&e.lt(TWO_PWR_24))return fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,a=e.high>>>16,c=65535&e.high,l=e.low>>>16,u=65535&e.low,_=0,p=0,f=0,E=0;return f+=(E+=o*u)>>>16,p+=(f+=n*u)>>>16,f&=65535,p+=(f+=o*l)>>>16,_+=(p+=r*u)>>>16,p&=65535,_+=(p+=n*l)>>>16,p&=65535,_+=(p+=o*c)>>>16,_+=t*u+r*l+n*c+o*a,fromBits((f&=65535)<<16|(E&=65535),(_&=65535)<<16|(p&=65535),this.unsigned)},LongPrototype.mul=LongPrototype.multiply,LongPrototype.divide=function(e){if(isLong(e)||(e=fromValue(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?UZERO:ZERO;var t,r,n;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return UZERO;if(e.gt(this.shru(1)))return UONE;n=UZERO}else{if(this.eq(MIN_VALUE))return e.eq(ONE)||e.eq(NEG_ONE)?MIN_VALUE:e.eq(MIN_VALUE)?ONE:(t=this.shr(1).div(e).shl(1)).eq(ZERO)?e.isNegative()?ONE:NEG_ONE:(r=this.sub(e.mul(t)),n=t.add(r.div(e)));if(e.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();n=ZERO}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),a=o<=48?1:pow_dbl(2,o-48),c=fromNumber(t),l=c.mul(e);l.isNegative()||l.gt(r);)l=(c=fromNumber(t-=a,this.unsigned)).mul(e);c.isZero()&&(c=ONE),n=n.add(c),r=r.sub(l)}return n},LongPrototype.div=LongPrototype.divide,LongPrototype.modulo=function(e){return isLong(e)||(e=fromValue(e)),this.sub(this.div(e).mul(e))},LongPrototype.mod=LongPrototype.modulo,LongPrototype.rem=LongPrototype.modulo,LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},LongPrototype.and=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low&e.low,this.high&e.high,this.unsigned)},LongPrototype.or=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low|e.low,this.high|e.high,this.unsigned)},LongPrototype.xor=function(e){return isLong(e)||(e=fromValue(e)),fromBits(this.low^e.low,this.high^e.high,this.unsigned)},LongPrototype.shiftLeft=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):fromBits(0,this.low<<e-32,this.unsigned)},LongPrototype.shl=LongPrototype.shiftLeft,LongPrototype.shiftRight=function(e){return isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},LongPrototype.shr=LongPrototype.shiftRight,LongPrototype.shiftRightUnsigned=function(e){if(isLong(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?fromBits(this.low>>>e|t<<32-e,t>>>e,this.unsigned):fromBits(32===e?t:t>>>e-32,0,this.unsigned)},LongPrototype.shru=LongPrototype.shiftRightUnsigned,LongPrototype.shr_u=LongPrototype.shiftRightUnsigned,LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},LongPrototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},LongPrototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},LongPrototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Long.fromBytes=function(e,t,r){return r?Long.fromBytesLE(e,t):Long.fromBytesBE(e,t)},Long.fromBytesLE=function(e,t){return new Long(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Long.fromBytesBE=function(e,t){return new Long(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};

var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function isFunction$1(e){return"function"==typeof e}var _enable_super_gross_mode_that_will_cause_bad_things=!1,config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;_enable_super_gross_mode_that_will_cause_bad_things=e},get useDeprecatedSynchronousErrorHandling(){return _enable_super_gross_mode_that_will_cause_bad_things}};function hostReportError(e){setTimeout((function(){throw e}),0)}var empty={closed:!0,next:function(e){},error:function(e){if(config.useDeprecatedSynchronousErrorHandling)throw e;hostReportError(e)},complete:function(){}},isArray$1=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();function isObject$1(e){return null!==e&&"object"==typeof e}var UnsubscriptionErrorImpl=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),UnsubscriptionError=UnsubscriptionErrorImpl,Subscription=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,o=r._ctorUnsubscribe,a=r._unsubscribe,c=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var l=0;l<n.length;++l){n[l].remove(this)}if(isFunction$1(a)){o&&(this._unsubscribe=void 0);try{a.call(this)}catch(e){t=e instanceof UnsubscriptionError?flattenUnsubscriptionErrors(e.errors):[e]}}if(isArray$1(c)){l=-1;for(var u=c.length;++l<u;){var _=c[l];if(isObject$1(_))try{_.unsubscribe()}catch(e){t=t||[],e instanceof UnsubscriptionError?t=t.concat(flattenUnsubscriptionErrors(e.errors)):t.push(e)}}}if(t)throw new UnsubscriptionError(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;(r=new e)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof e){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var a=this._subscriptions;return null===a?this._subscriptions=[r]:a.push(r),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function flattenUnsubscriptionErrors(e){return e.reduce((function(e,t){return e.concat(t instanceof UnsubscriptionError?t.errors:t)}),[])}var rxSubscriber=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Subscriber=function(e){function t(r,n,o){var a=e.call(this)||this;switch(a.syncErrorValue=null,a.syncErrorThrown=!1,a.syncErrorThrowable=!1,a.isStopped=!1,arguments.length){case 0:a.destination=empty;break;case 1:if(!r){a.destination=empty;break}if("object"==typeof r){r instanceof t?(a.syncErrorThrowable=r.syncErrorThrowable,a.destination=r,r.add(a)):(a.syncErrorThrowable=!0,a.destination=new SafeSubscriber(a,r));break}default:a.syncErrorThrowable=!0,a.destination=new SafeSubscriber(a,r,n,o)}return a}return __extends(t,e),t.prototype[rxSubscriber]=function(){return this},t.create=function(e,r,n){var o=new t(e,r,n);return o.syncErrorThrowable=!1,o},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(Subscription),SafeSubscriber=function(e){function t(t,r,n,o){var a,c=e.call(this)||this;c._parentSubscriber=t;var l=c;return isFunction$1(r)?a=r:r&&(a=r.next,n=r.error,o=r.complete,r!==empty&&(isFunction$1((l=Object.create(r)).unsubscribe)&&c.add(l.unsubscribe.bind(l)),l.unsubscribe=c.unsubscribe.bind(c))),c._context=l,c._next=a,c._error=n,c._complete=o,c}return __extends(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,r=config.useDeprecatedSynchronousErrorHandling;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):hostReportError(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;hostReportError(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),config.useDeprecatedSynchronousErrorHandling)throw e;hostReportError(e)}},t.prototype.__tryOrSetError=function(e,t,r){if(!config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(t){return config.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(hostReportError(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(Subscriber);function canReportError(e){for(;e;){var t=e,r=t.closed,n=t.destination,o=t.isStopped;if(r||o)return!1;e=n&&n instanceof Subscriber?n:null}return!0}function toSubscriber(e,t,r){if(e){if(e instanceof Subscriber)return e;if(e[rxSubscriber])return e[rxSubscriber]()}return e||t||r?new Subscriber(e,t,r):new Subscriber(empty)}var observable=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function identity$1(e){return e}function pipe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return pipeFromArray(e)}function pipeFromArray(e){return 0===e.length?identity$1:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Observable=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this.operator,o=toSubscriber(e,t,r);if(n?o.add(n.call(o,this.source)):o.add(this.source||config.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),config.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),canReportError(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=getPromiseCtor(t))((function(t,n){var o;o=r.subscribe((function(t){try{e(t)}catch(e){n(e),o&&o.unsubscribe()}}),n,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=getPromiseCtor(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function getPromiseCtor(e){if(e||(e=Promise),!e)throw new Error("no Promise impl found");return e}var ObjectUnsubscribedErrorImpl=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),ObjectUnsubscribedError=ObjectUnsubscribedErrorImpl,SubjectSubscription=function(e){function t(t,r){var n=e.call(this)||this;return n.subject=t,n.subscriber=r,n.closed=!1,n}return __extends(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}},t}(Subscription),SubjectSubscriber=function(e){function t(t){var r=e.call(this,t)||this;return r.destination=t,r}return __extends(t,e),t}(Subscriber),Subject=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return __extends(t,e),t.prototype[rxSubscriber]=function(){return new SubjectSubscriber(this)},t.prototype.lift=function(e){var t=new AnonymousSubject(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,r=t.length,n=t.slice(),o=0;o<r;o++)n[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,r=t.length,n=t.slice(),o=0;o<r;o++)n[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,r=e.slice(),n=0;n<t;n++)r[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),Subscription.EMPTY):this.isStopped?(e.complete(),Subscription.EMPTY):(this.observers.push(e),new SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new Observable;return e.source=this,e},t.create=function(e,t){return new AnonymousSubject(e,t)},t}(Observable),AnonymousSubject=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return __extends(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Subscription.EMPTY},t}(Subject);function refCount(){return function(e){return e.lift(new RefCountOperator(e))}}var RefCountOperator=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var r=this.connectable;r._refCount++;var n=new RefCountSubscriber(e,r),o=t.subscribe(n);return n.closed||(n.connection=r.connect()),o},e}(),RefCountSubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.connectable=r,n}return __extends(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var r=this.connection,n=e._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}else this.connection=null},t}(Subscriber),ConnectableObservable=function(e){function t(t,r){var n=e.call(this)||this;return n.source=t,n.subjectFactory=r,n._refCount=0,n._isComplete=!1,n}return __extends(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new Subscription).add(this.source.subscribe(new ConnectableSubscriber(this.getSubject(),this))),e.closed&&(this._connection=null,e=Subscription.EMPTY)),e},t.prototype.refCount=function(){return refCount()(this)},t}(Observable),connectableObservableDescriptor=function(){var e=ConnectableObservable.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),ConnectableSubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.connectable=r,n}return __extends(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(SubjectSubscriber),Action=function(e){function t(t,r){return e.call(this)||this}return __extends(t,e),t.prototype.schedule=function(e,t){return this},t}(Subscription),AsyncAction=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return __extends(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,n=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(n,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0!==r&&0!==r||(r=1),setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!==r&&this.delay===r&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r=!1,n=void 0;try{this.work(e)}catch(e){r=!0,n=!!e&&e||new Error(e)}if(r)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,r=t.actions,n=r.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==n&&r.splice(n,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(Action),QueueAction=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n}return __extends(t,e),t.prototype.schedule=function(t,r){return void 0===r&&(r=0),r>0?e.prototype.schedule.call(this,t,r):(this.delay=r,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,r){return r>0||this.closed?e.prototype.execute.call(this,t,r):this._execute(t,r)},t.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0?e.prototype.requestAsyncId.call(this,t,r,n):t.flush(this)},t}(AsyncAction),Scheduler=function(){function e(t,r){void 0===r&&(r=e.now),this.SchedulerAction=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(r,t)},e.now=function(){return Date.now()},e}(),AsyncScheduler=function(e){function t(r,n){void 0===n&&(n=Scheduler.now);var o=e.call(this,r,(function(){return t.delegate&&t.delegate!==o?t.delegate.now():n()}))||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return __extends(t,e),t.prototype.schedule=function(r,n,o){return void 0===n&&(n=0),t.delegate&&t.delegate!==this?t.delegate.schedule(r,n,o):e.prototype.schedule.call(this,r,n,o)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var r;this.active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},t}(Scheduler),QueueScheduler=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(AsyncScheduler),queueScheduler=new QueueScheduler(QueueAction),queue=queueScheduler,EMPTY=new Observable((function(e){return e.complete()}));function empty$1(e){return e?emptyScheduled(e):EMPTY}function emptyScheduled(e){return new Observable((function(t){return e.schedule((function(){return t.complete()}))}))}function isScheduler(e){return e&&"function"==typeof e.schedule}var subscribeToArray=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}};function scheduleArray(e,t){return new Observable((function(r){var n=new Subscription,o=0;return n.add(t.schedule((function(){o!==e.length?(r.next(e[o++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}function fromArray(e,t){return t?scheduleArray(e,t):new Observable(subscribeToArray(e))}function of(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[e.length-1];return isScheduler(r)?(e.pop(),scheduleArray(e,r)):fromArray(e)}function throwError(e,t){return new Observable(t?function(r){return t.schedule(dispatch,0,{error:e,subscriber:r})}:function(t){return t.error(e)})}function dispatch(e){var t=e.error;e.subscriber.error(t)}var Notification=function(){function e(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,r){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return r&&r()}},e.prototype.accept=function(e,t,r){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,r)},e.prototype.toObservable=function(){switch(this.kind){case"N":return of(this.value);case"E":return throwError(this.error);case"C":return empty$1()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();function observeOn(e,t){return void 0===t&&(t=0),function(r){return r.lift(new ObserveOnOperator(e,t))}}var ObserveOnOperator=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new ObserveOnSubscriber(e,this.scheduler,this.delay))},e}(),ObserveOnSubscriber=function(e){function t(t,r,n){void 0===n&&(n=0);var o=e.call(this,t)||this;return o.scheduler=r,o.delay=n,o}return __extends(t,e),t.dispatch=function(e){var t=e.notification,r=e.destination;t.observe(r),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new ObserveOnMessage(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Notification.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Notification.createComplete()),this.unsubscribe()},t}(Subscriber),ObserveOnMessage=function(){return function(e,t){this.notification=e,this.destination=t}}(),ReplaySubject=function(e){function t(t,r,n){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===r&&(r=Number.POSITIVE_INFINITY);var o=e.call(this)||this;return o.scheduler=n,o._events=[],o._infiniteTimeWindow=!1,o._bufferSize=t<1?1:t,o._windowTime=r<1?1:r,r===Number.POSITIVE_INFINITY?(o._infiniteTimeWindow=!0,o.next=o.nextInfiniteTimeWindow):o.next=o.nextTimeWindow,o}return __extends(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var r=this._events;r.push(t),r.length>this._bufferSize&&r.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new ReplayEvent(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,r=this._infiniteTimeWindow,n=r?this._events:this._trimBufferThenGetEvents(),o=this.scheduler,a=n.length;if(this.closed)throw new ObjectUnsubscribedError;if(this.isStopped||this.hasError?t=Subscription.EMPTY:(this.observers.push(e),t=new SubjectSubscription(this,e)),o&&e.add(e=new ObserveOnSubscriber(e,o)),r)for(var c=0;c<a&&!e.closed;c++)e.next(n[c]);else for(c=0;c<a&&!e.closed;c++)e.next(n[c].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,r=this._windowTime,n=this._events,o=n.length,a=0;a<o&&!(e-n[a].time<r);)a++;return o>t&&(a=Math.max(a,o-t)),a>0&&n.splice(0,a),n},t}(Subject),ReplayEvent=function(){return function(e,t){this.time=e,this.value=t}}(),nextHandle=1,RESOLVED=function(){return Promise.resolve()}(),activeHandles={};function findAndClearHandle(e){return e in activeHandles&&(delete activeHandles[e],!0)}var Immediate={setImmediate:function(e){var t=nextHandle++;return activeHandles[t]=!0,RESOLVED.then((function(){return findAndClearHandle(t)&&e()})),t},clearImmediate:function(e){findAndClearHandle(e)}},AsapAction=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n}return __extends(t,e),t.prototype.requestAsyncId=function(t,r,n){return void 0===n&&(n=0),null!==n&&n>0?e.prototype.requestAsyncId.call(this,t,r,n):(t.actions.push(this),t.scheduled||(t.scheduled=Immediate.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,r,n){if(void 0===n&&(n=0),null!==n&&n>0||null===n&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,r,n);0===t.actions.length&&(Immediate.clearImmediate(r),t.scheduled=void 0)},t}(AsyncAction),AsapScheduler=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,r=this.actions,n=-1,o=r.length;e=e||r.shift();do{if(t=e.execute(e.state,e.delay))break}while(++n<o&&(e=r.shift()));if(this.active=!1,t){for(;++n<o&&(e=r.shift());)e.unsubscribe();throw t}},t}(AsyncScheduler),asapScheduler=new AsapScheduler(AsapAction),asyncScheduler=new AsyncScheduler(AsyncAction),async=asyncScheduler;function noop(){}var ArgumentOutOfRangeErrorImpl=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),ArgumentOutOfRangeError=ArgumentOutOfRangeErrorImpl,EmptyErrorImpl=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),EmptyError=EmptyErrorImpl,TimeoutErrorImpl=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),TimeoutError=TimeoutErrorImpl;function map$1(e,t){return function(r){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new MapOperator(e,t))}}var MapOperator=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new MapSubscriber(e,this.project,this.thisArg))},e}(),MapSubscriber=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.project=r,o.count=0,o.thisArg=n||o,o}return __extends(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Subscriber),OuterSubscriber=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.notifyNext=function(e,t,r,n,o){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(Subscriber),InnerSubscriber=function(e){function t(t,r,n){var o=e.call(this)||this;return o.parent=t,o.outerValue=r,o.outerIndex=n,o.index=0,o}return __extends(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(Subscriber),subscribeToPromise=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,hostReportError),t}};function getSymbolIterator(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var iterator=getSymbolIterator(),subscribeToIterable=function(e){return function(t){for(var r=e[iterator]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t}},subscribeToObservable=function(e){return function(t){var r=e[observable]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(t)}},isArrayLike$2=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function isPromise(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var subscribeTo=function(e){if(e&&"function"==typeof e[observable])return subscribeToObservable(e);if(isArrayLike$2(e))return subscribeToArray(e);if(isPromise(e))return subscribeToPromise(e);if(e&&"function"==typeof e[iterator])return subscribeToIterable(e);var t=isObject$1(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function subscribeToResult(e,t,r,n,o){if(void 0===o&&(o=new InnerSubscriber(e,r,n)),!o.closed)return t instanceof Observable?t.subscribe(o):subscribeTo(t)(o)}function scheduleObservable(e,t){return new Observable((function(r){var n=new Subscription;return n.add(t.schedule((function(){var o=e[observable]();n.add(o.subscribe({next:function(e){n.add(t.schedule((function(){return r.next(e)})))},error:function(e){n.add(t.schedule((function(){return r.error(e)})))},complete:function(){n.add(t.schedule((function(){return r.complete()})))}}))}))),n}))}function schedulePromise(e,t){return new Observable((function(r){var n=new Subscription;return n.add(t.schedule((function(){return e.then((function(e){n.add(t.schedule((function(){r.next(e),n.add(t.schedule((function(){return r.complete()})))})))}),(function(e){n.add(t.schedule((function(){return r.error(e)})))}))}))),n}))}function scheduleIterable(e,t){if(!e)throw new Error("Iterable cannot be null");return new Observable((function(r){var n,o=new Subscription;return o.add((function(){n&&"function"==typeof n.return&&n.return()})),o.add(t.schedule((function(){n=e[iterator](),o.add(t.schedule((function(){if(!r.closed){var e,t;try{var o=n.next();e=o.value,t=o.done}catch(e){return void r.error(e)}t?r.complete():(r.next(e),this.schedule())}})))}))),o}))}function isInteropObservable(e){return e&&"function"==typeof e[observable]}function isIterable$1(e){return e&&"function"==typeof e[iterator]}function scheduled(e,t){if(null!=e){if(isInteropObservable(e))return scheduleObservable(e,t);if(isPromise(e))return schedulePromise(e,t);if(isArrayLike$2(e))return scheduleArray(e,t);if(isIterable$1(e)||"string"==typeof e)return scheduleIterable(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function from(e,t){return t?scheduled(e,t):e instanceof Observable?e:new Observable(subscribeTo(e))}var SimpleInnerSubscriber=function(e){function t(t){var r=e.call(this)||this;return r.parent=t,r}return __extends(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(Subscriber),SimpleOuterSubscriber=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(Subscriber);function innerSubscribe(e,t){if(!t.closed)return e instanceof Observable?e.subscribe(t):subscribeTo(e)(t)}function mergeMap(e,t,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof t?function(n){return n.pipe(mergeMap((function(r,n){return from(e(r,n)).pipe(map$1((function(e,o){return t(r,e,n,o)})))}),r))}:("number"==typeof t&&(r=t),function(t){return t.lift(new MergeMapOperator(e,r))})}var MergeMapOperator=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new MergeMapSubscriber(e,this.project,this.concurrent))},e}(),MergeMapSubscriber=function(e){function t(t,r,n){void 0===n&&(n=Number.POSITIVE_INFINITY);var o=e.call(this,t)||this;return o.project=r,o.concurrent=n,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return __extends(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new SimpleInnerSubscriber(this),r=this.destination;r.add(t);var n=innerSubscribe(e,t);n!==t&&r.add(n)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(SimpleOuterSubscriber);function mergeAll(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),mergeMap(identity$1,e)}function concatAll(){return mergeAll(1)}function concat(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return concatAll()(of.apply(void 0,e))}function defer(e){return new Observable((function(t){var r;try{r=e()}catch(e){return void t.error(e)}return(r?from(r):empty$1()).subscribe(t)}))}function fromEvent(e,t,r,n){return isFunction$1(r)&&(n=r,r=void 0),n?fromEvent(e,t,r).pipe(map$1((function(e){return isArray$1(e)?n.apply(void 0,e):n(e)}))):new Observable((function(n){setupSubscription(e,t,(function(e){arguments.length>1?n.next(Array.prototype.slice.call(arguments)):n.next(e)}),n,r)}))}function setupSubscription(e,t,r,n,o){var a;if(isEventTarget(e)){var c=e;e.addEventListener(t,r,o),a=function(){return c.removeEventListener(t,r,o)}}else if(isJQueryStyleEventEmitter(e)){var l=e;e.on(t,r),a=function(){return l.off(t,r)}}else if(isNodeStyleEventEmitter(e)){var u=e;e.addListener(t,r),a=function(){return u.removeListener(t,r)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var _=0,p=e.length;_<p;_++)setupSubscription(e[_],t,r,n,o)}n.add(a)}function isNodeStyleEventEmitter(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}function isJQueryStyleEventEmitter(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}function isEventTarget(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}function isNumeric(e){return!isArray$1(e)&&e-parseFloat(e)+1>=0}function interval(e,t){return void 0===e&&(e=0),void 0===t&&(t=async),(!isNumeric(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=async),new Observable((function(r){return r.add(t.schedule(dispatch$1,e,{subscriber:r,counter:0,period:e})),r}))}function dispatch$1(e){var t=e.subscriber,r=e.counter,n=e.period;t.next(r),this.schedule({subscriber:t,counter:r+1,period:n},n)}function merge(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Number.POSITIVE_INFINITY,n=null,o=e[e.length-1];return isScheduler(o)?(n=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(r=e.pop())):"number"==typeof o&&(r=e.pop()),null===n&&1===e.length&&e[0]instanceof Observable?e[0]:mergeAll(r)(fromArray(e,n))}function filter(e,t){return function(r){return r.lift(new FilterOperator(e,t))}}var FilterOperator=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new FilterSubscriber(e,this.predicate,this.thisArg))},e}(),FilterSubscriber=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.predicate=r,o.thisArg=n,o.count=0,o}return __extends(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(Subscriber);function race(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!isArray$1(e[0]))return e[0];e=e[0]}return fromArray(e,void 0).lift(new RaceOperator)}var RaceOperator=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new RaceSubscriber(e))},e}(),RaceSubscriber=function(e){function t(t){var r=e.call(this,t)||this;return r.hasFirst=!1,r.observables=[],r.subscriptions=[],r}return __extends(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var r=0;r<t&&!this.hasFirst;r++){var n=subscribeToResult(this,e[r],void 0,r);this.subscriptions&&this.subscriptions.push(n),this.add(n)}this.observables=null}},t.prototype.notifyNext=function(e,t,r){if(!this.hasFirst){this.hasFirst=!0;for(var n=0;n<this.subscriptions.length;n++)if(n!==r){var o=this.subscriptions[n];o.unsubscribe(),this.remove(o)}this.subscriptions=null}this.destination.next(t)},t}(OuterSubscriber);function timer(e,t,r){void 0===e&&(e=0);var n=-1;return isNumeric(t)?n=Number(t)<1?1:Number(t):isScheduler(t)&&(r=t),isScheduler(r)||(r=async),new Observable((function(t){var o=isNumeric(e)?e:+e-r.now();return r.schedule(dispatch$2,o,{index:0,period:n,subscriber:t})}))}function dispatch$2(e){var t=e.index,r=e.period,n=e.subscriber;if(n.next(t),!n.closed){if(-1===r)return n.complete();e.index=t+1,this.schedule(e,r)}}function catchError(e){return function(t){var r=new CatchOperator(e),n=t.lift(r);return r.caught=n}}var CatchOperator=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new CatchSubscriber(e,this.selector,this.caught))},e}(),CatchSubscriber=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.selector=r,o.caught=n,o}return __extends(t,e),t.prototype.error=function(t){if(!this.isStopped){var r=void 0;try{r=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var n=new SimpleInnerSubscriber(this);this.add(n);var o=innerSubscribe(r,n);o!==n&&this.add(o)}},t}(SimpleOuterSubscriber);function concatMap(e,t){return mergeMap(e,t,1)}function defaultIfEmpty(e){return void 0===e&&(e=null),function(t){return t.lift(new DefaultIfEmptyOperator(e))}}var DefaultIfEmptyOperator=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new DefaultIfEmptySubscriber(e,this.defaultValue))},e}(),DefaultIfEmptySubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.defaultValue=r,n.isEmpty=!0,n}return __extends(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(Subscriber);function isDate(e){return e instanceof Date&&!isNaN(+e)}function delay(e,t){void 0===t&&(t=async);var r=isDate(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new DelayOperator(r,t))}}var DelayOperator=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new DelaySubscriber(e,this.delay,this.scheduler))},e}(),DelaySubscriber=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.delay=r,o.scheduler=n,o.queue=[],o.active=!1,o.errored=!1,o}return __extends(t,e),t.dispatch=function(e){for(var t=e.source,r=t.queue,n=e.scheduler,o=e.destination;r.length>0&&r[0].time-n.now()<=0;)r.shift().notification.observe(o);if(r.length>0){var a=Math.max(0,r[0].time-n.now());this.schedule(e,a)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,r=new DelayMessage(t.now()+this.delay,e);this.queue.push(r),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(Notification.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(Notification.createComplete()),this.unsubscribe()},t}(Subscriber),DelayMessage=function(){return function(e,t){this.time=e,this.notification=t}}();function distinct(e,t){return function(r){return r.lift(new DistinctOperator(e,t))}}var DistinctOperator=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new DistinctSubscriber(e,this.keySelector,this.flushes))},e}(),DistinctSubscriber=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.keySelector=r,o.values=new Set,n&&o.add(innerSubscribe(n,new SimpleInnerSubscriber(o))),o}return __extends(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,r=this.destination;try{t=this.keySelector(e)}catch(e){return void r.error(e)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var r=this.values;r.has(e)||(r.add(e),this.destination.next(t))},t}(SimpleOuterSubscriber);function throwIfEmpty(e){return void 0===e&&(e=defaultErrorFactory),function(t){return t.lift(new ThrowIfEmptyOperator(e))}}var ThrowIfEmptyOperator=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new ThrowIfEmptySubscriber(e,this.errorFactory))},e}(),ThrowIfEmptySubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.errorFactory=r,n.hasValue=!1,n}return __extends(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(Subscriber);function defaultErrorFactory(){return new EmptyError}function take(e){return function(t){return 0===e?empty$1():t.lift(new TakeOperator(e))}}var TakeOperator=function(){function e(e){if(this.total=e,this.total<0)throw new ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new TakeSubscriber(e,this.total))},e}(),TakeSubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.total=r,n.count=0,n}return __extends(t,e),t.prototype._next=function(e){var t=this.total,r=++this.count;r<=t&&(this.destination.next(e),r===t&&(this.destination.complete(),this.unsubscribe()))},t}(Subscriber);function finalize(e){return function(t){return t.lift(new FinallyOperator(e))}}var FinallyOperator=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new FinallySubscriber(e,this.callback))},e}(),FinallySubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.add(new Subscription(r)),n}return __extends(t,e),t}(Subscriber);function first(e,t){var r=arguments.length>=2;return function(n){return n.pipe(e?filter((function(t,r){return e(t,r,n)})):identity$1,take(1),r?defaultIfEmpty(t):throwIfEmpty((function(){return new EmptyError})))}}function ignoreElements(){return function(e){return e.lift(new IgnoreElementsOperator)}}var IgnoreElementsOperator=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new IgnoreElementsSubscriber(e))},e}(),IgnoreElementsSubscriber=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._next=function(e){},t}(Subscriber);function takeLast(e){return function(t){return 0===e?empty$1():t.lift(new TakeLastOperator(e))}}var TakeLastOperator=function(){function e(e){if(this.total=e,this.total<0)throw new ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new TakeLastSubscriber(e,this.total))},e}(),TakeLastSubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.total=r,n.ring=new Array,n.count=0,n}return __extends(t,e),t.prototype._next=function(e){var t=this.ring,r=this.total,n=this.count++;t.length<r?t.push(e):t[n%r]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var r=this.count>=this.total?this.total:this.count,n=this.ring,o=0;o<r;o++){var a=t++%r;e.next(n[a])}e.complete()},t}(Subscriber);function mapTo(e){return function(t){return t.lift(new MapToOperator(e))}}var MapToOperator=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new MapToSubscriber(e,this.value))},e}(),MapToSubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.value=r,n}return __extends(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(Subscriber);function scan(e,t){var r=!1;return arguments.length>=2&&(r=!0),function(n){return n.lift(new ScanOperator(e,t,r))}}var ScanOperator=function(){function e(e,t,r){void 0===r&&(r=!1),this.accumulator=e,this.seed=t,this.hasSeed=r}return e.prototype.call=function(e,t){return t.subscribe(new ScanSubscriber(e,this.accumulator,this.seed,this.hasSeed))},e}(),ScanSubscriber=function(e){function t(t,r,n,o){var a=e.call(this,t)||this;return a.accumulator=r,a._seed=n,a.hasSeed=o,a.index=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.accumulator(this.seed,e,r)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)},t}(Subscriber);function reduce(e,t){return arguments.length>=2?function(r){return pipe(scan(e,t),takeLast(1),defaultIfEmpty(t))(r)}:function(t){return pipe(scan((function(t,r,n){return e(t,r,n+1)})),takeLast(1))(t)}}function multicast(e,t){return function(r){var n;if(n="function"==typeof e?e:function(){return e},"function"==typeof t)return r.lift(new MulticastOperator(n,t));var o=Object.create(r,connectableObservableDescriptor);return o.source=r,o.subjectFactory=n,o}}var MulticastOperator=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var r=this.selector,n=this.subjectFactory(),o=r(n).subscribe(e);return o.add(t.subscribe(n)),o},e}();function retryWhen(e){return function(t){return t.lift(new RetryWhenOperator(e,t))}}var RetryWhenOperator=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new RetryWhenSubscriber(e,this.notifier,this.source))},e}(),RetryWhenSubscriber=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.notifier=r,o.source=n,o}return __extends(t,e),t.prototype.error=function(t){if(!this.isStopped){var r=this.errors,n=this.retries,o=this.retriesSubscription;if(n)this.errors=void 0,this.retriesSubscription=void 0;else{r=new Subject;try{n=(0,this.notifier)(r)}catch(t){return e.prototype.error.call(this,t)}o=innerSubscribe(n,new SimpleInnerSubscriber(this))}this._unsubscribeAndRecycle(),this.errors=r,this.retries=n,this.retriesSubscription=o,r.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(SimpleOuterSubscriber);function shareSubjectFactory(){return new Subject}function share(){return function(e){return refCount()(multicast(shareSubjectFactory)(e))}}function shareReplay(e,t,r){var n;return n=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:r},function(e){return e.lift(shareReplayOperator(n))}}function shareReplayOperator(e){var t,r,n=e.bufferSize,o=void 0===n?Number.POSITIVE_INFINITY:n,a=e.windowTime,c=void 0===a?Number.POSITIVE_INFINITY:a,l=e.refCount,u=e.scheduler,_=0,p=!1,f=!1;return function(e){var n;_++,!t||p?(p=!1,t=new ReplaySubject(o,c,u),n=t.subscribe(this),r=e.subscribe({next:function(e){t.next(e)},error:function(e){p=!0,t.error(e)},complete:function(){f=!0,r=void 0,t.complete()}})):n=t.subscribe(this),this.add((function(){_--,n.unsubscribe(),r&&!f&&l&&0===_&&(r.unsubscribe(),r=void 0,t=void 0)}))}}function switchMap(e,t){return"function"==typeof t?function(r){return r.pipe(switchMap((function(r,n){return from(e(r,n)).pipe(map$1((function(e,o){return t(r,e,n,o)})))})))}:function(t){return t.lift(new SwitchMapOperator(e))}}var SwitchMapOperator=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new SwitchMapSubscriber(e,this.project))},e}(),SwitchMapSubscriber=function(e){function t(t,r){var n=e.call(this,t)||this;return n.project=r,n.index=0,n}return __extends(t,e),t.prototype._next=function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(e){return void this.destination.error(e)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var r=new SimpleInnerSubscriber(this),n=this.destination;n.add(r),this.innerSubscription=innerSubscribe(e,r),this.innerSubscription!==r&&n.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(SimpleOuterSubscriber);function switchAll(){return switchMap(identity$1)}function takeUntil(e){return function(t){return t.lift(new TakeUntilOperator(e))}}var TakeUntilOperator=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var r=new TakeUntilSubscriber(e),n=innerSubscribe(this.notifier,new SimpleInnerSubscriber(r));return n&&!r.seenValue?(r.add(n),t.subscribe(r)):r},e}(),TakeUntilSubscriber=function(e){function t(t){var r=e.call(this,t)||this;return r.seenValue=!1,r}return __extends(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(SimpleOuterSubscriber);function tap(e,t,r){return function(n){return n.lift(new DoOperator(e,t,r))}}var DoOperator=function(){function e(e,t,r){this.nextOrObserver=e,this.error=t,this.complete=r}return e.prototype.call=function(e,t){return t.subscribe(new TapSubscriber(e,this.nextOrObserver,this.error,this.complete))},e}(),TapSubscriber=function(e){function t(t,r,n,o){var a=e.call(this,t)||this;return a._tapNext=noop,a._tapError=noop,a._tapComplete=noop,a._tapError=n||noop,a._tapComplete=o||noop,isFunction$1(r)?(a._context=a,a._tapNext=r):r&&(a._context=r,a._tapNext=r.next||noop,a._tapError=r.error||noop,a._tapComplete=r.complete||noop),a}return __extends(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(Subscriber);function timeoutWith(e,t,r){return void 0===r&&(r=async),function(n){var o=isDate(e),a=o?+e-r.now():Math.abs(e);return n.lift(new TimeoutWithOperator(a,o,t,r))}}var TimeoutWithOperator=function(){function e(e,t,r,n){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=r,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new TimeoutWithSubscriber(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),TimeoutWithSubscriber=function(e){function t(t,r,n,o,a){var c=e.call(this,t)||this;return c.absoluteTimeout=r,c.waitFor=n,c.withObservable=o,c.scheduler=a,c.scheduleTimeout(),c}return __extends(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(innerSubscribe(t,new SimpleInnerSubscriber(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(SimpleOuterSubscriber);function timeout(e,t){return void 0===t&&(t=async),timeoutWith(e,throwError(new TimeoutError),t)}function withLatestFrom(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var r;"function"==typeof e[e.length-1]&&(r=e.pop());var n=e;return t.lift(new WithLatestFromOperator(n,r))}}for(var WithLatestFromOperator=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new WithLatestFromSubscriber(e,this.observables,this.project))},e}(),WithLatestFromSubscriber=function(e){function t(t,r,n){var o=e.call(this,t)||this;o.observables=r,o.project=n,o.toRespond=[];var a=r.length;o.values=new Array(a);for(var c=0;c<a;c++)o.toRespond.push(c);for(c=0;c<a;c++){var l=r[c];o.add(subscribeToResult(o,l,void 0,c))}return o}return __extends(t,e),t.prototype.notifyNext=function(e,t,r){this.values[r]=t;var n=this.toRespond;if(n.length>0){var o=n.indexOf(r);-1!==o&&n.splice(o,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(OuterSubscriber),rngBrowser=createCommonjsModule((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}})),byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);function bytesToUuid(e,t){var r=t||0,n=byteToHex;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}var bytesToUuid_1=bytesToUuid,_nodeId,_clockseq,_lastMSecs=0,_lastNSecs=0;function v1(e,t,r){var n=t&&r||0,o=t||[],a=(e=e||{}).node||_nodeId,c=void 0!==e.clockseq?e.clockseq:_clockseq;if(null==a||null==c){var l=rngBrowser();null==a&&(a=_nodeId=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==c&&(c=_clockseq=16383&(l[6]<<8|l[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),_=void 0!==e.nsecs?e.nsecs:_lastNSecs+1,p=u-_lastMSecs+(_-_lastNSecs)/1e4;if(p<0&&void 0===e.clockseq&&(c=c+1&16383),(p<0||u>_lastMSecs)&&void 0===e.nsecs&&(_=0),_>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=u,_lastNSecs=_,_clockseq=c;var f=(1e4*(268435455&(u+=122192928e5))+_)%4294967296;o[n++]=f>>>24&255,o[n++]=f>>>16&255,o[n++]=f>>>8&255,o[n++]=255&f;var E=u/4294967296*1e4&268435455;o[n++]=E>>>8&255,o[n++]=255&E,o[n++]=E>>>24&15|16,o[n++]=E>>>16&255,o[n++]=c>>>8|128,o[n++]=255&c;for(var g=0;g<6;++g)o[n+g]=a[g];return t||bytesToUuid_1(o)}var v1_1=v1;function v4(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||rngBrowser)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[n+a]=o[a];return t||bytesToUuid_1(o)}var v4_1=v4,uuid=v4_1;uuid.v1=v1_1,uuid.v4=v4_1;var uuid_1=uuid,version="1.1.0";const BUILD="miniapp-v1.1.0-0-g0385e431",processId=uuid_1.v4(),PLATFORM_TYPE=10,VERSION_NO=2,SUBVERSION=2,END_CALL_PREFIX="AgoraRTMLegacyEndcallCompatibleMessagePrefix",AttributeOperationError={ATTRIBUTE_OPERATION_ERR_FAILURE:2,ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT:3,ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW:4,ATTRIBUTE_OPERATION_ERR_TOO_OFTEN:5,ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND:6,ATTRIBUTE_OPERATION_ERR_TIMEOUT:7,ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN:102},ChannelMessageError={CHANNEL_MESSAGE_ERR_FAILURE:1,CHANNEL_MESSAGE_ERR_TIMEOUT:2,CHANNEL_MESSAGE_ERR_TOO_OFTEN:3,CHANNEL_MESSAGE_ERR_INVALID_MESSAGE:4,CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL:5,CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN:102},CreateChannelError={CREATE_CHANNEL_ERR_INVALID_ARGUMENT:1},CreateInstanceError={CREATE_INSTANCE_ERR_INVALID_ARGUMENT:1},GetMembersError={GET_MEMBERS_ERR_FAILURE:1,GET_MEMBERS_ERR_REJECTED:2,GET_MEMBERS_ERR_TIMEOUT:3,GET_MEMBERS_ERR_TOO_OFTEN:4,GET_MEMBERS_ERR_NOT_IN_CHANNEL:5,GET_MEMBERS_ERR_USER_NOT_LOGGED_IN:102},JoinChannelError={JOIN_CHANNEL_ERR_FAILURE:1,JOIN_CHANNEL_ERR_REJECTED:2,JOIN_CHANNEL_ERR_INVALID_ARGUMENT:3,JOIN_CHANNEL_TIMEOUT:4,JOIN_CHANNEL_ERR_EXCEED_LIMIT:5,JOIN_CHANNEL_ERR_ALREADY_JOINED:6,JOIN_CHANNEL_ERR_TOO_OFTEN:7,JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN:8,JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN:102,JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE:201,JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID:202},LeaveChannelError={LEAVE_CHANNEL_ERR_FAILURE:1,LEAVE_CHANNEL_ERR_REJECTED:2,LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL:3,LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN:102},LoginError={LOGIN_ERR_UNKNOWN:1,LOGIN_ERR_REJECTED:2,LOGIN_ERR_INVALID_ARGUMENT:3,LOGIN_ERR_INVALID_APP_ID:4,LOGIN_ERR_INVALID_TOKEN:5,LOGIN_ERR_TOKEN_EXPIRED:6,LOGIN_ERR_NOT_AUTHORIZED:7,LOGIN_ERR_ALREADY_LOGIN:8,LOGIN_ERR_TIMEOUT:9,LOGIN_ERR_TOO_OFTEN:10,LOGIN_ERR_ABORTED_BY_LOGOUT:201},LogoutError={LOGOUT_ERR_USER_NOT_LOGGED_IN:102},PeerMessageError={PEER_MESSAGE_ERR_FAILURE:1,PEER_MESSAGE_ERR_TIMEOUT:2,PEER_MESSAGE_ERR_TOO_OFTEN:5,PEER_MESSAGE_ERR_INVALID_USERID:6,PEER_MESSAGE_ERR_INVALID_MESSAGE:7,PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE:8,PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN:102},RenewTokenError={RENEW_TOKEN_ERR_FAILURE:1,RENEW_TOKEN_ERR_INVALID_ARGUMENT:2,RENEW_TOKEN_ERR_REJECTED:3,RENEW_TOKEN_ERR_TOO_OFTEN:4,RENEW_TOKEN_ERR_TOKEN_EXPIRED:5,RENEW_TOKEN_ERR_INVALID_TOKEN:6,RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN:102,RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT:201},InvitationApiCallError={INVITATION_API_CALL_ERR_INVALID_ARGUMENT:1,INVITATION_API_CALL_ERR_NOT_STARTED:2,INVITATION_API_CALL_ERR_ALREADY_END:3,INVITATION_API_CALL_ERR_ALREADY_ACCEPT:4,INVITATION_API_CALL_ERR_ALREADY_SENT:5},ATTRIBUTE_OPERATION_ERR_FAILURE=AttributeOperationError.ATTRIBUTE_OPERATION_ERR_FAILURE,ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=AttributeOperationError.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW,ATTRIBUTE_OPERATION_ERR_TIMEOUT=AttributeOperationError.ATTRIBUTE_OPERATION_ERR_TIMEOUT,ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,CREATE_CHANNEL_ERR_INVALID_ARGUMENT=CreateChannelError.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,CREATE_INSTANCE_ERR_INVALID_ARGUMENT=CreateInstanceError.CREATE_INSTANCE_ERR_INVALID_ARGUMENT,GET_MEMBERS_ERR_FAILURE=GetMembersError.GET_MEMBERS_ERR_FAILURE,GET_MEMBERS_ERR_REJECTED=GetMembersError.GET_MEMBERS_ERR_REJECTED,GET_MEMBERS_ERR_NOT_IN_CHANNEL=GetMembersError.GET_MEMBERS_ERR_NOT_IN_CHANNEL,GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=GetMembersError.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,JOIN_CHANNEL_ERR_FAILURE=JoinChannelError.JOIN_CHANNEL_ERR_FAILURE,JOIN_CHANNEL_ERR_INVALID_ARGUMENT=JoinChannelError.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,JOIN_CHANNEL_TIMEOUT=JoinChannelError.JOIN_CHANNEL_TIMEOUT,JOIN_CHANNEL_ERR_EXCEED_LIMIT=JoinChannelError.JOIN_CHANNEL_ERR_EXCEED_LIMIT,JOIN_CHANNEL_ERR_ALREADY_JOINED=JoinChannelError.JOIN_CHANNEL_ERR_ALREADY_JOINED,JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=JoinChannelError.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=JoinChannelError.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,CHANNEL_MESSAGE_ERR_FAILURE=ChannelMessageError.CHANNEL_MESSAGE_ERR_FAILURE,CHANNEL_MESSAGE_ERR_TIMEOUT=ChannelMessageError.CHANNEL_MESSAGE_ERR_TIMEOUT,CHANNEL_MESSAGE_ERR_TOO_OFTEN=ChannelMessageError.CHANNEL_MESSAGE_ERR_TOO_OFTEN,CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=ChannelMessageError.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=ChannelMessageError.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,LEAVE_CHANNEL_ERR_FAILURE=LeaveChannelError.LEAVE_CHANNEL_ERR_FAILURE,LEAVE_CHANNEL_ERR_REJECTED=LeaveChannelError.LEAVE_CHANNEL_ERR_REJECTED,LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=LeaveChannelError.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=LeaveChannelError.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,LOGIN_ERR_UNKNOWN=LoginError.LOGIN_ERR_UNKNOWN,LOGIN_ERR_REJECTED=LoginError.LOGIN_ERR_REJECTED,LOGIN_ERR_INVALID_ARGUMENT=LoginError.LOGIN_ERR_INVALID_ARGUMENT,LOGIN_ERR_INVALID_APP_ID=LoginError.LOGIN_ERR_INVALID_APP_ID,LOGIN_ERR_INVALID_TOKEN=LoginError.LOGIN_ERR_INVALID_TOKEN,LOGIN_ERR_TOKEN_EXPIRED=LoginError.LOGIN_ERR_TOKEN_EXPIRED,LOGIN_ERR_ALREADY_LOGIN=LoginError.LOGIN_ERR_ALREADY_LOGIN,LOGIN_ERR_TIMEOUT=LoginError.LOGIN_ERR_TIMEOUT,LOGIN_ERR_TOO_OFTEN=LoginError.LOGIN_ERR_TOO_OFTEN,LOGOUT_ERR_USER_NOT_LOGGED_IN=LogoutError.LOGOUT_ERR_USER_NOT_LOGGED_IN,PEER_MESSAGE_ERR_FAILURE=PeerMessageError.PEER_MESSAGE_ERR_FAILURE,PEER_MESSAGE_ERR_TIMEOUT=PeerMessageError.PEER_MESSAGE_ERR_TIMEOUT,PEER_MESSAGE_ERR_TOO_OFTEN=PeerMessageError.PEER_MESSAGE_ERR_TOO_OFTEN,PEER_MESSAGE_ERR_INVALID_USERID=PeerMessageError.PEER_MESSAGE_ERR_INVALID_USERID,PEER_MESSAGE_ERR_INVALID_MESSAGE=PeerMessageError.PEER_MESSAGE_ERR_INVALID_MESSAGE,PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=PeerMessageError.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,RENEW_TOKEN_ERR_FAILURE=RenewTokenError.RENEW_TOKEN_ERR_FAILURE,RENEW_TOKEN_ERR_INVALID_ARGUMENT=RenewTokenError.RENEW_TOKEN_ERR_INVALID_ARGUMENT,RENEW_TOKEN_ERR_TOKEN_EXPIRED=RenewTokenError.RENEW_TOKEN_ERR_TOKEN_EXPIRED,RENEW_TOKEN_ERR_INVALID_TOKEN=RenewTokenError.RENEW_TOKEN_ERR_INVALID_TOKEN,RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=RenewTokenError.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,INVITATION_API_CALL_ERR_INVALID_ARGUMENT=InvitationApiCallError.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,INVITATION_API_CALL_ERR_NOT_STARTED=InvitationApiCallError.INVITATION_API_CALL_ERR_NOT_STARTED,INVITATION_API_CALL_ERR_ALREADY_END=InvitationApiCallError.INVITATION_API_CALL_ERR_ALREADY_END,INVITATION_API_CALL_ERR_ALREADY_ACCEPT=InvitationApiCallError.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,INVITATION_API_CALL_ERR_ALREADY_SENT=InvitationApiCallError.INVITATION_API_CALL_ERR_ALREADY_SENT;function createBaseEach(e,t){return function(r,n){if(null==r)return r;if(!isArrayLike_1(r))return e(r,n);for(var o=r.length,a=t?o:-1,c=Object(r);(t?a--:++a<o)&&!1!==n(c[a],a,c););return r}}var _createBaseEach=createBaseEach,baseEach=_createBaseEach(_baseForOwn),_baseEach=baseEach;function baseSome(e,t){var r;return _baseEach(e,(function(e,n,o){return!(r=t(e,n,o))})),!!r}var _baseSome=baseSome;function isIterateeCall(e,t,r){if(!isObject_1(r))return!1;var n=typeof t;return!!("number"==n?isArrayLike_1(r)&&_isIndex(t,r.length):"string"==n&&t in r)&&eq_1(r[t],e)}var _isIterateeCall=isIterateeCall;function some(e,t,r){var n=isArray_1(e)?_arraySome:_baseSome;return r&&_isIterateeCall(e,t,r)&&(t=void 0),n(e,_baseIteratee(t))}var some_1=some,spreadableSymbol=_Symbol?_Symbol.isConcatSpreadable:void 0;function isFlattenable(e){return isArray_1(e)||isArguments_1(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}var _isFlattenable=isFlattenable;function baseFlatten(e,t,r,n,o){var a=-1,c=e.length;for(r||(r=_isFlattenable),o||(o=[]);++a<c;){var l=e[a];t>0&&r(l)?t>1?baseFlatten(l,t-1,r,n,o):_arrayPush(o,l):n||(o[o.length]=l)}return o}var _baseFlatten=baseFlatten;function baseMap(e,t){var r=-1,n=isArrayLike_1(e)?Array(e.length):[];return _baseEach(e,(function(e,o,a){n[++r]=t(e,o,a)})),n}var _baseMap=baseMap;function baseSortBy(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var _baseSortBy=baseSortBy;function compareAscending(e,t){if(e!==t){var r=void 0!==e,n=null===e,o=e==e,a=isSymbol_1(e),c=void 0!==t,l=null===t,u=t==t,_=isSymbol_1(t);if(!l&&!_&&!a&&e>t||a&&c&&u&&!l&&!_||n&&c&&u||!r&&u||!o)return 1;if(!n&&!a&&!_&&e<t||_&&r&&o&&!n&&!a||l&&r&&o||!c&&o||!u)return-1}return 0}var _compareAscending=compareAscending;function compareMultiple(e,t,r){for(var n=-1,o=e.criteria,a=t.criteria,c=o.length,l=r.length;++n<c;){var u=_compareAscending(o[n],a[n]);if(u)return n>=l?u:u*("desc"==r[n]?-1:1)}return e.index-t.index}var _compareMultiple=compareMultiple;function baseOrderBy(e,t,r){t=t.length?_arrayMap(t,(function(e){return isArray_1(e)?function(t){return _baseGet(t,1===e.length?e[0]:e)}:e})):[identity_1];var n=-1;t=_arrayMap(t,_baseUnary(_baseIteratee));var o=_baseMap(e,(function(e,r,o){return{criteria:_arrayMap(t,(function(t){return t(e)})),index:++n,value:e}}));return _baseSortBy(o,(function(e,t){return _compareMultiple(e,t,r)}))}var _baseOrderBy=baseOrderBy;function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _apply=apply,nativeMax=Math.max;function overRest(e,t,r){return t=nativeMax(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,a=nativeMax(n.length-t,0),c=Array(a);++o<a;)c[o]=n[t+o];o=-1;for(var l=Array(t+1);++o<t;)l[o]=n[o];return l[t]=r(c),_apply(e,this,l)}}var _overRest=overRest;function constant(e){return function(){return e}}var constant_1=constant,baseSetToString=_defineProperty?function(e,t){return _defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant_1(t),writable:!0})}:identity_1,_baseSetToString=baseSetToString,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(e){var t=0,r=0;return function(){var n=nativeNow(),o=HOT_SPAN-(n-r);if(r=n,o>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var _shortOut=shortOut,setToString=_shortOut(_baseSetToString),_setToString=setToString;function baseRest(e,t){return _setToString(_overRest(e,t,identity_1),e+"")}var _baseRest=baseRest,sortBy=_baseRest((function(e,t){if(null==e)return[];var r=t.length;return r>1&&_isIterateeCall(e,t[0],t[1])?t=[]:r>2&&_isIterateeCall(t[0],t[1],t[2])&&(t=[t[0]]),_baseOrderBy(e,_baseFlatten(t,1),[])})),sortBy_1=sortBy;function assignMergeValue(e,t,r){(void 0!==r&&!eq_1(e[t],r)||void 0===r&&!(t in e))&&_baseAssignValue(e,t,r)}var _assignMergeValue=assignMergeValue,_cloneBuffer=createCommonjsModule((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?_root.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}}));function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new _Uint8Array(t).set(new _Uint8Array(e)),t}var _cloneArrayBuffer=cloneArrayBuffer;function cloneTypedArray(e,t){var r=t?_cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var _cloneTypedArray=cloneTypedArray;function copyArray(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var _copyArray=copyArray,objectCreate=Object.create,baseCreate=function(){function e(){}return function(t){if(!isObject_1(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),_baseCreate=baseCreate,getPrototype=_overArg(Object.getPrototypeOf,Object),_getPrototype=getPrototype;function initCloneObject(e){return"function"!=typeof e.constructor||_isPrototype(e)?{}:_baseCreate(_getPrototype(e))}var _initCloneObject=initCloneObject;function isArrayLikeObject(e){return isObjectLike_1(e)&&isArrayLike_1(e)}var isArrayLikeObject_1=isArrayLikeObject,objectTag$3="[object Object]",funcProto$2=Function.prototype,objectProto$c=Object.prototype,funcToString$2=funcProto$2.toString,hasOwnProperty$9=objectProto$c.hasOwnProperty,objectCtorString=funcToString$2.call(Object);function isPlainObject$1(e){if(!isObjectLike_1(e)||_baseGetTag(e)!=objectTag$3)return!1;var t=_getPrototype(e);if(null===t)return!0;var r=hasOwnProperty$9.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&funcToString$2.call(r)==objectCtorString}var isPlainObject_1=isPlainObject$1;function safeGet(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var _safeGet=safeGet,objectProto$d=Object.prototype,hasOwnProperty$a=objectProto$d.hasOwnProperty;function assignValue(e,t,r){var n=e[t];hasOwnProperty$a.call(e,t)&&eq_1(n,r)&&(void 0!==r||t in e)||_baseAssignValue(e,t,r)}var _assignValue=assignValue;function copyObject(e,t,r,n){var o=!r;r||(r={});for(var a=-1,c=t.length;++a<c;){var l=t[a],u=n?n(r[l],e[l],l,r,e):void 0;void 0===u&&(u=e[l]),o?_baseAssignValue(r,l,u):_assignValue(r,l,u)}return r}var _copyObject=copyObject;function nativeKeysIn(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var _nativeKeysIn=nativeKeysIn,objectProto$e=Object.prototype,hasOwnProperty$b=objectProto$e.hasOwnProperty;function baseKeysIn(e){if(!isObject_1(e))return _nativeKeysIn(e);var t=_isPrototype(e),r=[];for(var n in e)("constructor"!=n||!t&&hasOwnProperty$b.call(e,n))&&r.push(n);return r}var _baseKeysIn=baseKeysIn;function keysIn(e){return isArrayLike_1(e)?_arrayLikeKeys(e,!0):_baseKeysIn(e)}var keysIn_1=keysIn;function toPlainObject(e){return _copyObject(e,keysIn_1(e))}var toPlainObject_1=toPlainObject;function baseMergeDeep(e,t,r,n,o,a,c){var l=_safeGet(e,r),u=_safeGet(t,r),_=c.get(u);if(_)_assignMergeValue(e,r,_);else{var p=a?a(l,u,r+"",e,t,c):void 0,f=void 0===p;if(f){var E=isArray_1(u),g=!E&&isBuffer_1(u),b=!E&&!g&&isTypedArray_1(u);p=u,E||g||b?isArray_1(l)?p=l:isArrayLikeObject_1(l)?p=_copyArray(l):g?(f=!1,p=_cloneBuffer(u,!0)):b?(f=!1,p=_cloneTypedArray(u,!0)):p=[]:isPlainObject_1(u)||isArguments_1(u)?(p=l,isArguments_1(l)?p=toPlainObject_1(l):isObject_1(l)&&!isFunction_1(l)||(p=_initCloneObject(u))):f=!1}f&&(c.set(u,p),o(p,u,n,a,c),c.delete(u)),_assignMergeValue(e,r,p)}}var _baseMergeDeep=baseMergeDeep;function baseMerge(e,t,r,n,o){e!==t&&_baseFor(t,(function(a,c){if(o||(o=new _Stack),isObject_1(a))_baseMergeDeep(e,t,c,r,baseMerge,n,o);else{var l=n?n(_safeGet(e,c),a,c+"",e,t,o):void 0;void 0===l&&(l=a),_assignMergeValue(e,c,l)}}),keysIn_1)}var _baseMerge=baseMerge;function createAssigner(e){return _baseRest((function(t,r){var n=-1,o=r.length,a=o>1?r[o-1]:void 0,c=o>2?r[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,c&&_isIterateeCall(r[0],r[1],c)&&(a=o<3?void 0:a,o=1),t=Object(t);++n<o;){var l=r[n];l&&e(t,l,n,a)}return t}))}var _createAssigner=createAssigner,mergeWith=_createAssigner((function(e,t,r,n){_baseMerge(e,t,r,n)})),mergeWith_1=mergeWith;function rateLimit(e,...t){let r=1,n=asapScheduler;1===t.length?"number"==typeof t[0]?r=t[0]:n=t[0]:2===t.length&&(r=t[0],n=t[1]);const o=r||1;return t=>t.pipe(scan(((t,r)=>{const a=n.now(),c=a-e;if((t=t.filter((e=>e.until>c))).length>=o){const n=t[0],c=t[t.length-1],l=n.until+e*Math.floor(t.length/o);t.push({delay:c.until<a?l-a:l-c.until,until:l,value:r})}else t.push({delay:0,until:a,value:r});return t}),[]),map$1((e=>e[e.length-1])),concatMap((e=>{const t=of(e.value);return e.delay?t.pipe(delay(e.delay,n)):t})))}var aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),n=0,o=2,a=!0;o<arguments.length;)r[n++]=arguments[o++];return new Promise((function(o,c){r[n]=function(e){if(a)if(a=!1,e)c(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];o.apply(null,t)}};try{e.apply(t||null,r)}catch(e){a&&(a=!1,c(e))}}))}var base64_1=createCommonjsModule((function(e,t){var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=new Array(64),o=new Array(123),a=0;a<64;)o[n[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;r.encode=function(e,t,r){for(var o,a=null,c=[],l=0,u=0;t<r;){var _=e[t++];switch(u){case 0:c[l++]=n[_>>2],o=(3&_)<<4,u=1;break;case 1:c[l++]=n[o|_>>4],o=(15&_)<<2,u=2;break;case 2:c[l++]=n[o|_>>6],c[l++]=n[63&_],u=0}l>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,c)),l=0)}return u&&(c[l++]=n[o],c[l++]=61,1===u&&(c[l++]=61)),a?(l&&a.push(String.fromCharCode.apply(String,c.slice(0,l))),a.join("")):String.fromCharCode.apply(String,c.slice(0,l))};var c="invalid encoding";r.decode=function(e,t,r){for(var n,a=r,l=0,u=0;u<e.length;){var _=e.charCodeAt(u++);if(61===_&&l>1)break;if(void 0===(_=o[_]))throw Error(c);switch(l){case 0:n=_,l=1;break;case 1:t[r++]=n<<2|(48&_)>>4,n=_,l=2;break;case 2:t[r++]=(15&n)<<4|(60&_)>>2,n=_,l=3;break;case 3:t[r++]=(3&n)<<6|_,l=0}}if(1===l)throw Error(c);return r-a},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}})),eventemitter=EventEmitter$1;function EventEmitter$1(){this._listeners={}}EventEmitter$1.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},EventEmitter$1.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},EventEmitter$1.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var float_1=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3]}function a(e,n,o){t[0]=e,n[o]=r[3],n[o+1]=r[2],n[o+2]=r[1],n[o+3]=r[0]}function c(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function l(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?o:a,e.writeFloatBE=n?a:o,e.readFloatLE=n?c:l,e.readFloatBE=n?l:c}():function(){function t(e,t,r,n){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var a=Math.floor(Math.log(t)/Math.LN2);e((o<<31|a+127<<23|8388607&Math.round(t*Math.pow(2,-a)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),o=2*(n>>31)+1,a=n>>>23&255,c=8388607&n;return 255===a?c?NaN:o*(1/0):0===a?1401298464324817e-60*o*c:o*Math.pow(2,a-150)*(c+8388608)}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE),e.readFloatLE=r.bind(null,readUintLE),e.readFloatBE=r.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3],n[o+4]=r[4],n[o+5]=r[5],n[o+6]=r[6],n[o+7]=r[7]}function a(e,n,o){t[0]=e,n[o]=r[7],n[o+1]=r[6],n[o+2]=r[5],n[o+3]=r[4],n[o+4]=r[3],n[o+5]=r[2],n[o+6]=r[1],n[o+7]=r[0]}function c(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function l(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?o:a,e.writeDoubleBE=n?a:o,e.readDoubleLE=n?c:l,e.readDoubleBE=n?l:c}():function(){function t(e,t,r,n,o,a){var c=n<0?1:0;if(c&&(n=-n),0===n)e(0,o,a+t),e(1/n>0?0:2147483648,o,a+r);else if(isNaN(n))e(0,o,a+t),e(2146959360,o,a+r);else if(n>17976931348623157e292)e(0,o,a+t),e((c<<31|2146435072)>>>0,o,a+r);else{var l;if(n<22250738585072014e-324)e((l=n/5e-324)>>>0,o,a+t),e((c<<31|l/4294967296)>>>0,o,a+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(l=n*Math.pow(2,-u))>>>0,o,a+t),e((c<<31|u+1023<<20|1048576*l&1048575)>>>0,o,a+r)}}}function r(e,t,r,n,o){var a=e(n,o+t),c=e(n,o+r),l=2*(c>>31)+1,u=c>>>20&2047,_=4294967296*(1048575&c)+a;return 2047===u?_?NaN:l*(1/0):0===u?5e-324*l*_:l*Math.pow(2,u-1075)*(_+4503599627370496)}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0),e.readDoubleLE=r.bind(null,readUintLE,0,4),e.readDoubleBE=r.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8_1=createCommonjsModule((function(e,t){var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,o=null,a=[],c=0;t<r;)(n=e[t++])<128?a[c++]=n:n>191&&n<224?a[c++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,a[c++]=55296+(n>>10),a[c++]=56320+(1023&n)):a[c++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],c>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),c=0);return o?(c&&o.push(String.fromCharCode.apply(String,a.slice(0,c))),o.join("")):String.fromCharCode.apply(String,a.slice(0,c))},r.write=function(e,t,r){for(var n,o,a=r,c=0;c<e.length;++c)(n=e.charCodeAt(c))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(o=e.charCodeAt(c+1)))?(n=65536+((1023&n)<<10)+(1023&o),++c,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-a}})),pool_1=pool;function pool(e,t,r){var n=r||8192,o=n>>>1,a=null,c=n;return function(r){if(r<1||r>o)return e(r);c+r>n&&(a=e(n),c=0);var l=t.call(a,c,c+=r);return 7&c&&(c=1+(7|c)),l}}var longbits=LongBits;function LongBits(e,t){this.lo=e>>>0,this.hi=t>>>0}var zero=LongBits.zero=new LongBits(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits.zeroHash="\0\0\0\0\0\0\0\0";LongBits.fromNumber=function(e){if(0===e)return zero;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new LongBits(r,n)},LongBits.from=function(e){if("number"==typeof e)return LongBits.fromNumber(e);if(minimal.isString(e)){if(!minimal.Long)return LongBits.fromNumber(parseInt(e,10));e=minimal.Long.fromString(e)}return e.low||e.high?new LongBits(e.low>>>0,e.high>>>0):zero},LongBits.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},LongBits.prototype.toLong=function(e){return minimal.Long?new minimal.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var charCodeAt=String.prototype.charCodeAt;LongBits.fromHash=function(e){return e===zeroHash?zero:new LongBits((charCodeAt.call(e,0)|charCodeAt.call(e,1)<<8|charCodeAt.call(e,2)<<16|charCodeAt.call(e,3)<<24)>>>0,(charCodeAt.call(e,4)|charCodeAt.call(e,5)<<8|charCodeAt.call(e,6)<<16|charCodeAt.call(e,7)<<24)>>>0)},LongBits.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},LongBits.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},LongBits.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10};var minimal=createCommonjsModule((function(e,t){var r=t;function n(e,t,r){for(var n=Object.keys(t),o=0;o<n.length;++o)void 0!==e[n[o]]&&r||(e[n[o]]=t[n[o]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=aspromise,r.base64=base64_1,r.EventEmitter=eventemitter,r.float=float_1,r.inquire=inquire_1,r.utf8=utf8_1,r.pool=pool_1,r.LongBits=longbits,r.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),r.global=r.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=n,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=o,r.ProtocolError=o("ProtocolError"),r.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},r.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}})),writer=Writer,BufferWriter,LongBits$1=minimal.LongBits,base64=minimal.base64,utf8=minimal.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop$1(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer(){this.len=0,this.head=new Op(noop$1,0,0),this.tail=this.head,this.states=null}var create=function(){return minimal.Buffer?function(){return(Writer.create=function(){return new BufferWriter})()}:function(){return new Writer}};function writeByte(e,t,r){t[r]=255&e}function writeVarint32(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function writeFixed32(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer.create=create(),Writer.alloc=function(e){return new minimal.Array(e)},minimal.Array!==Array&&(Writer.alloc=minimal.pool(Writer.alloc,minimal.Array.prototype.subarray)),Writer.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Op(e,t,r),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer.prototype.int64=Writer.prototype.uint64,Writer.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer.prototype.sfixed32=Writer.prototype.fixed32,Writer.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer.prototype.sfixed64=Writer.prototype.fixed64,Writer.prototype.float=function(e){return this._push(minimal.float.writeFloatLE,4,e)},Writer.prototype.double=function(e){return this._push(minimal.float.writeDoubleLE,8,e)};var writeBytes=minimal.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};Writer.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(minimal.isString(e)){var r=Writer.alloc(t=base64.length(e));base64.decode(e,r,0),e=r}return this.uint32(t)._push(writeBytes,t,e)},Writer.prototype.string=function(e){var t=utf8.length(e);return t?this.uint32(t)._push(utf8.write,t,e):this._push(writeByte,1,0)},Writer.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop$1,0,0),this.len=0,this},Writer.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$1,0,0),this.len=0),this},Writer.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},Writer.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},Writer._configure=function(e){BufferWriter=e,Writer.create=create(),BufferWriter._configure()};var writer_buffer=BufferWriter$1;function BufferWriter$1(){writer.call(this)}function writeStringBuffer(e,t,r){e.length<40?minimal.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}(BufferWriter$1.prototype=Object.create(writer.prototype)).constructor=BufferWriter$1,BufferWriter$1._configure=function(){BufferWriter$1.alloc=minimal._Buffer_allocUnsafe,BufferWriter$1.writeBytesBuffer=minimal.Buffer&&minimal.Buffer.prototype instanceof Uint8Array&&"set"===minimal.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},BufferWriter$1.prototype.bytes=function(e){minimal.isString(e)&&(e=minimal._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter$1.writeBytesBuffer,t,e),this},BufferWriter$1.prototype.string=function(e){var t=minimal.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter$1._configure();var reader=Reader,BufferReader,LongBits$2=minimal.LongBits,utf8$1=minimal.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader(e);throw Error("illegal buffer")},create$1=function(){return minimal.Buffer?function(e){return(Reader.create=function(e){return minimal.Buffer.isBuffer(e)?new BufferReader(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits$2(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits$2(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader.create=create$1(),Reader.prototype._slice=minimal.Array.prototype.subarray||minimal.Array.prototype.slice,Reader.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader.prototype.int32=function(){return 0|this.uint32()},Reader.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader.prototype.bool=function(){return 0!==this.uint32()},Reader.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=minimal.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=minimal.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},Reader.prototype.string=function(){var e=this.bytes();return utf8$1.read(e,0,e.length)},Reader.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader._configure=function(e){BufferReader=e,Reader.create=create$1(),BufferReader._configure();var t=minimal.Long?"toLong":"toNumber";minimal.merge(Reader.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader$1;function BufferReader$1(e){reader.call(this,e)}(BufferReader$1.prototype=Object.create(reader.prototype)).constructor=BufferReader$1,BufferReader$1._configure=function(){minimal.Buffer&&(BufferReader$1.prototype._slice=minimal.Buffer.prototype.slice)},BufferReader$1.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader$1._configure();var service=Service;function Service(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");minimal.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(Service.prototype=Object.create(minimal.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,r,n,o,a){if(!o)throw TypeError("request must be specified");var c=this;if(!a)return minimal.asPromise(e,c,t,r,n,o);if(c.rpcImpl)try{return c.rpcImpl(t,r[c.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return c.emit("error",e,t),a(e);if(null!==r){if(!(r instanceof n))try{r=n[c.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return c.emit("error",e,t),a(e)}return c.emit("data",r,t),a(null,r)}c.end(!0)}))}catch(e){return c.emit("error",e,t),void setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var rpc_1=createCommonjsModule((function(e,t){t.Service=service})),roots={},indexMinimal=createCommonjsModule((function(e,t){var r=t;function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=writer,r.BufferWriter=writer_buffer,r.Reader=reader,r.BufferReader=reader_buffer,r.util=minimal,r.rpc=rpc_1,r.roots=roots,r.configure=n,n()}));indexMinimal.util.Long=long_1,indexMinimal.configure();var minimal_1=indexMinimal;const $Reader=minimal_1.Reader,$Writer=minimal_1.Writer,$util=minimal_1.util,$root=minimal_1.roots.default||(minimal_1.roots.default={}),URI=$root.URI=(()=>{const e={},t=Object.create(e);return t[e[0]="Unknown"]=0,t[e[1]="PingUri"]=1,t[e[2]="PongUri"]=2,t[e[11]="UserJoinUri"]=11,t[e[12]="UserRespUri"]=12,t[e[21]="UserQuitUri"]=21,t[e[22]="UserDropUri"]=22,t[e[31]="GroupEnterUri"]=31,t[e[32]="GroupLeaveUri"]=32,t[e[33]="GroupReplyUri"]=33,t[e[36]="GroupEnterNoticeUri"]=36,t[e[37]="GroupLeaveNoticeUri"]=37,t[e[38]="GroupEventNoticeUri"]=38,t[e[351]="GroupAttributeGetUri"]=351,t[e[352]="GroupAttributeRetUri"]=352,t[e[353]="GroupAttributeSetUri"]=353,t[e[354]="GroupAttributeModUri"]=354,t[e[355]="GroupAttributeDelUri"]=355,t[e[356]="GroupAttributeAltUri"]=356,t[e[357]="GroupAttributeRspUri"]=357,t[e[358]="GroupAttributeErrUri"]=358,t[e[361]="GroupAttributeKeysGetUri"]=361,t[e[362]="GroupAttributeKeysRetUri"]=362,t[e[55]="GroupAllUsersListUri"]=55,t[e[56]="GroupAllUsersResultUri"]=56,t[e[100]="MessageUri"]=100,t[e[101]="AckUri"]=101,t})(),Wrapper=$root.Wrapper=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.uri=0,e.prototype.data=$util.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.uri&&Object.hasOwnProperty.call(e,"uri")&&t.uint32(8).int32(e.uri),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.Wrapper;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.uri=e.int32();break;case 2:n.data=e.bytes();break;default:e.skipType(7&t)}}return n},e})(),Ping=$root.Ping=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.ms=$util.Long?$util.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.Ping;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.ms=e.uint64();break;default:e.skipType(7&t)}}return n},e})(),Pong=$root.Pong=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.ms=$util.Long?$util.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.Pong;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.ms=e.uint64();break;default:e.skipType(7&t)}}return n},e})(),UserJoin=$root.UserJoin=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.opt=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.instance=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.opt&&Object.hasOwnProperty.call(e,"opt")&&t.uint32(16).uint64(e.opt),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(34).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(42).string(e.ticket),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.UserJoin;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.opt=e.uint64();break;case 3:n.instance=e.uint64();break;case 4:n.account=e.string();break;case 5:n.ticket=e.string();break;default:e.skipType(7&t)}}return n},e})(),UserResp=$root.UserResp=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.UserResp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.code=e.uint32();break;default:e.skipType(7&t)}}return n},e})(),UserQuit=$root.UserQuit=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.encode=function(e,t){return t||(t=$Writer.create()),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.UserQuit;for(;e.pos<r;){let t=e.uint32();e.skipType(7&t)}return n},e})(),UserDrop=$root.UserDrop=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.code=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.UserDrop;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.code=e.uint32();break;default:e.skipType(7&t)}}return n},e})(),GroupEnter=$root.GroupEnter=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupEnter;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;default:e.skipType(7&t)}}return n},e})(),GroupLeave=$root.GroupLeave=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.account="",e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupLeave;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.account=e.string();break;default:e.skipType(7&t)}}return n},e})(),GroupReply=$root.GroupReply=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupReply;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.code=e.uint32();break;default:e.skipType(7&t)}}return n},e})(),GroupLeaveNotice=$root.GroupLeaveNotice=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupLeaveNotice;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.user=e.string();break;case 3:n.group=e.string();break;case 4:n.instance=e.uint64();break;case 5:n.size=e.uint32();break;default:e.skipType(7&t)}}return n},e})(),GroupEnterNotice=$root.GroupEnterNotice=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupEnterNotice;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.user=e.string();break;case 3:n.group=e.string();break;case 4:n.instance=e.uint64();break;case 5:n.size=e.uint32();break;default:e.skipType(7&t)}}return n},e})(),Message=$root.Message=(()=>{function e(e){if(this.MiscMap={},e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.instance=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.dialogue=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.sequence=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.options=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=$util.newBuffer([]),e.prototype.MiscMap=$util.emptyObject,e.prototype.ms=$util.Long?$util.Long.fromBits(0,0,!0):0,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&t.uint32(32).uint64(e.options),null!=e.src&&Object.hasOwnProperty.call(e,"src")&&t.uint32(42).string(e.src),null!=e.dst&&Object.hasOwnProperty.call(e,"dst")&&t.uint32(50).string(e.dst),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(58).bytes(e.payload),null!=e.MiscMap&&Object.hasOwnProperty.call(e,"MiscMap"))for(let r=Object.keys(e.MiscMap),n=0;n<r.length;++n)t.uint32(66).fork().uint32(10).string(r[n]).uint32(18).bytes(e.MiscMap[r[n]]).ldelim();return null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(72).uint64(e.ms),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r,n,o=void 0===t?e.len:e.pos+t,a=new $root.Message;for(;e.pos<o;){let t=e.uint32();switch(t>>>3){case 1:a.instance=e.uint64();break;case 2:a.dialogue=e.uint64();break;case 3:a.sequence=e.uint64();break;case 4:a.options=e.uint64();break;case 5:a.src=e.string();break;case 6:a.dst=e.string();break;case 7:a.payload=e.bytes();break;case 8:a.MiscMap===$util.emptyObject&&(a.MiscMap={});let o=e.uint32()+e.pos;for(r="",n=[];e.pos<o;){let t=e.uint32();switch(t>>>3){case 1:r=e.string();break;case 2:n=e.bytes();break;default:e.skipType(7&t)}}a.MiscMap[r]=n;break;case 9:a.ms=e.uint64();break;default:e.skipType(7&t)}}return a},e})(),Ack=$root.Ack=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.instance=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.dialogue=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.sequence=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.Ack;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.instance=e.uint64();break;case 2:n.dialogue=e.uint64();break;case 3:n.sequence=e.uint64();break;case 4:n.code=e.uint32();break;default:e.skipType(7&t)}}return n},e})(),GroupAllUsersList=$root.GroupAllUsersList=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(24).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(32).uint32(e.pageNumber),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAllUsersList;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.pageSize=e.uint32();break;case 4:n.pageNumber=e.uint32();break;default:e.skipType(7&t)}}return n},e})(),GroupAllUsersResult=$root.GroupAllUsersResult=(()=>{function e(e){if(this.memberInfos=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&t.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(let r=0;r<e.memberInfos.length;++r)$root.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[r],t.uint32(50).fork()).ldelim();return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAllUsersResult;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.totalSize=e.uint32();break;case 4:n.pageSize=e.uint32();break;case 5:n.pageNumber=e.uint32();break;case 6:n.memberInfos&&n.memberInfos.length||(n.memberInfos=[]),n.memberInfos.push($root.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return n},e.MemberInfo=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAllUsersResult.MemberInfo;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.account=e.string();break;case 2:n.ts=e.uint32();break;default:e.skipType(7&t)}}return n},e}(),e})(),GroupAttributeGet=$root.GroupAttributeGet=(()=>{function e(e){if(this.attributes=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.attributes&&e.attributes.length)for(let r=0;r<e.attributes.length;++r)t.uint32(26).string(e.attributes[r]);return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeGet;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&t)}}return n},e})(),GroupAttributeRet=$root.GroupAttributeRet=(()=>{function e(e){if(this.attributeMaps=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(let r=0;r<e.attributeMaps.length;++r)$root.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[r],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeRet;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.attributeMaps&&n.attributeMaps.length||(n.attributeMaps=[]),n.attributeMaps.push($root.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return n},e.AttributeMap=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=$util.Long?$util.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeRet.AttributeMap;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;case 3:n.origin=e.string();break;case 4:n.ms=e.uint64();break;default:e.skipType(7&t)}}return n},e}(),e})(),GroupAttributeSet=$root.GroupAttributeSet=(()=>{function e(e){if(this.attributeInfos=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(let r=0;r<e.attributeInfos.length;++r)$root.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[r],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeSet;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push($root.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeSet.AttributeInfo;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&t)}}return n},e}(),e})(),GroupAttributeMod=$root.GroupAttributeMod=(()=>{function e(e){if(this.attributeInfos=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(let r=0;r<e.attributeInfos.length;++r)$root.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[r],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeMod;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push($root.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeMod.AttributeInfo;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&t)}}return n},e}(),e})(),GroupAttributeDel=$root.GroupAttributeDel=(()=>{function e(e){if(this.attributes=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributes&&e.attributes.length)for(let r=0;r<e.attributes.length;++r)t.uint32(34).string(e.attributes[r]);return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeDel;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&t)}}return n},e})(),GroupAttributeAlt=$root.GroupAttributeAlt=(()=>{function e(e){if(this.attributeMaps=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(let r=0;r<e.attributeMaps.length;++r)$root.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[r],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeAlt;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.instance=e.uint64();break;case 4:n.attributeMaps&&n.attributeMaps.length||(n.attributeMaps=[]),n.attributeMaps.push($root.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return n},e.AttributeMap=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=$util.Long?$util.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeAlt.AttributeMap;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;case 3:n.origin=e.string();break;case 4:n.ms=e.uint64();break;default:e.skipType(7&t)}}return n},e}(),e})(),GroupAttributeRsp=$root.GroupAttributeRsp=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeRsp;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;default:e.skipType(7&t)}}return n},e})(),GroupAttributeErr=$root.GroupAttributeErr=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeErr;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.code=e.uint32();break;default:e.skipType(7&t)}}return n},e})(),GroupAttributeKeysGet=$root.GroupAttributeKeysGet=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeKeysGet;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;default:e.skipType(7&t)}}return n},e})(),GroupAttributeKeysRet=$root.GroupAttributeKeysRet=(()=>{function e(e){if(this.keys=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util.Long?$util.Long.fromBits(0,0,!0):0,e.prototype.keys=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(let r=0;r<e.keys.length;++r)t.uint32(18).string(e.keys[r]);return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.GroupAttributeKeysRet;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:n.seq=e.uint64();break;case 2:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;default:e.skipType(7&t)}}return n},e})();var ProtoPackets=Object.freeze({__proto__:null,URI,Wrapper,Ping,Pong,UserJoin,UserResp,UserQuit,UserDrop,GroupEnter,GroupLeave,GroupReply,GroupLeaveNotice,GroupEnterNotice,Message,Ack,GroupAllUsersList,GroupAllUsersResult,GroupAttributeGet,GroupAttributeRet,GroupAttributeSet,GroupAttributeMod,GroupAttributeDel,GroupAttributeAlt,GroupAttributeRsp,GroupAttributeErr,GroupAttributeKeysGet,GroupAttributeKeysRet,default:$root});const defaultProtocols=[],defaultWebsocketFactory=(e,t)=>wx.connectSocket({url:e,protocols:t}),normalClosureMessage="Normal closure";function makeWebSocketObservable(e,{protocols:t=defaultProtocols,makeWebSocket:r=defaultWebsocketFactory}={protocols:defaultProtocols,makeWebSocket:defaultWebsocketFactory}){return new Observable((n=>{let o;const a=new Subject,c=r(e,t);let l=!1,u=!1;const _=()=>{l=!0},p=e=>{if(o){_();const e=new Error("Web socket message factory function called more than once");throw n.error(e),e}return o=e.subscribe((e=>{try{c.send({data:e,fail:()=>{}})}catch(e){}})),a};return c.onOpen((()=>{u?(l=!0,c.close({})):n.next(p)})),c.onMessage((({data:e})=>{a.next(e)})),c.onError((e=>{_(),n.error(new Error(e.errMsg))})),c.onClose((e=>{l||(_(),u?(n.complete(),a.complete()):n.error(new Error(1e3===e.code?normalClosureMessage:e.reason)))})),()=>{u=!0,o&&o.unsubscribe(),l||(_(),c.close({}))}}))}var log=Math.log,LN2=Math.LN2,clz32=Math.clz32||function(e){return 31-log(e>>>0)/LN2|0},fromCharCode=String.fromCharCode,Object_prototype_toString={}.toString,NativeUint8Array=Uint8Array,patchedU8Array=NativeUint8Array||Array,ArrayBufferString=Object_prototype_toString.call((ArrayBuffer||patchedU8Array).prototype);function decoderReplacer(e){var t=e.charCodeAt(0)<<24,r=0|clz32(~t),n=0,o=0|e.length,a="";if(r<5&&o>=r){for(t=t<<r>>>24+r,n=1;n<r;n=n+1|0)t=t<<6|63&e.charCodeAt(n);t<=65535?a+=fromCharCode(t):t<=1114111?a+=fromCharCode(55296+((t=t-65536|0)>>10)|0,56320+(1023&t)|0):n=0}for(;n<o;n=n+1|0)a+="�";return a}function TextDecoder(){}function encoderReplacer(e){var t=0|e.charCodeAt(0);if(t>=55296&&t<=56319){var r=0|e.charCodeAt(1);if(r!=r)return fromCharCode(239,191,189);if(!(r>=56320&&r<=57343))return fromCharCode(239,191,189);if((t=(t-55296<<10)+r-56320+65536|0)>65535)return fromCharCode(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return t<=127?e:t<=2047?fromCharCode(192|t>>>6,128|63&t):fromCharCode(224|t>>>12,128|t>>>6&63,128|63&t)}function TextEncoder(){}TextDecoder.prototype.decode=function(e){var t=e&&e.buffer||e;if(Object_prototype_toString.call(t)!==ArrayBufferString)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var r=NativeUint8Array?new patchedU8Array(t):t,n="",o=0,a=0|r.length;o<a;o=o+32768|0)n+=fromCharCode.apply(0,r[NativeUint8Array?"slice":"subarray"](o,o+32768|0));return n.replace(/[\xc0-\xff][\x80-\xbf]*/g,decoderReplacer)},TextEncoder.prototype.encode=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,encoderReplacer),r=0|t.length,n=new patchedU8Array(r),o=0;o<r;o=o+1|0)n[o]=t.charCodeAt(o);return n};var util=createCommonjsModule((function(e,t){function r(e,t){var r=T.styles[t];return r?"["+T.colors[r][0]+"m"+e+"["+T.colors[r][1]+"m":e}function n(e){return void 0===e}function o(e){return"string"==typeof e}function a(e){return"boolean"==typeof e}function c(e){return O(e)&&("[object Error]"===u(e)||e instanceof Error)}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u(e){return Object.prototype.toString.call(e)}function _(e,t,r,o,a,c){var u,_,p;if((p=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?_=p.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):p.set&&(_=e.stylize("[Setter]","special")),l(o,a)||(u="["+a+"]"),_||(e.seen.indexOf(p.value)<0?(_=I(r)?b(e,p.value,null):b(e,p.value,r-1)).indexOf("\n")>-1&&(_=c?_.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+_.split("\n").map((function(e){return"   "+e})).join("\n")):_=e.stylize("[Circular]","special")),n(u)){if(c&&a.match(/^\d+$/))return _;(u=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(u=u.substr(1,u.length-2),u=e.stylize(u,"name")):(u=u.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),u=e.stylize(u,"string"))}return u+": "+_}function p(e){return"function"==typeof e}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function E(e){return O(e)&&"[object RegExp]"===u(e)}function g(e){return O(e)&&"[object Date]"===u(e)}function b(e,r,u){if(e.customInspect&&r&&p(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var v=r.inspect(u,e);return o(v)||(v=b(e,v,u)),v}var T=function(e,t){if(n(t))return e.stylize("undefined","undefined");if(o(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return"number"==typeof t?e.stylize(""+t,"number"):a(t)?e.stylize(""+t,"boolean"):I(t)?e.stylize("null","null"):void 0}(e,r);if(T)return T;var O=Object.keys(r),A=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(O);if(e.showHidden&&(O=Object.getOwnPropertyNames(r)),c(r)&&(O.indexOf("message")>=0||O.indexOf("description")>=0))return f(r);if(0===O.length){if(p(r)){var S=r.name?": "+r.name:"";return e.stylize("[Function"+S+"]","special")}if(E(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(g(r))return e.stylize(Date.prototype.toString.call(r),"date");if(c(r))return f(r)}var N,L,C="",M=!1,$=["{","}"];(N=r,Array.isArray(N)&&(M=!0,$=["[","]"]),p(r))&&(C=" [Function"+(r.name?": "+r.name:"")+"]");return E(r)&&(C=" "+RegExp.prototype.toString.call(r)),g(r)&&(C=" "+Date.prototype.toUTCString.call(r)),c(r)&&(C=" "+f(r)),0!==O.length||M&&0!=r.length?u<0?E(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),L=M?function(e,t,r,n,o){for(var a=[],c=0,u=t.length;c<u;++c)l(t,String(c))?a.push(_(e,t,r,n,String(c),!0)):a.push("");return o.forEach((function(o){o.match(/^\d+$/)||a.push(_(e,t,r,n,o,!0))})),a}(e,r,u,A,O):O.map((function(t){return _(e,r,u,A,t,M)})),e.seen.pop(),function(e,t,r){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(L,C,$)):$[0]+C+$[1]}function v(e,t){return e}function T(e,o){var c={seen:[],stylize:v};return arguments.length>=3&&(c.depth=arguments[2]),arguments.length>=4&&(c.colors=arguments[3]),a(o)?c.showHidden=o:o&&t._extend(c,o),n(c.showHidden)&&(c.showHidden=!1),n(c.depth)&&(c.depth=2),n(c.colors)&&(c.colors=!1),n(c.customInspect)&&(c.customInspect=!0),c.colors&&(c.stylize=r),b(c,e,c.depth)}function I(e){return null===e}function O(e){return"object"==typeof e&&null!==e}t._extend=function(e,t){if(!t||!O(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e},T.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},T.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var A=/%[sdj%]/g;t.format=function(e){if(!o(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(T(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,a=n.length,c=String(e).replace(A,(function(e){if("%%"===e)return"%";if(r>=a)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),l=n[r];r<a;l=n[++r])I(l)||!O(l)?c+=" "+l:c+=" "+T(l);return c},t.inspect=T}));function genErrorMessage(e,t){const r="number"==typeof t?t:void 0!==t&&"string"!=typeof t?t.code:void 0,n="number"!=typeof t&&"string"!=typeof t&&void 0!==t&&void 0!==t.serverCode?t.serverCode:void 0,o=`${void 0!==r?` Error Code ${r}`:""}${void 0!==n?`, server Code ${n}`:""}`;let a;return a="string"==typeof e&&e?addPeriodIfNeeded(e):Array.isArray(e)&&"string"==typeof e[0]&&e[0]?addPeriodIfNeeded(util.format(e[0],...e.slice(1))):"",`${""===o?"":`${o} - `}${a}`}class RtmBaseError extends Error{constructor(e,t){super(genErrorMessage(e,t)),this.originalError=void 0,this.code=void 0,this.serverCode=void 0,"number"==typeof t?this.code=t:"string"==typeof t?this.name=t:void 0!==t&&(t.originalError&&(this.originalError=t.originalError),void 0!==t.code&&(this.code=t.code),void 0!==t.serverCode&&(this.serverCode=t.serverCode))}}class RtmInternalError extends Error{constructor(e,t){super(genErrorMessage(e,t)),this.code=t,this.name="RtmInternalError"}}const genError=()=>class extends RtmInternalError{constructor(e){const t=Object.keys(e);super(e[t[0]],t[0])}},CommonError=genError();class RtmTimeoutError extends RtmBaseError{constructor(...e){super(...e),this.name="RtmTimeoutError"}}class RtmInvalidArgumentError extends RtmBaseError{constructor(...e){super(...e),this.name="RtmInvalidArgumentError"}}class RtmInvalidStatusError extends RtmBaseError{constructor(...e){super(...e),this.name="RtmInvalidStatusError"}}class RtmLimitExceededError extends RtmBaseError{constructor(...e){super(...e),this.name="RtmLimitExceededError"}}class RtmInvokeTooOftenError extends RtmBaseError{constructor(...e){super(...e),this.name="RtmInvokeTooOftenError"}}class RtmUnavailableError extends RtmBaseError{constructor(...e){super(...e),this.name="RtmUnavailableError",this.serverCode=void 0,this.statusCode=void 0}}class RtmUnauthenticatedError extends RtmBaseError{constructor(...e){super(...e),this.name="RtmUnauthenticatedError",this.serverCode=void 0}}class RtmUnknownError extends RtmBaseError{constructor(...e){super(...e),this.name="RtmUnknownError"}}const isTimeout=e=>e instanceof RtmTimeoutError||e instanceof TimeoutError,isRtmError=e=>e instanceof RtmBaseError,invalidArgumentMessage="The %s in the arguments is invalid",genTimeoutMessage=(e,t,r)=>['Executing "%s.%s" timed out after %ds',e,t,r/1e3],APP_ID_LENGTH=32,AP_REQUEST_TIMEOUT=1e4,SOCKET_KEEPALIVE_TIMEOUT=6e3,KEEPALIVE_INTERVAL=2e3,SOCKET_RETRY_INTERVAL=2e3,CLIENT_LOGIN_TIMEOUT=12e3,LOGIN_RESP_TIMEOUT=6e3,MESSAGE_MIN_COMPRESSION_LEN=128,MESSAGE_SEND_TIMEOUT=1e4,COMMON_REQUEST_TIMEOUT=1e4,DIALOGUE_EXPIRE_TIMEOUT=1e4,LRU_MAX_ITEMS=1e4,MESSAGE_RETRY_TIMEOUT=6e3,LOGOUT_SOCKET_CLOSE_TIMEOUT=5e3,LOGIN_QPS_LIMIT=2,TEXT_MESSAGE_MAX_TEXT_BYTES=32768,ONLINE_MESSAGE_DEDUP_DELAY=750,OFFLINE_MESSAGE_DEDUP_DELAY=1500,MSG_DEDUP_MAX_LEN=200,LOG_UPLOAD_MAX_ITEMS=40,MAX_JOINED_CHANNELS=20,INVITATION_EXPIRE_TIMEOUT=6e4,INVITATION_EXTRA_MAX_BYTES=8192,REMOTE_INVITATION_WAIT_ACCEPT_ACK_TIMEOUT=5e3,REMOTE_INVITATION_ACCEPT_RESEND_INTERVAL=1e3,LOCAL_INVITATION_ACK_TIMEOUT=3e4,LOCAL_INVITATION_RESEND_INTERVAL=2e3,CHANNEL_ATTRIBUTES_MAX_KEY_COUNT=512,CHANNEL_ATTRIBUTES_CACHE_MAX_LENGTH=1e4;function isValidAppId(e){return/^[\dA-Za-z]{32}$/.test(e)}function isValidId(e){return"string"==typeof e&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&"null"!==e}function isValidIp(e){let t;try{t=e.split(".").map((e=>Number(e)))}catch{return!1}if(4!==t.length)return!1;if(0===t[0])return!1;for(const e of t){if(!Number.isInteger(e))return!1;if(e<0||e>255)return!1}return!0}function validAttributes({attributes:e,attrSizeMap:t,maxAttrsCount:r,maxAttrValueSize:n,maxTotalSize:o}){if(!isPlainObject(e))throw new RtmInvalidArgumentError("attributes must be an object",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT);if(Object.keys(e).length>r)throw new RtmLimitExceededError(`Exceed the limit of ${r} attributes`,ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW);if(0===Object.keys(e).length)throw new RtmInvalidArgumentError("The attributes is an empty object",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT);let a=0;for(const[t,r]of Object.entries(e)){const e=getUtf8StringSize(t),o=getUtf8StringSize(r);if(0===e||e>32)throw new RtmInvalidArgumentError("Invalid attribute key",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT);if(o>n)throw new RtmLimitExceededError(`Invalid attribute value, over the limit of ${n} bytes`,ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW);if("string"!=typeof r||0===r.length)throw new RtmInvalidArgumentError("Invalid attribute value",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT);a+=e,a+=o}if(a>o)throw new RtmLimitExceededError("The attributes size overflow",ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW);if(void 0!==t){if(Object.keys(t).length>r)throw new RtmLimitExceededError(`Exceed the limit of ${r} attributes`,ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW);let e=0;for(const[r,o]of Object.entries(t)){const t=getUtf8StringSize(r);if(0===t)throw new RtmInvalidArgumentError("Invalid attribute key",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT);if(o>n)throw new RtmLimitExceededError(`Invalid attribute value, over the limit of ${n} bytes`,ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW);e+=t,e+=o}if(e>o)throw new RtmLimitExceededError("The attributes size overflow",ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW)}}function checkValidAttrGetByKeysArgs(e,t){if(!Array.isArray(t)||0===t.length||t.length>32||t.some((e=>0===e.length||e.length>32)))throw new RtmInvalidArgumentError("arguments is not valid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT);if(!isValidId(e))throw new RtmInvalidArgumentError("ID is invalid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT)}const UINT32_MAX=4294967295;function getRandomInt(e,t){const r=Math.ceil(e),n=Math.floor(t);return Math.floor(Math.random()*(n-r+1))+e}function getRandomUInt64(){const e=getRandomInt(0,UINT32_MAX),t=getRandomInt(1,UINT32_MAX);return new long_1(e,t,!0)}function getSid(e){return e.toString().padEnd(32,"0")}function assertNever(e,t){return new TypeError(`Unexpected ${e}: ${t}`)}function calIpDistance(e,t){const r=e.split(".").map((e=>Number(e))),n=t.split(".").map((e=>Number(e)));return Math.sqrt(1e3*(r[0]-n[0])**2+100*(r[1]-n[1])**2+10*(r[2]-n[2])**2+1*(r[3]-n[3])**2)}function longToStringIfNeeded(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}const prefixSeqMap=new Map;function uniquePrefixedId(e,t){const r=`${e}${t||""}`,n=prefixSeqMap.get(r)||1;return prefixSeqMap.set(r,n+1),`${e}${n}`}const getUTCTimestamp=()=>{const e=new Date;return`${e.toISOString().split("T")[1].replace(/\..+/,"")}.${e.getMilliseconds()}`},getKeys=Object.keys,getEntries=Object.entries.bind(Object);function isLongNum(e){return"number"==typeof e||long_1.isLong(e)}const getName=e=>Object.keys(e)[0],addPeriodIfNeeded=e=>"string"==typeof e?e.endsWith(".")?e:`${e}.`:e;function postWithAbortSignal(e,{body:t,headers:r={},timeout:n=1e4,signal:o}){return new Promise(((a,c)=>{const l=wx.request({url:e,header:r,data:t,timeout:n,method:"POST",success:({data:e,statusCode:t})=>{if(t>=200&&t<300||304===t){if(e instanceof ArrayBuffer)return void c(new TypeError("Invalid response type ArrayBuffer"));if("string"==typeof e)return void c(new TypeError("Invalid response type string"));a({response:e})}else{const r=new RtmUnavailableError(["Post XHR failure, status %d",t]);r.statusCode=t,r.message=e.toString()||`Request failed, status ${t}`,c(r)}},fail:e=>{const t=new RtmUnavailableError(["Post failure"]);t.message=e.errMsg,c(t)}});if(void 0!==o){const e=()=>{l.abort();const t=new Error("The request aborted.");t.name="AbortError",c(t),o.removeEventListener("abort",e)};o.addEventListener("abort",e)}}))}function validMessage(e,t){if(!isPlainObject(e))throw new RtmInvalidArgumentError("message object is not a plain object",t);if("string"!=typeof e.text)throw new RtmInvalidArgumentError("Unsupported message type",t)}async function commonSendMessage({message:e,peerId:t,toPeer:r,session:n,errorCodes:o,diff:a,options:c}){if(void 0===n)throw new RtmInvalidStatusError("The client is not logged in. Cannot do the operation",o.NOT_LOGGED_IN);let l=!1;if("TEXT"===e.messageType&&e.text.startsWith(END_CALL_PREFIX)&&r){const[t,r,n]=e.text.split("_");if(void 0===n||!isValidId(r)||t!==END_CALL_PREFIX)throw new RtmInvalidArgumentError("Message is not valid",PEER_MESSAGE_ERR_INVALID_MESSAGE);l=!0}if("string"!=typeof e.text)throw new RtmInvalidArgumentError("Invalid message type",PEER_MESSAGE_ERR_INVALID_MESSAGE);const u=Date.now(),_=n.messageSentTimes.length-1,p=n.messageSentTimes[_];if(p&&p+3e3<u)n.messageSentTimes=[u];else{for(let e=_;e>=0;e--){if(n.messageSentTimes[e]+3e3<u){n.messageSentTimes=n.messageSentTimes.slice(e+1,_+1);break}if(_-e+1>=180)throw new RtmLimitExceededError("Message sent failed, exceeded the 180 message in 3 seconds",o.TOO_OFTEN)}n.messageSentTimes.push(u)}if(l){const[,r,o]=e.text.split("_");return n.sendInvitationMessage({peerId:t,type:"CallCancel",extra:o,channelId:r,callId:"0"})}return n.sendTextMessage(e.text,t,r,c,MESSAGE_SEND_TIMEOUT-a)}function uint8ArrayToArrayBuffer(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function decodeUint8ArrayToString(e){return(new TextDecoder).decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function encodeStringToUint8Array(e){return(new TextEncoder).encode(e)}function getUtf8StringSize(e){return(new TextEncoder).encode(e).length}const isProd=!0;var s=1e3,m=60*s,h=60*m,d=24*h,w=7*d,y=365.25*d,ms=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return parse(e);if("number"===r&&isFinite(e))return t.long?fmtLong(e):fmtShort(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*y;case"weeks":case"week":case"w":return r*w;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*h;case"minutes":case"minute":case"mins":case"min":case"m":return r*m;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function fmtShort(e){var t=Math.abs(e);return t>=d?Math.round(e/d)+"d":t>=h?Math.round(e/h)+"h":t>=m?Math.round(e/m)+"m":t>=s?Math.round(e/s)+"s":e+"ms"}function fmtLong(e){var t=Math.abs(e);return t>=d?plural(e,t,d,"day"):t>=h?plural(e,t,h,"hour"):t>=m?plural(e,t,m,"minute"):t>=s?plural(e,t,s,"second"):e+" ms"}function plural(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}function setup(e){function t(e){let n,o=null;function a(...e){if(!a.enabled)return;const r=a,o=Number(new Date),c=o-(n||o);r.diff=c,r.prev=n,r.curr=o,n=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let l=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,o)=>{if("%%"===n)return"%";l++;const a=t.formatters[o];if("function"==typeof a){const t=e[l];n=a.call(r,t),e.splice(l,1),l--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null===o?t.enabled(e):o,set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=ms,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}var common=setup,browser=createCommonjsModule((function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(o=n))})),t.splice(o,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=common(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),key="__global_unique_id__",gud=function(){return commonjsGlobal[key]=(commonjsGlobal[key]||0)+1};function arrayEach(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}var _arrayEach=arrayEach;function baseAssign(e,t){return e&&_copyObject(t,keys_1(t),e)}var _baseAssign=baseAssign;function baseAssignIn(e,t){return e&&_copyObject(t,keysIn_1(t),e)}var _baseAssignIn=baseAssignIn;function copySymbols(e,t){return _copyObject(e,_getSymbols(e),t)}var _copySymbols=copySymbols,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbolsIn=nativeGetSymbols$1?function(e){for(var t=[];e;)_arrayPush(t,_getSymbols(e)),e=_getPrototype(e);return t}:stubArray_1,_getSymbolsIn=getSymbolsIn;function copySymbolsIn(e,t){return _copyObject(e,_getSymbolsIn(e),t)}var _copySymbolsIn=copySymbolsIn;function getAllKeysIn(e){return _baseGetAllKeys(e,keysIn_1,_getSymbolsIn)}var _getAllKeysIn=getAllKeysIn,objectProto$f=Object.prototype,hasOwnProperty$c=objectProto$f.hasOwnProperty;function initCloneArray(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$c.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var _initCloneArray=initCloneArray;function cloneDataView(e,t){var r=t?_cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var _cloneDataView=cloneDataView,reFlags=/\w*$/;function cloneRegExp(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var _cloneRegExp=cloneRegExp,symbolProto$2=_Symbol?_Symbol.prototype:void 0,symbolValueOf$1=symbolProto$2?symbolProto$2.valueOf:void 0;function cloneSymbol(e){return symbolValueOf$1?Object(symbolValueOf$1.call(e)):{}}var _cloneSymbol=cloneSymbol,boolTag$2="[object Boolean]",dateTag$2="[object Date]",mapTag$3="[object Map]",numberTag$2="[object Number]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$2="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$3="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(e,t,r){var n=e.constructor;switch(t){case arrayBufferTag$2:return _cloneArrayBuffer(e);case boolTag$2:case dateTag$2:return new n(+e);case dataViewTag$3:return _cloneDataView(e,r);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return _cloneTypedArray(e,r);case mapTag$3:return new n;case numberTag$2:case stringTag$2:return new n(e);case regexpTag$2:return _cloneRegExp(e);case setTag$3:return new n;case symbolTag$2:return _cloneSymbol(e)}}var _initCloneByTag=initCloneByTag,mapTag$4="[object Map]";function baseIsMap(e){return isObjectLike_1(e)&&_getTag(e)==mapTag$4}var _baseIsMap=baseIsMap,isMap=_baseIsMap,isMap_1=isMap,setTag$4="[object Set]";function baseIsSet(e){return isObjectLike_1(e)&&_getTag(e)==setTag$4}var _baseIsSet=baseIsSet,isSet=_baseIsSet,isSet_1=isSet,CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4,argsTag$3="[object Arguments]",arrayTag$2="[object Array]",boolTag$3="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",mapTag$5="[object Map]",numberTag$3="[object Number]",objectTag$4="[object Object]",regexpTag$3="[object RegExp]",setTag$5="[object Set]",stringTag$3="[object String]",symbolTag$3="[object Symbol]",weakMapTag$2="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",cloneableTags={};function baseClone(e,t,r,n,o,a){var c,l=t&CLONE_DEEP_FLAG,u=t&CLONE_FLAT_FLAG,_=t&CLONE_SYMBOLS_FLAG;if(r&&(c=o?r(e,n,o,a):r(e)),void 0!==c)return c;if(!isObject_1(e))return e;var p=isArray_1(e);if(p){if(c=_initCloneArray(e),!l)return _copyArray(e,c)}else{var f=_getTag(e),E=f==funcTag$2||f==genTag$1;if(isBuffer_1(e))return _cloneBuffer(e,l);if(f==objectTag$4||f==argsTag$3||E&&!o){if(c=u||E?{}:_initCloneObject(e),!l)return u?_copySymbolsIn(e,_baseAssignIn(c,e)):_copySymbols(e,_baseAssign(c,e))}else{if(!cloneableTags[f])return o?e:{};c=_initCloneByTag(e,f,l)}}a||(a=new _Stack);var g=a.get(e);if(g)return g;a.set(e,c),isSet_1(e)?e.forEach((function(n){c.add(baseClone(n,t,r,n,e,a))})):isMap_1(e)&&e.forEach((function(n,o){c.set(o,baseClone(n,t,r,o,e,a))}));var b=p?void 0:(_?u?_getAllKeysIn:_getAllKeys:u?keysIn_1:keys_1)(e);return _arrayEach(b||e,(function(n,o){b&&(n=e[o=n]),_assignValue(c,o,baseClone(n,t,r,o,e,a))})),c}cloneableTags[argsTag$3]=cloneableTags[arrayTag$2]=cloneableTags[arrayBufferTag$3]=cloneableTags[dataViewTag$4]=cloneableTags[boolTag$3]=cloneableTags[dateTag$3]=cloneableTags[float32Tag$2]=cloneableTags[float64Tag$2]=cloneableTags[int8Tag$2]=cloneableTags[int16Tag$2]=cloneableTags[int32Tag$2]=cloneableTags[mapTag$5]=cloneableTags[numberTag$3]=cloneableTags[objectTag$4]=cloneableTags[regexpTag$3]=cloneableTags[setTag$5]=cloneableTags[stringTag$3]=cloneableTags[symbolTag$3]=cloneableTags[uint8Tag$2]=cloneableTags[uint8ClampedTag$2]=cloneableTags[uint16Tag$2]=cloneableTags[uint32Tag$2]=!0,cloneableTags[errorTag$2]=cloneableTags[funcTag$2]=cloneableTags[weakMapTag$2]=!1;var _baseClone=baseClone;function last(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var last_1=last;function baseSlice(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(o);++n<o;)a[n]=e[n+t];return a}var _baseSlice=baseSlice;function parent(e,t){return t.length<2?e:_baseGet(e,_baseSlice(t,0,-1))}var _parent=parent;function baseUnset(e,t){return t=_castPath(t,e),null==(e=_parent(e,t))||delete e[_toKey(last_1(t))]}var _baseUnset=baseUnset;function customOmitClone(e){return isPlainObject_1(e)?void 0:e}var _customOmitClone=customOmitClone;function flatten(e){return(null==e?0:e.length)?_baseFlatten(e,1):[]}var flatten_1=flatten;function flatRest(e){return _setToString(_overRest(e,void 0,flatten_1),e+"")}var _flatRest=flatRest,CLONE_DEEP_FLAG$1=1,CLONE_FLAT_FLAG$1=2,CLONE_SYMBOLS_FLAG$1=4,omit=_flatRest((function(e,t){var r={};if(null==e)return r;var n=!1;t=_arrayMap(t,(function(t){return t=_castPath(t,e),n||(n=t.length>1),t})),_copyObject(e,_getAllKeysIn(e),r),n&&(r=_baseClone(r,CLONE_DEEP_FLAG$1|CLONE_FLAT_FLAG$1|CLONE_SYMBOLS_FLAG$1,_customOmitClone));for(var o=t.length;o--;)_baseUnset(r,t[o]);return r})),omit_1=omit,hasProp=Object.prototype.hasOwnProperty;function throwsMessage(e){return"[Throws: "+(e?e.message:"?")+"]"}function safeGetValueFromPropertyOnObject(e,t){if(hasProp.call(e,t))try{return e[t]}catch(e){return throwsMessage(e)}return e[t]}function ensureProperties(e){var t=[];return function e(r){if(null===r||"object"!=typeof r)return r;if(-1!==t.indexOf(r))return"[Circular]";if(t.push(r),"function"==typeof r.toJSON)try{var n=e(r.toJSON());return t.pop(),n}catch(e){return throwsMessage(e)}if(Array.isArray(r)){var o=r.map(e);return t.pop(),o}var a=Object.keys(r).reduce((function(t,n){return t[n]=e(safeGetValueFromPropertyOnObject(r,n)),t}),{});return t.pop(),a}(e)}var safeJsonStringify=function(e,t,r){return JSON.stringify(ensureProperties(e),t,r)},ensureProperties_1=ensureProperties;safeJsonStringify.ensureProperties=ensureProperties_1;const uploadLog=browser("RTM:DEBUG");var UploadState;uploadLog.enabled=!isProd,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(UploadState||(UploadState={}));class LogUploader{constructor(e){this.uploadRequest=void 0,this.uploadState=void 0,this.uploadResendCount=void 0,this.LogCache=void 0,this.LogsToPost=void 0,this.processId=void 0,this.sdkVersion=void 0,this.logId=void 0,this.processId=e.processId,this.sdkVersion=e.sdkVersion,this.uploadRequest=e.uploadRequest,this.uploadState=UploadState.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}upload(e){this.LogCache.push(e),this.uploadState===UploadState.Free&&(this.LogsToPost=this.LogCache.length<LOG_UPLOAD_MAX_ITEMS?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,LOG_UPLOAD_MAX_ITEMS),this.postLog(this.LogsToPost))}postLog(e){this.uploadState=UploadState.Uploading,setTimeout((async()=>{const t={sdk_version:this.sdkVersion,process_id:this.processId,payload:JSON.stringify(e)};try{await this.uploadRequest(t)}catch(e){const t=this.uploadResendCount++<2?200:1e4;return void setTimeout((()=>this.postLog(this.LogsToPost)),t)}uploadLog(`The logs uploaded for "process-${processId}"`),0!==this.LogCache.length?(this.uploadResendCount=0,this.LogsToPost=this.LogCache.length<LOG_UPLOAD_MAX_ITEMS?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,LOG_UPLOAD_MAX_ITEMS),this.postLog(this.LogsToPost)):this.uploadState=UploadState.Free}),3e3)}}const uploadRequest=e=>{let t=0;const r=async()=>{try{await postWithAbortSignal("https://logservice-rtm.agora.io/upload/v1",{body:e,timeout:1e4,headers:{"Content-Type":"application/json"}})}catch{t+=1,t<=2&&await r()}};r()},logUploader=new LogUploader({processId:`process-${processId}`,sdkVersion:`Agora_RTM_SDK_for_MINIAPP_${BUILD}`,uploadRequest}),blacklistedKeywords=["text","payload","rawMessage","thumbnail","token","detail","ticket","attributeInfos","attributeMaps","key","value"],filterLogObject=e=>omit_1(e,blacklistedKeywords),getPlain=e=>"object"==typeof e?isPlainObject(e)?filterLogObject(e):e.constructor&&e.constructor.name:e,formatLogTextAndParameters=(e,t)=>{if(e instanceof Error)return e.message;if("string"!=typeof e)return JSON.stringify(filterLogObject(e));const r=t.map((e=>e instanceof Error?e.message:"object"==typeof e?safeJsonStringify(Array.isArray(e)?e.map(getPlain):getPlain(e)):e));return util.format(e.replace(/%[%Oo]/g,(e=>"%%"===e?"%":"%o"===e||"%O"===e?"%s":e)),...r)};let logItemId=1;const logAndUploadGenerator=(e,t,r)=>{const n=browser(e);n.enabled=!0,n.log=r,n.useColors=!1;return(r,...o)=>{if(t.enableLogUpload){const t=addPeriodIfNeeded(r);var a=formatLogTextAndParameters(t,o);logUploader.upload({log_item_id:""+logItemId++,log_level:e,payload_str:`[${getUTCTimestamp()}] ${e} - ${a.length>256?a.slice(0,256):a}`})}const c=()=>{const e=a||formatLogTextAndParameters(addPeriodIfNeeded(r),o);n(e)};switch(e){case"RTM:INFO":t.logFilter.info&&c();break;case"RTM:WARN":t.logFilter.warn&&c();break;case"RTM:ERROR":t.logFilter.error&&c();break;case"RTM:TRACK":t.logFilter.track&&c();break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":t.logFilter.debug&&c()}}};let loggerId;const prefixer=e=>t=>`${1===loggerId||void 0===e?"":`Ins#${e} `}${t}`,loggerGenerator=(e,t,r)=>{const n=prefixer(loggerId);return logAndUploadGenerator(`RTM:${t}`,r,((t,...r)=>e(n(t))))},createEventBase=()=>class LoggerBaseWithEmitter extends events.EventEmitter{constructor(e,t,r=!1){if(super(),this.logger=e,this.name=t,this.logError=void 0,this.invokeTracker=void 0,this.resultTracker=void 0,this.errorTracker=void 0,this.eventTracker=void 0,this.info=void 0,this.warn=void 0,this.log=void 0,this.genLogger=void 0,this.loggerId=void 0,this.loggerId=e.loggerId,this.info=e.info,this.warn=e.warn,this.logError=e.logError,this.genLogger=e.genLogger,this.log=e.genLogger("RTM:DEBUG",`<${t}> `),this.invokeTracker=e.genTracker("Invoke"),this.eventTracker=e.genTracker("Event"),this.resultTracker=e.genTracker("Result"),this.errorTracker=e.genTracker("Error"),r){const e=this.emit.bind(this),r=(...r)=>{const[n,...o]=r;this.eventTracker("%s: "+(o.length>0?`%s emitted with args: ${o.map((()=>"%o"))}`:"%s emitted"),t,n,...o);try{e(...r)}catch(e){this.logError("Caught in the callback function of the event %s, original error %o",n,e)}};this.emit=r}}};function initLoggerId(){return loggerId=gud(),loggerId}const genInfoLogger=e=>loggerGenerator(console.log,"INFO",e),genWarnLogger=e=>loggerGenerator(console.warn,"WARN",e),genErrorLogger=e=>loggerGenerator(console.error,"ERROR",e),debugLoggerGenerator=(e,t)=>(r,n="")=>{const o=prefixer(e),a=console.debug,c=logAndUploadGenerator(r,t,((e,...t)=>a(o(e))));return(e,...t)=>c(n+e,...t)},trackLoggerGenerator=(e,t)=>r=>debugLoggerGenerator(e,t)("RTM:TRACK",`[${r}] `);function logged(e,t,r){let n=r;void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));const o=n.value;return n.value=function(...e){this.invokeTracker("%s: "+(e.length>0?`%s with args: ${e.map((()=>"%o"))}`:"%s"),this.name,t,...e);try{var r=o.apply(this,e)}catch(r){throw this.logError(`${void 0!==r.code?`Error Code ${r.code}: `:""}%s failed${e.length>0?` with args: ${e.map((()=>"%o"))}`:""}`,t,...e),r.originalError&&this.logError(r.originalError),this.errorTracker(r),r}const n=Date.now();return(async()=>{let o;try{o=await r}catch(r){return this.logError(`${void 0!==r.code?`Error Code ${r.code}: `:""}%s failed${e.length>0?` with args: ${e.map((()=>"%o"))}`:""}`,t,...e),r.originalError&&this.logError(r.originalError),void this.errorTracker(r)}o!==r?void 0===o?this.resultTracker("%s promise resolves after %dms",t,Date.now()-n):this.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-n,o):this.resultTracker("%s result is %o",t,o)})(),r},n}const{URI:URI$1}=$root,{Wrapper:Wrapper$1,...PacketsAndURI}=ProtoPackets,Packets=omit_1(PacketsAndURI,"URI"),nameToUri=e=>{const t=URI$1[`${e}Uri`];if("number"!=typeof t||0===t)throw new TypeError("Got Unknown URI Name");return t};function uriToPacketName(e){return URI$1[e].slice(0,-3)}function getWrappedByName(e,t){const r=nameToUri(e),n=Packets[e],o=new n(t),a=n.encode(o).finish();return new Wrapper$1({uri:r,data:a})}var nativeFloor=Math.floor,nativeRandom=Math.random;function baseRandom(e,t){return e+nativeFloor(nativeRandom()*(t-e+1))}var _baseRandom=baseRandom;function shuffleSelf(e,t){var r=-1,n=e.length,o=n-1;for(t=void 0===t?n:t;++r<t;){var a=_baseRandom(r,o),c=e[a];e[a]=e[r],e[r]=c}return e.length=t,e}var _shuffleSelf=shuffleSelf;function arrayShuffle(e){return _shuffleSelf(_copyArray(e))}var _arrayShuffle=arrayShuffle;function baseValues(e,t){return _arrayMap(t,(function(t){return e[t]}))}var _baseValues=baseValues;function values(e){return null==e?[]:_baseValues(e,keys_1(e))}var values_1=values;function baseShuffle(e){return _shuffleSelf(values_1(e))}var _baseShuffle=baseShuffle;function shuffle(e){return(isArray_1(e)?_arrayShuffle:_baseShuffle)(e)}var shuffle_1=shuffle;const EDGE_ENV_PORT={0:9590,1:9592},getApUrl=e=>`https://${e}/api/v1`,AP_DOMAINS_CN=["ap-web-1.agoraio.cn","ap-web-2.agoraio.cn"],AP_BACKUP_DOMAINS_CN=["ap-web-3.agoraio.cn","ap-web-4.agoraio.cn"],cnUrl$=of(...shuffle_1(AP_DOMAINS_CN.map(getApUrl))),cnBackupUrl$=of(...shuffle_1(AP_BACKUP_DOMAINS_CN.map(getApUrl))),SocketError=genError();class Socket extends(createEventBase()){get address(){return`${this.ip}:${EDGE_ENV_PORT[this.env]}`}constructor(e,t,r,n,o){if(super(o,uniquePrefixedId("Socket-",o.loggerId)),this.ip=e,this.env=t,this.ticket=r,this.context=n,this.isActiveClose=!1,this.loggedIn=!1,this.receivedPacket=new Subject,this.open$=void 0,this.input$=new Subject,this.userJoin$=new Subject,this.attemptsSinceLastError=0,this.message$=new Subject,this.socket$=void 0,this.toClose=new Subject,this.toReconnect=new Subject,this.sendLogger=this.genLogger("RTM:MSG:SEND"),this.receiveLogger=this.genLogger("RTM:MSG:RECV"),this.socketReconnector=e=>{const t=e=>(this.attemptsSinceLastError+=1,this.warn("The %s of Env %d reconnecting %s",this.name,this.env,e.message),timer(SOCKET_RETRY_INTERVAL));return e.pipe(catchError((e=>(this.log("socket connection closed"),this.loggedIn=!1,this.attemptsSinceLastError>=2?(this.warn("socket connection failure"),this.emit("connectionFailure"),this.close(),throwError(e)):this.isActiveClose?EMPTY:(this.emit("reconnect"),throwError(e))))),retryWhen((e=>e.pipe(switchMap(t)))))},0!==t&&1!==t)throw new SocketError({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!isValidIp(e))throw new SocketError({IP_NOT_VALID:"The ip from ap is not valid"});const a=EDGE_ENV_PORT[t];this.log("Opening websocket address %s for the Env %d",this.ip,this.env);const c=merge(this.input$,this.userJoin$.pipe(rateLimit(LOGIN_QPS_LIMIT)),this.message$).pipe(map$1((e=>uint8ArrayToArrayBuffer(Wrapper.encode(e).finish()))));this.socket$=merge(makeWebSocketObservable(`wss://miniapp.agoraio.cn/rtm/${e.split(".").join("-")}-${a}/`,{timeout:4e3}),this.toReconnect).pipe(map$1((e=>{if(e instanceof Error)throw this.warn("Env_%d: Force reconnect the socket",this.env),e;return e(c).pipe(map$1((e=>Wrapper.decode(new Uint8Array(e)))))})),this.socketReconnector),this.open$=this.socket$.pipe(tap((e=>{this.log("Websocket opened",this.name),e.subscribe((({data:e,uri:t})=>{const r=uriToPacketName(t),n=Packets[r].decode(e),o=mergeWith_1({},n,((e,t)=>t instanceof long_1?longToStringIfNeeded(t):t));let a=!1;if(n instanceof GroupEnterNotice||n instanceof GroupLeaveNotice){const{instance:e}=n;e.lessThanOrEqual(UINT32_MAX)&&(a=!0)}if(n instanceof Message||n instanceof Ack){const{instance:e,dialogue:t,sequence:r}=n;(t.lessThanOrEqual(UINT32_MAX)||e.lessThanOrEqual(UINT32_MAX)||r.lessThan(1))&&(a=!0)}a?this.warn("Env_%d: Illegal %s, abandoned %o",this.env,r,o):("Pong"!==r&&this.receiveLogger("Env_%d: %s %o",this.env,r,o),this.receivedPacket.next([r,n]))}),(()=>{}))})),mapTo(void 0),takeUntil(this.toClose),share())}sendPacket(e,t){if("Ping"!==e){const r=mapValues_1(t,(e=>e instanceof long_1?longToStringIfNeeded(e):e));this.sendLogger("Env_%d: %s %o",this.env,e,r)}const r=getWrappedByName(e,t);"UserJoin"===e?this.userJoin$.next(r):"Message"===e?this.message$.next(r):this.input$.next(r)}close(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}fromReceived(e){return this.receivedPacket.pipe(tap((([e,t])=>{"UserResp"===e&&(this.attemptsSinceLastError=0,this.loggedIn=!0),"UserDrop"===e&&this.emit("socketUserDrop",t)})),filter((([t])=>t===e)),map$1((([,e])=>e)))}forceReconnect(){this.toReconnect.next(new SocketError({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}var cjsPonyfill=createCommonjsModule((function(e,t){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?l(e):t}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=a(e);if(t){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return u(this,r)}}function p(e,t,r){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(){r(this,e),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return o(e,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var r=this.listeners[e],n=0,o=r.length;n<o;n++)if(r[n]===t)return void r.splice(n,1)}},{key:"dispatchEvent",value:function(e){var t=this;if(e.type in this.listeners){for(var r=function(r){setTimeout((function(){return r.call(t,e)}))},n=this.listeners[e.type],o=0,a=n.length;o<a;o++)r(n[o]);return!e.defaultPrevented}}}]),e}(),E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,e);var t=_(n);function n(){var e;return r(this,n),(e=t.call(this)).listeners||f.call(l(e)),Object.defineProperty(l(e),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(l(e),"onabort",{value:null,writable:!0,configurable:!0}),e}return o(n,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),p(a(n.prototype),"dispatchEvent",this).call(this,e)}}]),n}(f),g=function(){function e(){r(this,e),Object.defineProperty(this,"signal",{value:new E,writable:!0,configurable:!0})}return o(e,[{key:"abort",value:function(){var e;try{e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),e}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(g.prototype[Symbol.toStringTag]="AbortController",E.prototype[Symbol.toStringTag]="AbortSignal"),t.AbortController=g,t.AbortSignal=E,t.abortableFetch=function(e){"function"==typeof e&&(e={fetch:e});var t=e,r=t.fetch,n=t.Request,o=void 0===n?r.Request:n,a=t.AbortController,c=t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,l=void 0!==c&&c;if(!function(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}({fetch:r,Request:o,AbortController:a,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:l}))return{fetch:r,Request:u};var u=o;(u&&!u.prototype.hasOwnProperty("signal")||l)&&((u=function(e,t){var r;t&&t.signal&&(r=t.signal,delete t.signal);var n=new o(e,t);return r&&Object.defineProperty(n,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),n}).prototype=o.prototype);var _=r;return{fetch:function(e,t){var r=u&&u.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(r){var n;try{n=new DOMException("Aborted","AbortError")}catch(e){(n=new Error("Aborted")).name="AbortError"}if(r.aborted)return Promise.reject(n);var o=new Promise((function(e,t){r.addEventListener("abort",(function(){return t(n)}),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([o,_(e,t)])}return _(e,t)},Request:u}}}));const ApResErrorMessage={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token"},ApResErrorCode={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY"};class AccessPoint extends(createEventBase()){constructor(e,t){super(t,"AccessPoint"),this.context=e,this.apEdgeInfo$=void 0,this.apEdgeInfoEndFirst$=void 0,this.apFinish$=new Subject,this.fetchAp=(e,t)=>{const r=uniquePrefixedId("AP-",this.loggerId);this.log("The AccessPoint requests %s(%s)",e,r);const n=new cjsPonyfill.AbortController;return this.apFinish$.pipe(first()).subscribe((()=>n.abort())),defer((()=>{const o=getRandomInt(0,Number.MAX_SAFE_INTEGER);return this.log("The %s request uid param is %d",r,o),postWithAbortSignal(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:1,key:t||this.context.key,cname:this.context.uid,detail:{},uid:o,sid:this.context.sid},signal:n.signal})})).pipe(catchError((t=>("AbortError"!==t.name&&(this.logError(t),this.warn("The AP server %s request failure",e)),EMPTY))),mergeMap((async({response:e})=>{const t=e;this.log("The %s response is %o",r,t);const{code:n,addresses:o,detail:{9:a}}=t;if(0!==n){let e=n;if(n.toString().length>4){const t=n.toString().padStart(8,"0"),r=t.slice(0,4);201===parseInt(r,10)&&(e=parseInt(t.slice(4,8),10))}const t=e.toString();if(!Object.keys(ApResErrorCode).includes(t)){const t=new RtmUnavailableError(["Login is rejected by the server. The response code is %d",n],LOGIN_ERR_REJECTED);return t.serverCode=e,throwError(t)}const r=ApResErrorCode[t],o=ApResErrorMessage[r];switch(r){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":{const e=new RtmUnauthenticatedError(o,LOGIN_ERR_INVALID_APP_ID);return e.serverCode=n,throwError(e)}case"INVALID_USER_ID":{const e=new RtmUnauthenticatedError(o,LOGIN_ERR_INVALID_ARGUMENT);return e.serverCode=n,throwError(e)}case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":{const e=new RtmUnauthenticatedError(o,LOGIN_ERR_TOKEN_EXPIRED);return e.serverCode=n,throwError(e)}case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":{const e=new RtmUnauthenticatedError(o,LOGIN_ERR_INVALID_TOKEN);return e.serverCode=n,throwError(e)}default:return throwError(assertNever("ApResErrType",r))}}let c=o;return this.context.area=a,of(...c,queueScheduler)})),mergeAll())};let r=1;this.apEdgeInfoEndFirst$=timer(0,2e3).pipe(take(1),takeUntil(this.apFinish$),map$1((()=>{5===r&&(r=1);const e=`https://ap-web-${r}.agoraio.cn/api/v1`;return r+=1,e})),mergeMap((e=>this.fetchAp(e))),timeout(AP_REQUEST_TIMEOUT),catchError((e=>(e instanceof TimeoutError&&this.warn("AP request timeout"),throwError(e)))),distinct((({ip:e})=>e))),this.apEdgeInfo$=timer(0,2e3).pipe(take(4),takeUntil(this.apFinish$),map$1((()=>{5===r&&(r=1);const e=`https://ap-web-${r}.agoraio.cn/api/v1`;return r+=1,e})),mergeMap((e=>this.fetchAp(e))),timeout(AP_REQUEST_TIMEOUT),catchError((e=>(e instanceof TimeoutError&&this.warn("AP request timeout"),throwError(e)))),distinct((({ip:e})=>e)))}}const ConnectionError=genError();class Connection extends(createEventBase()){constructor(e,t){super(t,"Connection"),this.context=e,this.logger=t,this.apClient=new AccessPoint(this.context,this.logger),this.lastOpenSockets=[new ReplaySubject(1),new ReplaySubject(1)],this.curOpenSockets=[void 0,void 0],this.ipIterator=0,this.firstEnv=Math.random()>=.5?1:0,this.firstSocketOpener=void 0,this.secondSocketOpener=void 0,this.firstOpenKeeperSubject=new Subject,this.secondOpenKeeperSubject=new Subject,this.edgeInfoReplayed=void 0,this.firstEnvOpenSocket=void 0,this.firstOpenKeeperSub=void 0,this.secondOpenKeeperSub=void 0,this.apClient.apFinish$.subscribe((()=>{this.log("Ap client fetch finished")}));const r=[];this.edgeInfoReplayed=this.apClient.apEdgeInfo$.pipe(filter((e=>void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket)),throwIfEmpty((()=>new ConnectionError({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"}))),retryWhen((e=>e.pipe(tap((e=>{if(isRtmError(e))throw e})),delay(2e3),takeUntil(timer(7e3))))),filter((e=>!some_1(r,e))),tap((e=>{r.push(e),this.log("An edge info got %o",e)})),tap({error:e=>{this.emit("connectionInitFailure",e)}}),shareReplay()),this.firstEnvOpenSocket=this.edgeInfoReplayed.pipe(mergeMap((e=>{if(void 0===e)return throwError(new Error("Invalid edge info"));const{ip:r,ticket:n}=e,o=new Socket(r,this.firstEnv,n,this.context,t);return this.firstEnv=1===this.firstEnv?0:1,o.once("connectionFailure",(()=>this.onSocketConnectionFailure(o))),o.open$.pipe(mapTo(o))})),tap((e=>{this.log("The websocket of ENV_%d opened to %s:%d",e.env,e.ip,EDGE_ENV_PORT[e.env]),this.curOpenSockets[e.env]=e,this.lastOpenSockets[e.env].next(e),this.firstEnv=e.env,this.openSecondSocket(e.env,e.ip)})),take(1),share()),this.firstSocketOpener=this.firstEnvOpenSocket.pipe(mergeMap((e=>e.open$.pipe(tap((()=>{this.log("The websocket of first ENV_%d re-opened to %s:%d",e.env,e.ip,EDGE_ENV_PORT[e.env]),this.curOpenSockets[e.env]=e,this.lastOpenSockets[e.env].next(e)}))))));const n=this.firstOpenKeeperSubject.pipe(switchAll());this.firstOpenKeeperSub=n.subscribe({error:this.logError})}initConnection(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}closeSocket(e,t){if(![0,1].includes(e))throw new CommonError({INVALID_ENV:"The env argument is not 0 or 1"});let r;e===this.firstEnv?(r=this.firstOpenKeeperSub,this.firstOpenKeeperSub=void 0):(r=this.secondOpenKeeperSub,this.firstOpenKeeperSub=void 0);const n=this.curOpenSockets[e];this.curOpenSockets[e]=void 0,n&&(n.isActiveClose=!0,setTimeout((()=>{n.close()}),t)),void 0!==r&&setTimeout((()=>{r?.unsubscribe()}),t)}waitClosing(e){return e.isActiveClose=!0,e.open$.pipe(ignoreElements(),catchError((e=>"Normal closure"===e.message?EMPTY:throwError(e))),timeout(LOGOUT_SOCKET_CLOSE_TIMEOUT),catchError((t=>t instanceof TimeoutError?(this.warn("Force closing the ENV_%d connection",e.env),EMPTY):throwError(t))))}onSocketConnectionFailure(e){const t=[0,1].filter((t=>t!==e.env))[0],r=this.curOpenSockets[t];r&&r.loggedIn?this.reopenSocketWithApRequest(e.env):this.emit("socketsFailure")}openSecondSocket(e,t){const r=1===e?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(reduce(((e,t)=>[...e,t]),[]),map$1((e=>sortBy_1(e,(({ip:e})=>calIpDistance(t,e))).slice(-1)[0])),take(1),mergeMap((e=>{if(void 0===e)return throwError(new Error("Invalid edge info"));const{ip:t,ticket:n}=e,o=new Socket(t,r,n,this.context,this.logger);return o.once("connectionFailure",(()=>this.onSocketConnectionFailure(o))),o.open$.pipe(tap((()=>{this.closeAfterComplete(o)||(this.lastOpenSockets[r].next(o),this.curOpenSockets[r]=o)})))})),share());const n=this.secondOpenKeeperSubject.pipe(switchAll());this.secondOpenKeeperSub=n.subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}reopenSocketWithApRequest(e){const t=[0,1].filter((t=>t!==e))[0],r=this.curOpenSockets[t];if(void 0===r)return;const n=r.ip,o=this.apClient.apEdgeInfoEndFirst$.pipe(filter((e=>void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket)),throwIfEmpty((()=>new ConnectionError({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"}))),retryWhen((e=>e.pipe(tap((e=>{if(e.code===LOGIN_ERR_TOKEN_EXPIRED)return this.emit("tokenExpired"),void this.apClient.apFinish$.next(void 0);if(isRtmError(e))throw e})),delay(1500),takeUntil(timer(7e3))))),tap((e=>{this.log("An edge info got %o",e)}))).pipe(reduce(((e,t)=>[...e,t]),[]),map$1((e=>{const t=sortBy_1(e,(({ip:e})=>calIpDistance(n,e)));return t.length-1>=this.ipIterator?t.slice(-this.ipIterator++-1)[0]:(this.ipIterator=0,t.slice(-1)[0])})),throwIfEmpty(),mergeMap((t=>{if(void 0===t)return throwError(new Error("Invalid edge info"));const{ip:r,ticket:n}=t,o=new Socket(r,e,n,this.context,this.logger);return o.once("connectionFailure",(()=>this.onSocketConnectionFailure(o))),o.open$.pipe(mapTo(o))})),tap((t=>{this.log("The websocket of ENV_%d re-opened to %s:%d using ap",t.env,t.ip,EDGE_ENV_PORT[t.env]),this.curOpenSockets[e]=t,this.lastOpenSockets[e].next(t)})),mergeMap((t=>t.open$.pipe(tap((()=>{this.log("The websocket of ENV_%d re-opened to %s:%d",t.env,t.ip,EDGE_ENV_PORT[t.env]),this.curOpenSockets[e]=t,this.lastOpenSockets[e].next(t)}))))),share());e===this.firstEnv?this.firstOpenKeeperSubject.next(o):this.secondOpenKeeperSubject.next(o)}closeAfterComplete(e){return!!this.lastOpenSockets[e.env].isStopped&&(e.close(),!0)}}const $Writer$1=minimal_1.Writer,$util$1=minimal_1.util,$root$1=minimal_1.roots.default||(minimal_1.roots.default={}),Session=$root$1.Session=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.elapse=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.appId&&Object.hasOwnProperty.call(e,"appId")&&t.uint32(42).string(e.appId),null!=e.ver&&Object.hasOwnProperty.call(e,"ver")&&t.uint32(50).string(e.ver),null!=e.buildno&&Object.hasOwnProperty.call(e,"buildno")&&t.uint32(56).int32(e.buildno),null!=e.installId&&Object.hasOwnProperty.call(e,"installId")&&t.uint32(66).string(e.installId),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(128).int32(e.os),null!=e.did&&Object.hasOwnProperty.call(e,"did")&&t.uint32(138).string(e.did),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&$root$1.Session.CommonIndex.encode(e.index,t.uint32(162).fork()).ldelim(),null!=e.token&&Object.hasOwnProperty.call(e,"token")&&t.uint32(170).string(e.token),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(176).int32(e.version),null!=e.subVersion&&Object.hasOwnProperty.call(e,"subVersion")&&t.uint32(184).int32(e.subVersion),t},e.CommonIndex=function(){function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),e})(),Link=$root$1.Link=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.elapse=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(40).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(48).int32(e.sc),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(58).string(e.destServerIp),null!=e.ackedServerIp&&Object.hasOwnProperty.call(e,"ackedServerIp")&&t.uint32(66).string(e.ackedServerIp),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(72).int32(e.responseTime),t},e})(),Logout=$root$1.Logout=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.elapse=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),t},e})(),KickedOff=$root$1.KickedOff=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.elapse=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(56).int32(e.code),null!=e.server&&Object.hasOwnProperty.call(e,"server")&&t.uint32(66).string(e.server),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(72).int32(e.serverCode),t},e})(),ChnJoin=$root$1.ChnJoin=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.elapse=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e})(),ChnJoinRes=$root$1.ChnJoinRes=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.elapse=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(64).int32(e.serverErrCode),t},e})(),ChnLeave=$root$1.ChnLeave=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.elapse=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e})(),ConnectionStateChange=$root$1.ConnectionStateChange=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.elapse=$util$1.Long?$util$1.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(e,t){return t||(t=$Writer$1.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.oldState&&Object.hasOwnProperty.call(e,"oldState")&&t.uint32(40).int32(e.oldState),null!=e.newState&&Object.hasOwnProperty.call(e,"newState")&&t.uint32(48).int32(e.newState),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(56).int32(e.reason),null!=e.reconnId&&Object.hasOwnProperty.call(e,"reconnId")&&t.uint32(64).int32(e.reconnId),t},e})();var ProtoPackets$1=Object.freeze({__proto__:null,Session,Link,Logout,KickedOff,ChnJoin,ChnJoinRes,ChnLeave,ConnectionStateChange,default:$root$1}),Counter=1,ApiExec=154,Session$1=164,ApEvent=165,Link$1=166,Logout$1=167,TxMessage=168,RxMessage=169,KickedOff$1=170,TxMessageRes=171,ChnJoin$1=172,ChnJoinRes$1=173,ChnLeave$1=174,ChnGetMembers=175,ChnGetMembersRes=176,ChnMemberJoined=177,ChnMemberLeft=178,RenewToken=181,OperateAttribute=186,OperateAttributeRes=187,ApRequest=188,LinkTcpEvent=189,LinkLoginRequest=190,ConnectionStateChange$1=191,reportId={Counter,ApiExec,Session:Session$1,ApEvent,Link:Link$1,Logout:Logout$1,TxMessage,RxMessage,KickedOff:KickedOff$1,TxMessageRes,ChnJoin:ChnJoin$1,ChnJoinRes:ChnJoinRes$1,ChnLeave:ChnLeave$1,ChnGetMembers,ChnGetMembersRes,ChnMemberJoined,ChnMemberLeft,RenewToken,OperateAttribute,OperateAttributeRes,ApRequest,LinkTcpEvent,LinkLoginRequest,ConnectionStateChange:ConnectionStateChange$1},ReportId=Object.freeze({__proto__:null,Counter,ApiExec,Session:Session$1,ApEvent,Link:Link$1,Logout:Logout$1,TxMessage,RxMessage,KickedOff:KickedOff$1,TxMessageRes,ChnJoin:ChnJoin$1,ChnJoinRes:ChnJoinRes$1,ChnLeave:ChnLeave$1,ChnGetMembers,ChnGetMembersRes,ChnMemberJoined,ChnMemberLeft,RenewToken,OperateAttribute,OperateAttributeRes,ApRequest,LinkTcpEvent,LinkLoginRequest,ConnectionStateChange:ConnectionStateChange$1,default:reportId});async function sendReport(e,t){const r=ProtoPackets$1[e].encode(t).finish(),n=Math.ceil(Date.now()/1e3).toString(),o=ReportId[e];let a=0;const c=async()=>{try{await postWithAbortSignal(`https://webcollector-rtm.agora.io:6443/events/proto-raw?sentTs=${n}&id=${o}`,{body:uint8ArrayToArrayBuffer(r),timeout:1e4,headers:{"Content-Type":"application/octet-stream"}})}catch{if(a+=1,!(a<=2))return;await c()}};try{await c()}catch{}}function getElapse(e){return void 0===e?long_1.fromNumber(0):long_1.fromNumber(Date.now()-e)}class Context extends(createEventBase()){constructor(e,t){super(t,"Context"),this.appId=e,this._token=void 0,this._uid=void 0,this._sid=void 0,this._area=void 0}set token(e){this.log("The token is set to %s",e),this._token="string"==typeof e&&e?e:void 0}set uid(e){if(this.log("The user ID is set to %s",e),!isValidId(e))throw new RtmInternalError;this._uid=e}get uid(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new RtmInternalError("Cannot get illegal uid")}get key(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new RtmInternalError("Cannot get illegal key")}get sid(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new RtmInternalError("Cannot get illegal sid")}set sid(e){if(this.log("sid is set to %s",e),"string"!=typeof e||!e)throw new RtmInternalError;this._sid=e}get area(){if("string"==typeof this._area&&this._area)return this._area;throw new RtmInternalError("Cannot get illegal area")}set area(e){this.log("area is set to %s",e),this._area="string"==typeof e&&e?e:"CN"}}const EndedInvitationLogMessage="The invitation has ended, skipped emitting the %s event",InvitationError=genError();var _class,_temp;const{LocalInvitationFailureReason:failureReason,LocalInvitationState:state}=RtmStatusCode$1;let RtmLocalInvitation=(_temp=class RtmLocalInvitation extends(createEventBase()){get channelId(){return this._channelId}set channelId(e){this.state===state.IDLE?(this.log("set channelId for %s",this.callId),this._channelId=e):this.info("set channelId only allow before invitation sent to remote")}get content(){return this._content}set content(e){this.log("set content for %s",this.callId),this._content=e}get response(){return this._response}set response(e){throw new RtmInvalidArgumentError('Cannot set the "response" of the LocalInvitation instance.',INVITATION_API_CALL_ERR_INVALID_ARGUMENT)}constructor(e,t,r){super(r,"RtmLocalInvitation",!0),this.calleeId=e,this.getSession=t,this.logger=r,this.state=state.IDLE,this.localInvitationEnd$=race(fromEvent(this,"LocalInvitationAccepted"),fromEvent(this,"LocalInvitationRefused"),fromEvent(this,"LocalInvitationFailure"),fromEvent(this,"LocalInvitationCanceled")).pipe(take(1)),this.callId=uuid_1.v4(),this._content="",this._channelId="",this._response=""}send(){let e;if(this.state===state.SENT_TO_REMOTE||this.state===state.RECEIVED_BY_REMOTE)throw new RtmInvalidStatusError("The local invitation send failure. The call invitation has already been sent.",INVITATION_API_CALL_ERR_ALREADY_SENT);if(this.isLocalInvitationEnd())throw new RtmInvalidStatusError("The local invitation send failure. The call invitation has ended.",INVITATION_API_CALL_ERR_ALREADY_END);if(this._channelId.length>0&&!isValidId(this._channelId))throw new RtmInvalidArgumentError("Illegal invitation channel ID",INVITATION_API_CALL_ERR_INVALID_ARGUMENT);if(!isValidId(this.calleeId))throw new RtmInvalidArgumentError("Illegal invitation callee user ID",INVITATION_API_CALL_ERR_INVALID_ARGUMENT);if(getUtf8StringSize(this._content)>INVITATION_EXTRA_MAX_BYTES)throw new RtmInvalidArgumentError('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',INVITATION_API_CALL_ERR_INVALID_ARGUMENT);this.state=state.SENT_TO_REMOTE,defer((async()=>{const{hasPeerReceived:t,hasReSent:r}=await this.getSession().sendInvitationMessage({peerId:this.calleeId,callId:this.callId,extra:this._content,type:"CallInvite",channelId:this._channelId});if(this.isLocalInvitationEnd())throw new RtmTimeoutError("send invitation timeout");if(this.log("The local invitation has sent to the callee"),!t&&!r)throw e=new InvitationError({PEER_NOT_ONLINE:"The peer of the invitation is not online"}),e;if(!t)throw e=new InvitationError({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"}),e})).pipe(retryWhen((e=>e.pipe(tap((e=>{if(!(e instanceof InvitationError))throw e})),delay(LOCAL_INVITATION_RESEND_INTERVAL)))),timeout(LOCAL_INVITATION_ACK_TIMEOUT),catchError((e=>(isTimeout(e)&&this.warn("local invitation ack timed out"),throwError(e)))),takeUntil(this.localInvitationEnd$)).subscribe({next:()=>{this.state!==state.RECEIVED_BY_REMOTE?this.state===state.SENT_TO_REMOTE?(this.info("The peer received the local invitation %s.",this.callId),this.state=state.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer"),this.localInvitationEnd$.pipe(timeout(INVITATION_EXPIRE_TIMEOUT),catchError((e=>(isTimeout(e)&&this.warn("local invitation expired"),throwError(e))))).subscribe({error:()=>{this.state=state.FAILURE,this.emit("LocalInvitationFailure",failureReason.INVITATION_EXPIRE)}})):this.log(EndedInvitationLogMessage,"LocalInvitationReceivedByPeer"):this.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"')},error:t=>{this.isLocalInvitationEnd()?this.log(EndedInvitationLogMessage,"LocalInvitationFailure"):(this.state=state.FAILURE,isTimeout(t)&&e?"PEER_NOT_ONLINE"===e.code?this.emit("LocalInvitationFailure",failureReason.PEER_OFFLINE):"RESENT_AND_OFFLINE"===e.code&&this.emit("LocalInvitationFailure",failureReason.PEER_NO_RESPONSE):isTimeout(t)?this.emit("LocalInvitationFailure",failureReason.PEER_NO_RESPONSE):"RtmInvalidStatusError"===t.name?this.emit("LocalInvitationFailure",failureReason.NOT_LOGGEDIN):this.emit("LocalInvitationFailure",failureReason.UNKNOWN))}})}cancel(){if(this.isLocalInvitationEnd())throw new RtmInvalidStatusError("The local invitation cancel failure",INVITATION_API_CALL_ERR_ALREADY_END);if(this.state===state.IDLE)throw new RtmInvalidStatusError("The local invitation has not been sent",INVITATION_API_CALL_ERR_NOT_STARTED);if(getUtf8StringSize(this._content)>INVITATION_EXTRA_MAX_BYTES)throw new RtmInvalidArgumentError('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',INVITATION_API_CALL_ERR_INVALID_ARGUMENT);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=state.CANCELED,this.emit("LocalInvitationCanceled")}onAcceptReceived(e){if(this.isLocalInvitationEnd()&&this.state!==state.ACCEPTED_BY_REMOTE)this.log(EndedInvitationLogMessage,"LocalInvitationAccepted");else{if(this.state===state.IDLE)throw new RtmInvalidStatusError("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state!==state.ACCEPTED_BY_REMOTE?(this.state===state.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=state.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=state.ACCEPTED_BY_REMOTE,this._response=e,this.emit("LocalInvitationAccepted",e)):this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE")}}onRefuseReceived(e){if(this.isLocalInvitationEnd())this.log(EndedInvitationLogMessage,"LocalInvitationRefused");else{if(this.state===state.IDLE)throw new RtmInvalidStatusError("the local have not sent the invitation, how can remote refuse it?");this.state===state.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=state.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=e,this.state=state.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",e)}}isLocalInvitationEnd(){return[state.CANCELED,state.FAILURE,state.ACCEPTED_BY_REMOTE,state.REFUSED_BY_REMOTE].includes(this.state)}},_class=_temp,_applyDecoratedDescriptor(_class.prototype,"send",[logged],Object.getOwnPropertyDescriptor(_class.prototype,"send"),_class.prototype),_applyDecoratedDescriptor(_class.prototype,"cancel",[logged],Object.getOwnPropertyDescriptor(_class.prototype,"cancel"),_class.prototype),_class);const{RemoteInvitationFailureReason,RemoteInvitationState}=RtmStatusCode$1;class RtmRemoteInvitation extends(createEventBase()){get channelId(){return this._channelId}set channelId(e){throw new RtmInvalidArgumentError('Cannot set the "response" of the RemoteInvitation instance.',INVITATION_API_CALL_ERR_INVALID_ARGUMENT)}get content(){return this._content}set content(e){throw new RtmInvalidArgumentError('Cannot set the "content" of the RemoteInvitation instance.',INVITATION_API_CALL_ERR_INVALID_ARGUMENT)}get response(){return this._response}set response(e){this._response=e}constructor({invitationChannel:e,extraContent:t,callId:r,callerId:n,logger:o,getSession:a}){super(o,"RtmRemoteInvitation",!0),this.state=RemoteInvitationState.INVITATION_RECEIVED,this.remoteInvitationEnd$=race(fromEvent(this,"RemoteInvitationCanceled"),fromEvent(this,"RemoteInvitationRefused"),fromEvent(this,"RemoteInvitationAccepted"),fromEvent(this,"RemoteInvitationFailure")).pipe(take(1)),this.callerId=void 0,this.callId=void 0,this._getSession=void 0,this.logger=void 0,this._content=void 0,this._channelId=void 0,this._response="",this._channelId=e,this._content=t,this.callId=r,this.callerId=n,this._getSession=a,this.logger=o,this.remoteInvitationEnd$.pipe(timeout(INVITATION_EXPIRE_TIMEOUT),catchError((e=>(isTimeout(e)&&this.warn("Remote invitation expired"),throwError(e))))).subscribe({error:()=>{this.state=RemoteInvitationState.FAILURE,this.emit("RemoteInvitationFailure",RemoteInvitationFailureReason.INVITATION_EXPIRE)}})}accept(){if(this.isRemoteInvitationEnd())throw new RtmInvalidStatusError("The local invitation has ended. Cannot accept.",INVITATION_API_CALL_ERR_ALREADY_END);if(this.state===RemoteInvitationState.ACCEPT_SENT_TO_LOCAL)throw new RtmInvalidStatusError("The remote invitation is accepting. Cannot do the operation.",INVITATION_API_CALL_ERR_ALREADY_ACCEPT);if(getUtf8StringSize(this._response)>INVITATION_EXTRA_MAX_BYTES)throw new RtmInvalidArgumentError('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',INVITATION_API_CALL_ERR_INVALID_ARGUMENT);let e;this.state=RemoteInvitationState.ACCEPT_SENT_TO_LOCAL,merge(interval(REMOTE_INVITATION_ACCEPT_RESEND_INTERVAL).pipe(mergeMap((()=>defer((async()=>this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallAccept",isAcceptAck:!1,channelId:this.channelId}))))),filter((t=>(({hasPeerReceived:e}=t),e))),take(1)),fromEvent(this,"RemoteInvitationAccepted")).pipe(timeout(REMOTE_INVITATION_WAIT_ACCEPT_ACK_TIMEOUT),takeUntil(this.remoteInvitationEnd$)).subscribe({error:t=>{if(this.logError(t),this.state=RemoteInvitationState.FAILURE,isTimeout(t))switch(e){case void 0:case!0:return void this.emit("RemoteInvitationFailure",RemoteInvitationFailureReason.ACCEPT_FAILURE);case!1:return void this.emit("RemoteInvitationFailure",RemoteInvitationFailureReason.PEER_OFFLINE)}this.emit("RemoteInvitationFailure",RemoteInvitationFailureReason.UNKNOWN)}})}refuse(){if(this.state===RemoteInvitationState.ACCEPT_SENT_TO_LOCAL)throw new RtmInvalidStatusError("The remote invitation is accepting. Cannot do the operation.",INVITATION_API_CALL_ERR_ALREADY_ACCEPT);if(this.isRemoteInvitationEnd())throw new RtmInvalidStatusError("The invitation is end. Cannot refuse",INVITATION_API_CALL_ERR_ALREADY_END);if(getUtf8StringSize(this._response)>INVITATION_EXTRA_MAX_BYTES)throw new RtmInvalidArgumentError('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',INVITATION_API_CALL_ERR_INVALID_ARGUMENT);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=RemoteInvitationState.REFUSED,this.emit("RemoteInvitationRefused")}onCancelReceived(e){this.isRemoteInvitationEnd()?this.log(EndedInvitationLogMessage,"RemoteInvitationCanceled"):(this.state===RemoteInvitationState.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=e,this.state=RemoteInvitationState.CANCELED,this.emit("RemoteInvitationCanceled",e))}onAcceptAckReceived(){this.state===RemoteInvitationState.ACCEPT_SENT_TO_LOCAL?(this.state=RemoteInvitationState.ACCEPTED,this.emit("RemoteInvitationAccepted")):this.log(EndedInvitationLogMessage,`ori:${this.state}, to: RemoteInvitationAccepted`)}isRemoteInvitationEnd(){return[RemoteInvitationState.ACCEPTED,RemoteInvitationState.REFUSED,RemoteInvitationState.CANCELED,RemoteInvitationState.FAILURE].includes(this.state)}}function compact(e){for(var t=-1,r=null==e?0:e.length,n=0,o=[];++t<r;){var a=e[t];a&&(o[n++]=a)}return o}var compact_1=compact;
/*! pako 2.0.1 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN=2;function zero$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH=3,MAX_MATCH=258,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES+2));zero$1(static_ltree);const static_dtree=new Array(2*D_CODES);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES);zero$1(base_length);const base_dist=new Array(D_CODES);function StaticTreeDesc(e,t,r,n,o){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=o,this.has_stree=e&&e.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}zero$1(base_dist);const d_code=e=>e<256?_dist_code[e]:_dist_code[256+(e>>>7)],put_short=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},send_bits=(e,t,r)=>{e.bi_valid>Buf_size-r?(e.bi_buf|=t<<e.bi_valid&65535,put_short(e,e.bi_buf),e.bi_buf=t>>Buf_size-e.bi_valid,e.bi_valid+=r-Buf_size):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},send_code=(e,t,r)=>{send_bits(e,r[2*t],r[2*t+1])},bi_reverse=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},bi_flush=e=>{16===e.bi_valid?(put_short(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)},gen_bitlen=(e,t)=>{const r=t.dyn_tree,n=t.max_code,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,c=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,u=t.stat_desc.max_length;let _,p,f,E,g,b,v=0;for(E=0;E<=MAX_BITS;E++)e.bl_count[E]=0;for(r[2*e.heap[e.heap_max]+1]=0,_=e.heap_max+1;_<HEAP_SIZE;_++)p=e.heap[_],E=r[2*r[2*p+1]+1]+1,E>u&&(E=u,v++),r[2*p+1]=E,p>n||(e.bl_count[E]++,g=0,p>=l&&(g=c[p-l]),b=r[2*p],e.opt_len+=b*(E+g),a&&(e.static_len+=b*(o[2*p+1]+g)));if(0!==v){do{for(E=u-1;0===e.bl_count[E];)E--;e.bl_count[E]--,e.bl_count[E+1]+=2,e.bl_count[u]--,v-=2}while(v>0);for(E=u;0!==E;E--)for(p=e.bl_count[E];0!==p;)f=e.heap[--_],f>n||(r[2*f+1]!==E&&(e.opt_len+=(E-r[2*f+1])*r[2*f],r[2*f+1]=E),p--)}},gen_codes=(e,t,r)=>{const n=new Array(MAX_BITS+1);let o,a,c=0;for(o=1;o<=MAX_BITS;o++)n[o]=c=c+r[o-1]<<1;for(a=0;a<=t;a++){let t=e[2*a+1];0!==t&&(e[2*a]=bi_reverse(n[t]++,t))}},tr_static_init=()=>{let e,t,r,n,o;const a=new Array(MAX_BITS+1);for(r=0,n=0;n<LENGTH_CODES-1;n++)for(base_length[n]=r,e=0;e<1<<extra_lbits[n];e++)_length_code[r++]=n;for(_length_code[r-1]=n,o=0,n=0;n<16;n++)for(base_dist[n]=o,e=0;e<1<<extra_dbits[n];e++)_dist_code[o++]=n;for(o>>=7;n<D_CODES;n++)for(base_dist[n]=o<<7,e=0;e<1<<extra_dbits[n]-7;e++)_dist_code[256+o++]=n;for(t=0;t<=MAX_BITS;t++)a[t]=0;for(e=0;e<=143;)static_ltree[2*e+1]=8,e++,a[8]++;for(;e<=255;)static_ltree[2*e+1]=9,e++,a[9]++;for(;e<=279;)static_ltree[2*e+1]=7,e++,a[7]++;for(;e<=287;)static_ltree[2*e+1]=8,e++,a[8]++;for(gen_codes(static_ltree,L_CODES+1,a),e=0;e<D_CODES;e++)static_dtree[2*e+1]=5,static_dtree[2*e]=bi_reverse(e,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)},init_block=e=>{let t;for(t=0;t<L_CODES;t++)e.dyn_ltree[2*t]=0;for(t=0;t<D_CODES;t++)e.dyn_dtree[2*t]=0;for(t=0;t<BL_CODES;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*END_BLOCK]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},bi_windup=e=>{e.bi_valid>8?put_short(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},copy_block=(e,t,r,n)=>{bi_windup(e),n&&(put_short(e,r),put_short(e,~r)),e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},smaller=(e,t,r,n)=>{const o=2*t,a=2*r;return e[o]<e[a]||e[o]===e[a]&&n[t]<=n[r]},pqdownheap=(e,t,r)=>{const n=e.heap[r];let o=r<<1;for(;o<=e.heap_len&&(o<e.heap_len&&smaller(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!smaller(t,n,e.heap[o],e.depth));)e.heap[r]=e.heap[o],r=o,o<<=1;e.heap[r]=n},compress_block=(e,t,r)=>{let n,o,a,c,l=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],o=e.pending_buf[e.l_buf+l],l++,0===n?send_code(e,o,t):(a=_length_code[o],send_code(e,a+LITERALS+1,t),c=extra_lbits[a],0!==c&&(o-=base_length[a],send_bits(e,o,c)),n--,a=d_code(n),send_code(e,a,r),c=extra_dbits[a],0!==c&&(n-=base_dist[a],send_bits(e,n,c)))}while(l<e.last_lit);send_code(e,END_BLOCK,t)},build_tree=(e,t)=>{const r=t.dyn_tree,n=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.elems;let c,l,u,_=-1;for(e.heap_len=0,e.heap_max=HEAP_SIZE,c=0;c<a;c++)0!==r[2*c]?(e.heap[++e.heap_len]=_=c,e.depth[c]=0):r[2*c+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=_<2?++_:0,r[2*u]=1,e.depth[u]=0,e.opt_len--,o&&(e.static_len-=n[2*u+1]);for(t.max_code=_,c=e.heap_len>>1;c>=1;c--)pqdownheap(e,r,c);u=a;do{c=e.heap[1],e.heap[1]=e.heap[e.heap_len--],pqdownheap(e,r,1),l=e.heap[1],e.heap[--e.heap_max]=c,e.heap[--e.heap_max]=l,r[2*u]=r[2*c]+r[2*l],e.depth[u]=(e.depth[c]>=e.depth[l]?e.depth[c]:e.depth[l])+1,r[2*c+1]=r[2*l+1]=u,e.heap[1]=u++,pqdownheap(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gen_bitlen(e,t),gen_codes(r,_,e.bl_count)},scan_tree=(e,t,r)=>{let n,o,a=-1,c=t[1],l=0,u=7,_=4;for(0===c&&(u=138,_=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)o=c,c=t[2*(n+1)+1],++l<u&&o===c||(l<_?e.bl_tree[2*o]+=l:0!==o?(o!==a&&e.bl_tree[2*o]++,e.bl_tree[2*REP_3_6]++):l<=10?e.bl_tree[2*REPZ_3_10]++:e.bl_tree[2*REPZ_11_138]++,l=0,a=o,0===c?(u=138,_=3):o===c?(u=6,_=3):(u=7,_=4))},send_tree=(e,t,r)=>{let n,o,a=-1,c=t[1],l=0,u=7,_=4;for(0===c&&(u=138,_=3),n=0;n<=r;n++)if(o=c,c=t[2*(n+1)+1],!(++l<u&&o===c)){if(l<_)do{send_code(e,o,e.bl_tree)}while(0!=--l);else 0!==o?(o!==a&&(send_code(e,o,e.bl_tree),l--),send_code(e,REP_3_6,e.bl_tree),send_bits(e,l-3,2)):l<=10?(send_code(e,REPZ_3_10,e.bl_tree),send_bits(e,l-3,3)):(send_code(e,REPZ_11_138,e.bl_tree),send_bits(e,l-11,7));l=0,a=o,0===c?(u=138,_=3):o===c?(u=6,_=3):(u=7,_=4)}},build_bl_tree=e=>{let t;for(scan_tree(e,e.dyn_ltree,e.l_desc.max_code),scan_tree(e,e.dyn_dtree,e.d_desc.max_code),build_tree(e,e.bl_desc),t=BL_CODES-1;t>=3&&0===e.bl_tree[2*bl_order[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t},send_all_trees=(e,t,r,n)=>{let o;for(send_bits(e,t-257,5),send_bits(e,r-1,5),send_bits(e,n-4,4),o=0;o<n;o++)send_bits(e,e.bl_tree[2*bl_order[o]+1],3);send_tree(e,e.dyn_ltree,t-1),send_tree(e,e.dyn_dtree,r-1)},detect_data_type=e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return Z_BINARY;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Z_TEXT;for(t=32;t<LITERALS;t++)if(0!==e.dyn_ltree[2*t])return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init=e=>{static_init_done||(tr_static_init(),static_init_done=!0),e.l_desc=new TreeDesc(e.dyn_ltree,static_l_desc),e.d_desc=new TreeDesc(e.dyn_dtree,static_d_desc),e.bl_desc=new TreeDesc(e.bl_tree,static_bl_desc),e.bi_buf=0,e.bi_valid=0,init_block(e)},_tr_stored_block=(e,t,r,n)=>{send_bits(e,(STORED_BLOCK<<1)+(n?1:0),3),copy_block(e,t,r,!0)},_tr_align=e=>{send_bits(e,STATIC_TREES<<1,3),send_code(e,END_BLOCK,static_ltree),bi_flush(e)},_tr_flush_block=(e,t,r,n)=>{let o,a,c=0;e.level>0?(e.strm.data_type===Z_UNKNOWN&&(e.strm.data_type=detect_data_type(e)),build_tree(e,e.l_desc),build_tree(e,e.d_desc),c=build_bl_tree(e),o=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=o&&(o=a)):o=a=r+5,r+4<=o&&-1!==t?_tr_stored_block(e,t,r,n):e.strategy===Z_FIXED||a===o?(send_bits(e,(STATIC_TREES<<1)+(n?1:0),3),compress_block(e,static_ltree,static_dtree)):(send_bits(e,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),compress_block(e,e.dyn_ltree,e.dyn_dtree)),init_block(e),n&&bi_windup(e)},_tr_tally=(e,t,r)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(_length_code[r]+LITERALS+1)]++,e.dyn_dtree[2*d_code(t)]++),e.last_lit===e.lit_bufsize-1);var _tr_init_1=_tr_init,_tr_stored_block_1=_tr_stored_block,_tr_flush_block_1=_tr_flush_block,_tr_tally_1=_tr_tally,_tr_align_1=_tr_align,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(e,t,r,n)=>{let o=65535&e|0,a=e>>>16&65535|0,c=0;for(;0!==r;){c=r>2e3?2e3:r,r-=c;do{o=o+t[n++]|0,a=a+o|0}while(--c);o%=65521,a%=65521}return o|a<<16|0};var adler32_1=adler32;const makeTable=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t},crcTable=new Uint32Array(makeTable()),crc32=(e,t,r,n)=>{const o=crcTable,a=n+r;e^=-1;for(let r=n;r<a;r++)e=e>>>8^o[255&(e^t[r])];return-1^e};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:_tr_init$1,_tr_stored_block:_tr_stored_block$1,_tr_flush_block:_tr_flush_block$1,_tr_tally:_tr_tally$1,_tr_align:_tr_align$1}=trees,{Z_NO_FLUSH,Z_PARTIAL_FLUSH,Z_FULL_FLUSH,Z_FINISH,Z_BLOCK,Z_OK,Z_STREAM_END,Z_STREAM_ERROR,Z_DATA_ERROR,Z_BUF_ERROR,Z_DEFAULT_COMPRESSION,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED:Z_FIXED$1,Z_DEFAULT_STRATEGY,Z_UNKNOWN:Z_UNKNOWN$1,Z_DEFLATED}=constants,MAX_MEM_LEVEL=9,MAX_WBITS=15,DEF_MEM_LEVEL=8,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,MIN_MATCH$1=3,MAX_MATCH$1=258,MIN_LOOKAHEAD=MAX_MATCH$1+MIN_MATCH$1+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(e,t)=>(e.msg=messages[t],t),rank=e=>(e<<1)-(e>4?9:0),zero$1$1=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let HASH_ZLIB=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,HASH=HASH_ZLIB;const flush_pending=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},flush_block_only=(e,t)=>{_tr_flush_block$1(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,flush_pending(e.strm)},put_byte=(e,t)=>{e.pending_buf[e.pending++]=t},putShortMSB=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},read_buf=(e,t,r,n)=>{let o=e.avail_in;return o>n&&(o=n),0===o?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),r),1===e.state.wrap?e.adler=adler32_1(e.adler,t,o,r):2===e.state.wrap&&(e.adler=crc32_1(e.adler,t,o,r)),e.next_in+=o,e.total_in+=o,o)},longest_match=(e,t)=>{let r,n,o=e.max_chain_length,a=e.strstart,c=e.prev_length,l=e.nice_match;const u=e.strstart>e.w_size-MIN_LOOKAHEAD?e.strstart-(e.w_size-MIN_LOOKAHEAD):0,_=e.window,p=e.w_mask,f=e.prev,E=e.strstart+MAX_MATCH$1;let g=_[a+c-1],b=_[a+c];e.prev_length>=e.good_match&&(o>>=2),l>e.lookahead&&(l=e.lookahead);do{if(r=t,_[r+c]===b&&_[r+c-1]===g&&_[r]===_[a]&&_[++r]===_[a+1]){a+=2,r++;do{}while(_[++a]===_[++r]&&_[++a]===_[++r]&&_[++a]===_[++r]&&_[++a]===_[++r]&&_[++a]===_[++r]&&_[++a]===_[++r]&&_[++a]===_[++r]&&_[++a]===_[++r]&&a<E);if(n=MAX_MATCH$1-(E-a),a=E-MAX_MATCH$1,n>c){if(e.match_start=t,c=n,n>=l)break;g=_[a+c-1],b=_[a+c]}}}while((t=f[t&p])>u&&0!=--o);return c<=e.lookahead?c:e.lookahead},fill_window=e=>{const t=e.w_size;let r,n,o,a,c;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-MIN_LOOKAHEAD)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,n=e.hash_size,r=n;do{o=e.head[--r],e.head[r]=o>=t?o-t:0}while(--n);n=t,r=n;do{o=e.prev[--r],e.prev[r]=o>=t?o-t:0}while(--n);a+=t}if(0===e.strm.avail_in)break;if(n=read_buf(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=n,e.lookahead+e.insert>=MIN_MATCH$1)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=HASH(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=HASH(e,e.ins_h,e.window[c+MIN_MATCH$1-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<MIN_MATCH$1)););}while(e.lookahead<MIN_LOOKAHEAD&&0!==e.strm.avail_in)},deflate_stored=(e,t)=>{let r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(fill_window(e),0===e.lookahead&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE;if(e.strstart-e.block_start>=e.w_size-MIN_LOOKAHEAD&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(e.strstart>e.block_start&&(flush_block_only(e,!1),e.strm.avail_out),BS_NEED_MORE)},deflate_fast=(e,t)=>{let r,n;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH$1&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH$1-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r)),e.match_length>=MIN_MATCH$1)if(n=_tr_tally$1(e,e.strstart-e.match_start,e.match_length-MIN_MATCH$1),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=MIN_MATCH$1){e.match_length--;do{e.strstart++,e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH$1-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+1]);else n=_tr_tally$1(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=e.strstart<MIN_MATCH$1-1?e.strstart:MIN_MATCH$1-1,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(e,t)=>{let r,n,o;for(;;){if(e.lookahead<MIN_LOOKAHEAD){if(fill_window(e),e.lookahead<MIN_LOOKAHEAD&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(r=0,e.lookahead>=MIN_MATCH$1&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH$1-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=MIN_MATCH$1-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-MIN_LOOKAHEAD&&(e.match_length=longest_match(e,r),e.match_length<=5&&(e.strategy===Z_FILTERED||e.match_length===MIN_MATCH$1&&e.strstart-e.match_start>4096)&&(e.match_length=MIN_MATCH$1-1)),e.prev_length>=MIN_MATCH$1&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-MIN_MATCH$1,n=_tr_tally$1(e,e.strstart-1-e.prev_match,e.prev_length-MIN_MATCH$1),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=o&&(e.ins_h=HASH(e,e.ins_h,e.window[e.strstart+MIN_MATCH$1-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=MIN_MATCH$1-1,e.strstart++,n&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}else if(e.match_available){if(n=_tr_tally$1(e,0,e.window[e.strstart-1]),n&&flush_block_only(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return BS_NEED_MORE}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=_tr_tally$1(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<MIN_MATCH$1-1?e.strstart:MIN_MATCH$1-1,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(e,t)=>{let r,n,o,a;const c=e.window;for(;;){if(e.lookahead<=MAX_MATCH$1){if(fill_window(e),e.lookahead<=MAX_MATCH$1&&t===Z_NO_FLUSH)return BS_NEED_MORE;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=MIN_MATCH$1&&e.strstart>0&&(o=e.strstart-1,n=c[o],n===c[++o]&&n===c[++o]&&n===c[++o])){a=e.strstart+MAX_MATCH$1;do{}while(n===c[++o]&&n===c[++o]&&n===c[++o]&&n===c[++o]&&n===c[++o]&&n===c[++o]&&n===c[++o]&&n===c[++o]&&o<a);e.match_length=MAX_MATCH$1-(a-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=MIN_MATCH$1?(r=_tr_tally$1(e,1,e.match_length-MIN_MATCH$1),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=_tr_tally$1(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(e,t)=>{let r;for(;;){if(0===e.lookahead&&(fill_window(e),0===e.lookahead)){if(t===Z_NO_FLUSH)return BS_NEED_MORE;break}if(e.match_length=0,r=_tr_tally$1(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(flush_block_only(e,!1),0===e.strm.avail_out))return BS_NEED_MORE}return e.insert=0,t===Z_FINISH?(flush_block_only(e,!0),0===e.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):e.last_lit&&(flush_block_only(e,!1),0===e.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(e,t,r,n,o){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=o}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=e=>{e.window_size=2*e.w_size,zero$1$1(e.head),e.max_lazy_match=configuration_table[e.level].max_lazy,e.good_match=configuration_table[e.level].good_length,e.nice_match=configuration_table[e.level].nice_length,e.max_chain_length=configuration_table[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=MIN_MATCH$1-1,e.match_available=0,e.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*HEAP_SIZE$1),this.dyn_dtree=new Uint16Array(2*(2*D_CODES$1+1)),this.bl_tree=new Uint16Array(2*(2*BL_CODES$1+1)),zero$1$1(this.dyn_ltree),zero$1$1(this.dyn_dtree),zero$1$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS$1+1),this.heap=new Uint16Array(2*L_CODES$1+1),zero$1$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES$1+1),zero$1$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateResetKeep=e=>{if(!e||!e.state)return err(e,Z_STREAM_ERROR);e.total_in=e.total_out=0,e.data_type=Z_UNKNOWN$1;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?INIT_STATE:BUSY_STATE,e.adler=2===t.wrap?0:1,t.last_flush=Z_NO_FLUSH,_tr_init$1(t),Z_OK},deflateReset=e=>{const t=deflateResetKeep(e);return t===Z_OK&&lm_init(e.state),t},deflateSetHeader=(e,t)=>e&&e.state?2!==e.state.wrap?Z_STREAM_ERROR:(e.state.gzhead=t,Z_OK):Z_STREAM_ERROR,deflateInit2=(e,t,r,n,o,a)=>{if(!e)return Z_STREAM_ERROR;let c=1;if(t===Z_DEFAULT_COMPRESSION&&(t=6),n<0?(c=0,n=-n):n>15&&(c=2,n-=16),o<1||o>MAX_MEM_LEVEL||r!==Z_DEFLATED||n<8||n>15||t<0||t>9||a<0||a>Z_FIXED$1)return err(e,Z_STREAM_ERROR);8===n&&(n=9);const l=new DeflateState;return e.state=l,l.strm=e,l.wrap=c,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+MIN_MATCH$1-1)/MIN_MATCH$1),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=r,deflateReset(e)},deflateInit=(e,t)=>deflateInit2(e,t,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY),deflate=(e,t)=>{let r,n;if(!e||!e.state||t>Z_BLOCK||t<0)return e?err(e,Z_STREAM_ERROR):Z_STREAM_ERROR;const o=e.state;if(!e.output||!e.input&&0!==e.avail_in||o.status===FINISH_STATE&&t!==Z_FINISH)return err(e,0===e.avail_out?Z_BUF_ERROR:Z_STREAM_ERROR);o.strm=e;const a=o.last_flush;if(o.last_flush=t,o.status===INIT_STATE)if(2===o.wrap)e.adler=0,put_byte(o,31),put_byte(o,139),put_byte(o,8),o.gzhead?(put_byte(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),put_byte(o,255&o.gzhead.time),put_byte(o,o.gzhead.time>>8&255),put_byte(o,o.gzhead.time>>16&255),put_byte(o,o.gzhead.time>>24&255),put_byte(o,9===o.level?2:o.strategy>=Z_HUFFMAN_ONLY||o.level<2?4:0),put_byte(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(put_byte(o,255&o.gzhead.extra.length),put_byte(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=crc32_1(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=EXTRA_STATE):(put_byte(o,0),put_byte(o,0),put_byte(o,0),put_byte(o,0),put_byte(o,0),put_byte(o,9===o.level?2:o.strategy>=Z_HUFFMAN_ONLY||o.level<2?4:0),put_byte(o,OS_CODE),o.status=BUSY_STATE);else{let t=Z_DEFLATED+(o.w_bits-8<<4)<<8,r=-1;r=o.strategy>=Z_HUFFMAN_ONLY||o.level<2?0:o.level<6?1:6===o.level?2:3,t|=r<<6,0!==o.strstart&&(t|=PRESET_DICT),t+=31-t%31,o.status=BUSY_STATE,putShortMSB(o,t),0!==o.strstart&&(putShortMSB(o,e.adler>>>16),putShortMSB(o,65535&e.adler)),e.adler=1}if(o.status===EXTRA_STATE)if(o.gzhead.extra){for(r=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>r&&(e.adler=crc32_1(e.adler,o.pending_buf,o.pending-r,r)),flush_pending(e),r=o.pending,o.pending!==o.pending_buf_size));)put_byte(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>r&&(e.adler=crc32_1(e.adler,o.pending_buf,o.pending-r,r)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=NAME_STATE)}else o.status=NAME_STATE;if(o.status===NAME_STATE)if(o.gzhead.name){r=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>r&&(e.adler=crc32_1(e.adler,o.pending_buf,o.pending-r,r)),flush_pending(e),r=o.pending,o.pending===o.pending_buf_size)){n=1;break}n=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,put_byte(o,n)}while(0!==n);o.gzhead.hcrc&&o.pending>r&&(e.adler=crc32_1(e.adler,o.pending_buf,o.pending-r,r)),0===n&&(o.gzindex=0,o.status=COMMENT_STATE)}else o.status=COMMENT_STATE;if(o.status===COMMENT_STATE)if(o.gzhead.comment){r=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>r&&(e.adler=crc32_1(e.adler,o.pending_buf,o.pending-r,r)),flush_pending(e),r=o.pending,o.pending===o.pending_buf_size)){n=1;break}n=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,put_byte(o,n)}while(0!==n);o.gzhead.hcrc&&o.pending>r&&(e.adler=crc32_1(e.adler,o.pending_buf,o.pending-r,r)),0===n&&(o.status=HCRC_STATE)}else o.status=HCRC_STATE;if(o.status===HCRC_STATE&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&flush_pending(e),o.pending+2<=o.pending_buf_size&&(put_byte(o,255&e.adler),put_byte(o,e.adler>>8&255),e.adler=0,o.status=BUSY_STATE)):o.status=BUSY_STATE),0!==o.pending){if(flush_pending(e),0===e.avail_out)return o.last_flush=-1,Z_OK}else if(0===e.avail_in&&rank(t)<=rank(a)&&t!==Z_FINISH)return err(e,Z_BUF_ERROR);if(o.status===FINISH_STATE&&0!==e.avail_in)return err(e,Z_BUF_ERROR);if(0!==e.avail_in||0!==o.lookahead||t!==Z_NO_FLUSH&&o.status!==FINISH_STATE){let r=o.strategy===Z_HUFFMAN_ONLY?deflate_huff(o,t):o.strategy===Z_RLE?deflate_rle(o,t):configuration_table[o.level].func(o,t);if(r!==BS_FINISH_STARTED&&r!==BS_FINISH_DONE||(o.status=FINISH_STATE),r===BS_NEED_MORE||r===BS_FINISH_STARTED)return 0===e.avail_out&&(o.last_flush=-1),Z_OK;if(r===BS_BLOCK_DONE&&(t===Z_PARTIAL_FLUSH?_tr_align$1(o):t!==Z_BLOCK&&(_tr_stored_block$1(o,0,0,!1),t===Z_FULL_FLUSH&&(zero$1$1(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),flush_pending(e),0===e.avail_out))return o.last_flush=-1,Z_OK}return t!==Z_FINISH?Z_OK:o.wrap<=0?Z_STREAM_END:(2===o.wrap?(put_byte(o,255&e.adler),put_byte(o,e.adler>>8&255),put_byte(o,e.adler>>16&255),put_byte(o,e.adler>>24&255),put_byte(o,255&e.total_in),put_byte(o,e.total_in>>8&255),put_byte(o,e.total_in>>16&255),put_byte(o,e.total_in>>24&255)):(putShortMSB(o,e.adler>>>16),putShortMSB(o,65535&e.adler)),flush_pending(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?Z_OK:Z_STREAM_END)},deflateEnd=e=>{if(!e||!e.state)return Z_STREAM_ERROR;const t=e.state.status;return t!==INIT_STATE&&t!==EXTRA_STATE&&t!==NAME_STATE&&t!==COMMENT_STATE&&t!==HCRC_STATE&&t!==BUSY_STATE&&t!==FINISH_STATE?err(e,Z_STREAM_ERROR):(e.state=null,t===BUSY_STATE?err(e,Z_DATA_ERROR):Z_OK)},deflateSetDictionary=(e,t)=>{let r=t.length;if(!e||!e.state)return Z_STREAM_ERROR;const n=e.state,o=n.wrap;if(2===o||1===o&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR;if(1===o&&(e.adler=adler32_1(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){0===o&&(zero$1$1(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(r-n.w_size,r),0),t=e,r=n.w_size}const a=e.avail_in,c=e.next_in,l=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,fill_window(n);n.lookahead>=MIN_MATCH$1;){let e=n.strstart,t=n.lookahead-(MIN_MATCH$1-1);do{n.ins_h=HASH(n,n.ins_h,n.window[e+MIN_MATCH$1-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=MIN_MATCH$1-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH$1-1,n.match_available=0,e.next_in=c,e.input=l,e.avail_in=a,n.wrap=o,Z_OK};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2=deflate,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var assign=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)_has(r,t)&&(e[t]=r[t])}}return e},flattenChunks=e=>{let t=0;for(let r=0,n=e.length;r<n;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,n=0,o=e.length;t<o;t++){let o=e[t];r.set(o,n),n+=o.length}return r},common$1={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=e=>{let t,r,n,o,a,c=e.length,l=0;for(o=0;o<c;o++)r=e.charCodeAt(o),55296==(64512&r)&&o+1<c&&(n=e.charCodeAt(o+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),o++)),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(l),a=0,o=0;a<l;o++)r=e.charCodeAt(o),55296==(64512&r)&&o+1<c&&(n=e.charCodeAt(o+1),56320==(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),o++)),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t};const buf2binstring=(e,t)=>{if(t<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r};var buf2string=(e,t)=>{let r,n;const o=t||e.length,a=new Array(2*o);for(n=0,r=0;r<o;){let t=e[r++];if(t<128){a[n++]=t;continue}let c=_utf8len[t];if(c>4)a[n++]=65533,r+=c-1;else{for(t&=2===c?31:3===c?15:7;c>1&&r<o;)t=t<<6|63&e[r++],c--;c>1?a[n++]=65533:t<65536?a[n++]=t:(t-=65536,a[n++]=55296|t>>10&1023,a[n++]=56320|1023&t)}}return buf2binstring(a,n)},utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+_utf8len[e[r]]>t?r:t},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$1,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_DEFLATED:Z_DEFLATED$1}=constants;function Deflate(e){this.options=common$1.assign({level:Z_DEFAULT_COMPRESSION$1,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY$1},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=deflate_1.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Z_OK$1)throw new Error(messages[r]);if(t.header&&deflate_1.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString$1.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=deflate_1.deflateSetDictionary(this.strm,e),r!==Z_OK$1)throw new Error(messages[r]);this._dict_set=!0}}function deflate$1(e,t){const r=new Deflate(t);if(r.push(e,!0),r.err)throw r.msg||messages[r.err];return r.result}function deflateRaw(e,t){return(t=t||{}).raw=!0,deflate$1(e,t)}function gzip(e,t){return(t=t||{}).gzip=!0,deflate$1(e,t)}Deflate.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let o,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Z_FINISH$1:Z_NO_FLUSH$1,"string"==typeof e?r.input=strings.string2buf(e):"[object ArrayBuffer]"===toString$1.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(a===Z_SYNC_FLUSH||a===Z_FULL_FLUSH$1)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(o=deflate_1.deflate(r,a),o===Z_STREAM_END$1)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),o=deflate_1.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Z_OK$1;if(0!==r.avail_out){if(a>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Deflate.prototype.onData=function(e){this.chunks.push(e)},Deflate.prototype.onEnd=function(e){e===Z_OK$1&&(this.result=common$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var deflate_1$1={Deflate,deflate:deflate$1,deflateRaw,gzip,constants};const BAD=30,TYPE=12;var inffast=function(e,t){let r,n,o,a,c,l,u,_,p,f,E,g,b,v,T,I,O,A,S,N,L,C,M,$;const k=e.state;r=e.next_in,M=e.input,n=r+(e.avail_in-5),o=e.next_out,$=e.output,a=o-(t-e.avail_out),c=o+(e.avail_out-257),l=k.dmax,u=k.wsize,_=k.whave,p=k.wnext,f=k.window,E=k.hold,g=k.bits,b=k.lencode,v=k.distcode,T=(1<<k.lenbits)-1,I=(1<<k.distbits)-1;e:do{g<15&&(E+=M[r++]<<g,g+=8,E+=M[r++]<<g,g+=8),O=b[E&T];t:for(;;){if(A=O>>>24,E>>>=A,g-=A,A=O>>>16&255,0===A)$[o++]=65535&O;else{if(!(16&A)){if(0==(64&A)){O=b[(65535&O)+(E&(1<<A)-1)];continue t}if(32&A){k.mode=TYPE;break e}e.msg="invalid literal/length code",k.mode=BAD;break e}S=65535&O,A&=15,A&&(g<A&&(E+=M[r++]<<g,g+=8),S+=E&(1<<A)-1,E>>>=A,g-=A),g<15&&(E+=M[r++]<<g,g+=8,E+=M[r++]<<g,g+=8),O=v[E&I];r:for(;;){if(A=O>>>24,E>>>=A,g-=A,A=O>>>16&255,!(16&A)){if(0==(64&A)){O=v[(65535&O)+(E&(1<<A)-1)];continue r}e.msg="invalid distance code",k.mode=BAD;break e}if(N=65535&O,A&=15,g<A&&(E+=M[r++]<<g,g+=8,g<A&&(E+=M[r++]<<g,g+=8)),N+=E&(1<<A)-1,N>l){e.msg="invalid distance too far back",k.mode=BAD;break e}if(E>>>=A,g-=A,A=o-a,N>A){if(A=N-A,A>_&&k.sane){e.msg="invalid distance too far back",k.mode=BAD;break e}if(L=0,C=f,0===p){if(L+=u-A,A<S){S-=A;do{$[o++]=f[L++]}while(--A);L=o-N,C=$}}else if(p<A){if(L+=u+p-A,A-=p,A<S){S-=A;do{$[o++]=f[L++]}while(--A);if(L=0,p<S){A=p,S-=A;do{$[o++]=f[L++]}while(--A);L=o-N,C=$}}}else if(L+=p-A,A<S){S-=A;do{$[o++]=f[L++]}while(--A);L=o-N,C=$}for(;S>2;)$[o++]=C[L++],$[o++]=C[L++],$[o++]=C[L++],S-=3;S&&($[o++]=C[L++],S>1&&($[o++]=C[L++]))}else{L=o-N;do{$[o++]=$[L++],$[o++]=$[L++],$[o++]=$[L++],S-=3}while(S>2);S&&($[o++]=$[L++],S>1&&($[o++]=$[L++]))}break}}break}}while(r<n&&o<c);S=g>>3,r-=S,g-=S<<3,E&=(1<<g)-1,e.next_in=r,e.next_out=o,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=o<c?c-o+257:257-(o-c),k.hold=E,k.bits=g};const MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(e,t,r,n,o,a,c,l)=>{const u=l.bits;let _,p,f,E,g,b,v=0,T=0,I=0,O=0,A=0,S=0,N=0,L=0,C=0,M=0,$=null,k=0;const D=new Uint16Array(MAXBITS+1),P=new Uint16Array(MAXBITS+1);let U,x,j,G=null,B=0;for(v=0;v<=MAXBITS;v++)D[v]=0;for(T=0;T<n;T++)D[t[r+T]]++;for(A=u,O=MAXBITS;O>=1&&0===D[O];O--);if(A>O&&(A=O),0===O)return o[a++]=20971520,o[a++]=20971520,l.bits=1,0;for(I=1;I<O&&0===D[I];I++);for(A<I&&(A=I),L=1,v=1;v<=MAXBITS;v++)if(L<<=1,L-=D[v],L<0)return-1;if(L>0&&(e===CODES||1!==O))return-1;for(P[1]=0,v=1;v<MAXBITS;v++)P[v+1]=P[v]+D[v];for(T=0;T<n;T++)0!==t[r+T]&&(c[P[t[r+T]]++]=T);if(e===CODES?($=G=c,b=19):e===LENS?($=lbase,k-=257,G=lext,B-=257,b=256):($=dbase,G=dext,b=-1),M=0,T=0,v=I,g=a,S=A,N=0,f=-1,C=1<<A,E=C-1,e===LENS&&C>ENOUGH_LENS||e===DISTS&&C>ENOUGH_DISTS)return 1;for(;;){U=v-N,c[T]<b?(x=0,j=c[T]):c[T]>b?(x=G[B+c[T]],j=$[k+c[T]]):(x=96,j=0),_=1<<v-N,p=1<<S,I=p;do{p-=_,o[g+(M>>N)+p]=U<<24|x<<16|j|0}while(0!==p);for(_=1<<v-1;M&_;)_>>=1;if(0!==_?(M&=_-1,M+=_):M=0,T++,0==--D[v]){if(v===O)break;v=t[r+c[T]]}if(v>A&&(M&E)!==f){for(0===N&&(N=A),g+=I,S=v-N,L=1<<S;S+N<O&&(L-=D[S+N],!(L<=0));)S++,L<<=1;if(C+=1<<S,e===LENS&&C>ENOUGH_LENS||e===DISTS&&C>ENOUGH_DISTS)return 1;f=M&E,o[f]=A<<24|S<<16|g-a|0}}return 0!==M&&(o[g+M]=v-N<<24|64<<16|0),l.bits=A,0};var inftrees=inflate_table;const CODES$1=0,LENS$1=1,DISTS$1=2,{Z_FINISH:Z_FINISH$2,Z_BLOCK:Z_BLOCK$1,Z_TREES,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_NEED_DICT,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFLATED:Z_DEFLATED$2}=constants,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE$1=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD$1=30,MEM=31,SYNC=32,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,MAX_WBITS$1=15,DEF_WBITS=MAX_WBITS$1,zswap32=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateResetKeep=e=>{if(!e||!e.state)return Z_STREAM_ERROR$1;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS$1),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS$1),t.sane=1,t.back=-1,Z_OK$2},inflateReset=e=>{if(!e||!e.state)return Z_STREAM_ERROR$1;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)},inflateReset2=(e,t)=>{let r;if(!e||!e.state)return Z_STREAM_ERROR$1;const n=e.state;return t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))},inflateInit2=(e,t)=>{if(!e)return Z_STREAM_ERROR$1;const r=new InflateState;e.state=r,r.window=null;const n=inflateReset2(e,t);return n!==Z_OK$2&&(e.state=null),n},inflateInit=e=>inflateInit2(e,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=e=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS$1,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS$1,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=(e,t,r,n)=>{let o;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),n>=a.wsize?(a.window.set(t.subarray(r-a.wsize,r),0),a.wnext=0,a.whave=a.wsize):(o=a.wsize-a.wnext,o>n&&(o=n),a.window.set(t.subarray(r-n,r-n+o),a.wnext),(n-=o)?(a.window.set(t.subarray(r-n,r),0),a.wnext=n,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0},inflate=(e,t)=>{let r,n,o,a,c,l,u,_,p,f,E,g,b,v,T,I,O,A,S,N,L,C,M=0;const $=new Uint8Array(4);let k,D;const P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR$1;r=e.state,r.mode===TYPE$1&&(r.mode=TYPEDO),c=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,n=e.input,l=e.avail_in,_=r.hold,p=r.bits,f=l,E=u,C=Z_OK$2;e:for(;;)switch(r.mode){case HEAD:if(0===r.wrap){r.mode=TYPEDO;break}for(;p<16;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(2&r.wrap&&35615===_){r.check=0,$[0]=255&_,$[1]=_>>>8&255,r.check=crc32_1(r.check,$,2,0),_=0,p=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",r.mode=BAD$1;break}if((15&_)!==Z_DEFLATED$2){e.msg="unknown compression method",r.mode=BAD$1;break}if(_>>>=4,p-=4,L=8+(15&_),0===r.wbits)r.wbits=L;else if(L>r.wbits){e.msg="invalid window size",r.mode=BAD$1;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=512&_?DICTID:TYPE$1,_=0,p=0;break;case FLAGS:for(;p<16;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(r.flags=_,(255&r.flags)!==Z_DEFLATED$2){e.msg="unknown compression method",r.mode=BAD$1;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=BAD$1;break}r.head&&(r.head.text=_>>8&1),512&r.flags&&($[0]=255&_,$[1]=_>>>8&255,r.check=crc32_1(r.check,$,2,0)),_=0,p=0,r.mode=TIME;case TIME:for(;p<32;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}r.head&&(r.head.time=_),512&r.flags&&($[0]=255&_,$[1]=_>>>8&255,$[2]=_>>>16&255,$[3]=_>>>24&255,r.check=crc32_1(r.check,$,4,0)),_=0,p=0,r.mode=OS;case OS:for(;p<16;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}r.head&&(r.head.xflags=255&_,r.head.os=_>>8),512&r.flags&&($[0]=255&_,$[1]=_>>>8&255,r.check=crc32_1(r.check,$,2,0)),_=0,p=0,r.mode=EXLEN;case EXLEN:if(1024&r.flags){for(;p<16;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}r.length=_,r.head&&(r.head.extra_len=_),512&r.flags&&($[0]=255&_,$[1]=_>>>8&255,r.check=crc32_1(r.check,$,2,0)),_=0,p=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(1024&r.flags&&(g=r.length,g>l&&(g=l),g&&(r.head&&(L=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(a,a+g),L)),512&r.flags&&(r.check=crc32_1(r.check,n,g,a)),l-=g,a+=g,r.length-=g),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(2048&r.flags){if(0===l)break e;g=0;do{L=n[a+g++],r.head&&L&&r.length<65536&&(r.head.name+=String.fromCharCode(L))}while(L&&g<l);if(512&r.flags&&(r.check=crc32_1(r.check,n,g,a)),l-=g,a+=g,L)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(4096&r.flags){if(0===l)break e;g=0;do{L=n[a+g++],r.head&&L&&r.length<65536&&(r.head.comment+=String.fromCharCode(L))}while(L&&g<l);if(512&r.flags&&(r.check=crc32_1(r.check,n,g,a)),l-=g,a+=g,L)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(512&r.flags){for(;p<16;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(_!==(65535&r.check)){e.msg="header crc mismatch",r.mode=BAD$1;break}_=0,p=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE$1;break;case DICTID:for(;p<32;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}e.adler=r.check=zswap32(_),_=0,p=0,r.mode=DICT;case DICT:if(0===r.havedict)return e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=l,r.hold=_,r.bits=p,Z_NEED_DICT;e.adler=r.check=1,r.mode=TYPE$1;case TYPE$1:if(t===Z_BLOCK$1||t===Z_TREES)break e;case TYPEDO:if(r.last){_>>>=7&p,p-=7&p,r.mode=CHECK;break}for(;p<3;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}switch(r.last=1&_,_>>>=1,p-=1,3&_){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t===Z_TREES){_>>>=2,p-=2;break e}break;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD$1}_>>>=2,p-=2;break;case STORED:for(_>>>=7&p,p-=7&p;p<32;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD$1;break}if(r.length=65535&_,_=0,p=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(g=r.length,g){if(g>l&&(g=l),g>u&&(g=u),0===g)break e;o.set(n.subarray(a,a+g),c),l-=g,a+=g,u-=g,c+=g,r.length-=g;break}r.mode=TYPE$1;break;case TABLE:for(;p<14;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(r.nlen=257+(31&_),_>>>=5,p-=5,r.ndist=1+(31&_),_>>>=5,p-=5,r.ncode=4+(15&_),_>>>=4,p-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD$1;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;p<3;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}r.lens[P[r.have++]]=7&_,_>>>=3,p-=3}for(;r.have<19;)r.lens[P[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,k={bits:r.lenbits},C=inftrees(CODES$1,r.lens,0,19,r.lencode,0,r.work,k),r.lenbits=k.bits,C){e.msg="invalid code lengths set",r.mode=BAD$1;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;M=r.lencode[_&(1<<r.lenbits)-1],T=M>>>24,I=M>>>16&255,O=65535&M,!(T<=p);){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(O<16)_>>>=T,p-=T,r.lens[r.have++]=O;else{if(16===O){for(D=T+2;p<D;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(_>>>=T,p-=T,0===r.have){e.msg="invalid bit length repeat",r.mode=BAD$1;break}L=r.lens[r.have-1],g=3+(3&_),_>>>=2,p-=2}else if(17===O){for(D=T+3;p<D;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}_>>>=T,p-=T,L=0,g=3+(7&_),_>>>=3,p-=3}else{for(D=T+7;p<D;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}_>>>=T,p-=T,L=0,g=11+(127&_),_>>>=7,p-=7}if(r.have+g>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD$1;break}for(;g--;)r.lens[r.have++]=L}}if(r.mode===BAD$1)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=BAD$1;break}if(r.lenbits=9,k={bits:r.lenbits},C=inftrees(LENS$1,r.lens,0,r.nlen,r.lencode,0,r.work,k),r.lenbits=k.bits,C){e.msg="invalid literal/lengths set",r.mode=BAD$1;break}if(r.distbits=6,r.distcode=r.distdyn,k={bits:r.distbits},C=inftrees(DISTS$1,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,k),r.distbits=k.bits,C){e.msg="invalid distances set",r.mode=BAD$1;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(l>=6&&u>=258){e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=l,r.hold=_,r.bits=p,inffast(e,E),c=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,n=e.input,l=e.avail_in,_=r.hold,p=r.bits,r.mode===TYPE$1&&(r.back=-1);break}for(r.back=0;M=r.lencode[_&(1<<r.lenbits)-1],T=M>>>24,I=M>>>16&255,O=65535&M,!(T<=p);){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(I&&0==(240&I)){for(A=T,S=I,N=O;M=r.lencode[N+((_&(1<<A+S)-1)>>A)],T=M>>>24,I=M>>>16&255,O=65535&M,!(A+T<=p);){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}_>>>=A,p-=A,r.back+=A}if(_>>>=T,p-=T,r.back+=T,r.length=O,0===I){r.mode=LIT;break}if(32&I){r.back=-1,r.mode=TYPE$1;break}if(64&I){e.msg="invalid literal/length code",r.mode=BAD$1;break}r.extra=15&I,r.mode=LENEXT;case LENEXT:if(r.extra){for(D=r.extra;p<D;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}r.length+=_&(1<<r.extra)-1,_>>>=r.extra,p-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;M=r.distcode[_&(1<<r.distbits)-1],T=M>>>24,I=M>>>16&255,O=65535&M,!(T<=p);){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(0==(240&I)){for(A=T,S=I,N=O;M=r.distcode[N+((_&(1<<A+S)-1)>>A)],T=M>>>24,I=M>>>16&255,O=65535&M,!(A+T<=p);){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}_>>>=A,p-=A,r.back+=A}if(_>>>=T,p-=T,r.back+=T,64&I){e.msg="invalid distance code",r.mode=BAD$1;break}r.offset=O,r.extra=15&I,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(D=r.extra;p<D;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}r.offset+=_&(1<<r.extra)-1,_>>>=r.extra,p-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD$1;break}r.mode=MATCH;case MATCH:if(0===u)break e;if(g=E-u,r.offset>g){if(g=r.offset-g,g>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD$1;break}g>r.wnext?(g-=r.wnext,b=r.wsize-g):b=r.wnext-g,g>r.length&&(g=r.length),v=r.window}else v=o,b=c-r.offset,g=r.length;g>u&&(g=u),u-=g,r.length-=g;do{o[c++]=v[b++]}while(--g);0===r.length&&(r.mode=LEN);break;case LIT:if(0===u)break e;o[c++]=r.length,u--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;p<32;){if(0===l)break e;l--,_|=n[a++]<<p,p+=8}if(E-=u,e.total_out+=E,r.total+=E,E&&(e.adler=r.check=r.flags?crc32_1(r.check,o,E,c-E):adler32_1(r.check,o,E,c-E)),E=u,(r.flags?_:zswap32(_))!==r.check){e.msg="incorrect data check",r.mode=BAD$1;break}_=0,p=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;p<32;){if(0===l)break e;l--,_+=n[a++]<<p,p+=8}if(_!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=BAD$1;break}_=0,p=0}r.mode=DONE;case DONE:C=Z_STREAM_END$2;break e;case BAD$1:C=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=c,e.avail_out=u,e.next_in=a,e.avail_in=l,r.hold=_,r.bits=p,(r.wsize||E!==e.avail_out&&r.mode<BAD$1&&(r.mode<CHECK||t!==Z_FINISH$2))&&updatewindow(e,e.output,e.next_out,E-e.avail_out),f-=e.avail_in,E-=e.avail_out,e.total_in+=f,e.total_out+=E,r.total+=E,r.wrap&&E&&(e.adler=r.check=r.flags?crc32_1(r.check,o,E,e.next_out-E):adler32_1(r.check,o,E,e.next_out-E)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE$1?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(0===f&&0===E||t===Z_FINISH$2)&&C===Z_OK$2&&(C=Z_BUF_ERROR$1),C},inflateEnd=e=>{if(!e||!e.state)return Z_STREAM_ERROR$1;let t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$2},inflateGetHeader=(e,t)=>{if(!e||!e.state)return Z_STREAM_ERROR$1;const r=e.state;return 0==(2&r.wrap)?Z_STREAM_ERROR$1:(r.head=t,t.done=!1,Z_OK$2)},inflateSetDictionary=(e,t)=>{const r=t.length;let n,o,a;return e&&e.state?(n=e.state,0!==n.wrap&&n.mode!==DICT?Z_STREAM_ERROR$1:n.mode===DICT&&(o=1,o=adler32_1(o,t,r,0),o!==n.check)?Z_DATA_ERROR$1:(a=updatewindow(e,t,r,r),a?(n.mode=MEM,Z_MEM_ERROR):(n.havedict=1,Z_OK$2))):Z_STREAM_ERROR$1};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2=inflate,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_FINISH:Z_FINISH$3,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_MEM_ERROR:Z_MEM_ERROR$1}=constants;function Inflate(e){this.options=common$1.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let r=inflate_1.inflateInit2(this.strm,t.windowBits);if(r!==Z_OK$3)throw new Error(messages[r]);if(this.header=new gzheader,inflate_1.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString$1$1.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=inflate_1.inflateSetDictionary(this.strm,t.dictionary),r!==Z_OK$3)))throw new Error(messages[r])}function inflate$1(e,t){const r=new Inflate(t);if(r.push(e),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,o=this.options.dictionary;let a,c,l;if(this.ended)return!1;for(c=t===~~t?t:!0===t?Z_FINISH$3:Z_NO_FLUSH$2,"[object ArrayBuffer]"===toString$1$1.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),a=inflate_1.inflate(r,c),a===Z_NEED_DICT$1&&o&&(a=inflate_1.inflateSetDictionary(r,o),a===Z_OK$3?a=inflate_1.inflate(r,c):a===Z_DATA_ERROR$2&&(a=Z_NEED_DICT$1));r.avail_in>0&&a===Z_STREAM_END$3&&r.state.wrap>0&&0!==e[r.next_in];)inflate_1.inflateReset(r),a=inflate_1.inflate(r,c);switch(a){case Z_STREAM_ERROR$2:case Z_DATA_ERROR$2:case Z_NEED_DICT$1:case Z_MEM_ERROR$1:return this.onEnd(a),this.ended=!0,!1}if(l=r.avail_out,r.next_out&&(0===r.avail_out||a===Z_STREAM_END$3))if("string"===this.options.to){let e=strings.utf8border(r.output,r.next_out),t=r.next_out-e,o=strings.buf2string(r.output,e);r.next_out=t,r.avail_out=n-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(o)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(a!==Z_OK$3||0!==l){if(a===Z_STREAM_END$3)return a=inflate_1.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===Z_OK$3&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var inflate_1$1={Inflate,inflate:inflate$1,inflateRaw,ungzip:inflate$1,constants};const{Deflate:Deflate$1,deflate:deflate$2,deflateRaw:deflateRaw$1,gzip:gzip$1}=deflate_1$1,{Inflate:Inflate$1,inflate:inflate$2,inflateRaw:inflateRaw$1,ungzip}=inflate_1$1;var pako={Deflate:Deflate$1,deflate:deflate$2,deflateRaw:deflateRaw$1,gzip:gzip$1,Inflate:Inflate$1,inflate:inflate$2,inflateRaw:inflateRaw$1,ungzip,constants};function createFind(e){return function(t,r,n){var o=Object(t);if(!isArrayLike_1(t)){var a=_baseIteratee(r);t=keys_1(t),r=function(e){return a(o[e],e,o)}}var c=e(t,r,n);return c>-1?o[a?t[c]:c]:void 0}}var _createFind=createFind;function baseFindIndex(e,t,r,n){for(var o=e.length,a=r+(n?1:-1);n?a--:++a<o;)if(t(e[a],a,e))return a;return-1}var _baseFindIndex=baseFindIndex,NAN=NaN,reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(e){if("number"==typeof e)return e;if(isSymbol_1(e))return NAN;if(isObject_1(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject_1(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var toNumber_1=toNumber,INFINITY$2=1/0,MAX_INTEGER=17976931348623157e292;function toFinite(e){return e?(e=toNumber_1(e))===INFINITY$2||e===-INFINITY$2?(e<0?-1:1)*MAX_INTEGER:e==e?e:0:0===e?e:0}var toFinite_1=toFinite;function toInteger(e){var t=toFinite_1(e),r=t%1;return t==t?r?t-r:t:0}var toInteger_1=toInteger,nativeMax$1=Math.max;function findIndex(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var o=null==r?0:toInteger_1(r);return o<0&&(o=nativeMax$1(n+o,0)),_baseFindIndex(e,_baseIteratee(t),o)}var findIndex_1=findIndex,find=_createFind(findIndex_1),find_1=find;function baseIsNaN(e){return e!=e}var _baseIsNaN=baseIsNaN;function strictIndexOf(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}var _strictIndexOf=strictIndexOf;function baseIndexOf(e,t,r){return t==t?_strictIndexOf(e,t,r):_baseFindIndex(e,_baseIsNaN,r)}var _baseIndexOf=baseIndexOf;function arrayIncludes(e,t){return!!(null==e?0:e.length)&&_baseIndexOf(e,t,0)>-1}var _arrayIncludes=arrayIncludes;function arrayIncludesWith(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1}var _arrayIncludesWith=arrayIncludesWith;function noop$2(){}var noop_1=noop$2,INFINITY$3=1/0,createSet=_Set&&1/_setToArray(new _Set([,-0]))[1]==INFINITY$3?function(e){return new _Set(e)}:noop_1,_createSet=createSet,LARGE_ARRAY_SIZE$1=200;function baseUniq(e,t,r){var n=-1,o=_arrayIncludes,a=e.length,c=!0,l=[],u=l;if(r)c=!1,o=_arrayIncludesWith;else if(a>=LARGE_ARRAY_SIZE$1){var _=t?null:_createSet(e);if(_)return _setToArray(_);c=!1,o=_cacheHas,u=new _SetCache}else u=t?[]:l;e:for(;++n<a;){var p=e[n],f=t?t(p):p;if(p=r||0!==p?p:0,c&&f==f){for(var E=u.length;E--;)if(u[E]===f)continue e;t&&u.push(f),l.push(p)}else o(u,f,r)||(u!==l&&u.push(f),l.push(p))}return l}var _baseUniq=baseUniq;function uniqWith(e,t){return t="function"==typeof t?t:void 0,e&&e.length?_baseUniq(e,void 0,t):[]}var uniqWith_1=uniqWith;function comparator(e,t){return long_1.fromValue(e).eq(t)}function validateField(e,t){const r=void 0===t?e.val:t,{isBoolean:n,isNumber:o,oneof:a,len:c}=e;if(2!==[n,o,a].filter((e=>!e)).length)throw new TypeError("invalid field type");if(void 0===r)return;let l=!1;if(void 0!==a){const e=values_1(a);uniqWith_1(e,comparator).length===e.length&&void 0!==find_1(e,(e=>comparator(r,e)))&&(l=!0)}const u=void 0!==n&&(0===r||1===r)&&1===c,_=void 0!==o&&r.toString(2).length<=c;if(!(l||u||_))throw new Error("invalid field value")}class Struct{constructor(){this.size=0,this.fields=new Map}define(e,t,r){if(this.size+=r,this.size>64)throw new RangeError("the struct over 64 bits is not supported");const n={val:0,isNumber:"number"===t,isBoolean:"boolean"===t,oneof:"number"===t||"boolean"===t?void 0:t,len:r};validateField(n),this.fields.set(e,n)}set(e,t){const r=this.fields.get(e);if(!r)throw new Error("field not found");const{oneof:n}=r;let o;if(long_1.isLong(t)||"number"==typeof t)o=t;else if("boolean"==typeof t)o=t?1:0;else{if(void 0===n)throw new Error("invalid field type");const e=n[t];if(void 0===e)throw new Error("field type not found");o=e}validateField(r,o),r.val=o}toNumber(){let e=0,t=0;for(const[,r]of this.fields){const{len:n,val:o}=r;void 0!==o&&(e+=long_1.fromValue(o).shiftLeft(t).toNumber(),t+=n)}return e}toLong(){let e=long_1.fromNumber(0,!0),t=0;for(const[,r]of this.fields){const{len:n,val:o}=r;void 0!==o&&(e=long_1.fromValue(o).shiftLeft(t).add(e),t+=n)}return e}assert(e,t){const r=this.fields.get(e);if(!r)throw new Error("field not found");const{oneof:n}=r;function o(e){let t;if(long_1.isLong(e)||"number"==typeof e)t=e;else if("boolean"==typeof e)t=e?1:0;else{if(void 0===n)throw new Error("invalid field type");const r=n[e];if(void 0===r)throw new Error("field type not found");t=r}return validateField(r,t),comparator(t,r.val)}if(!Array.isArray(t))return o(t);if(1===t.length)return o(t[0]);if(t.every((e=>"string"==typeof e))&&void 0!==n)return t.some((e=>o(e)));throw new Error("invalid valueTypes")}from(e){const t=long_1.fromValue(e);let r=0;for(const[,e]of this.fields){const{len:n}=e,o=long_1.fromNumber(2**n-1,!0).shiftLeft(r),a=t.and(o).shiftRightUnsigned(r);validateField(e,a),e.val=a,r+=n}}typeOf(e){const t=this.fields.get(e);if(void 0!==t){const{oneof:e,val:r}=t;if(void 0!==e)for(const[t,n]of Object.entries(e))if(comparator(r,n))return t}throw new TypeError("can only get type of oneof type")}}class UserJoinOptions extends Struct{constructor(e){super(),this.define("Rejoin","boolean",1),this.define("Unused","number",31),this.define("Platform","number",8),this.define("Version","number",12),this.define("Subversion","number",12),this.set("Platform",PLATFORM_TYPE),this.set("Version",VERSION_NO),this.set("Subversion",SUBVERSION),this.set("Rejoin",e)}}const InvitationType={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},TextMessageDstType={PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2},MessageDstType={...TextMessageDstType},MessageType={...MessageDstType,...InvitationType},CompressionMethod={Uncompressed:0,Zlib:1};class MessageOption extends Struct{constructor(e){if(super(),this.define("MessageType",MessageType,8),this.define("BroadcastJumps","number",2),this.define("ToCache","boolean",1),this.define("FromCache","boolean",1),this.define("CompressionMethod",CompressionMethod,2),this.define("IterationNumber","number",4),this.define("BufferedMessage","boolean",1),this.define("ToArchive","boolean",1),this.define("FromArchive","boolean",1),isLongNum(e))this.from(e);else if(void 0!==e)for(const[t,r]of getEntries(e))this.set(t,r)}isTextMessage(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}isPeerTextMessage(){return this.assert("MessageType","PeerTextMessage")}isChannelTextMessage(){return this.assert("MessageType","ChannelTextMessage")}isPeerMessage(){return this.assert("MessageType",["PeerTextMessage"])}isZlibCompressed(){return this.assert("CompressionMethod","Zlib")}isFromCache(){return this.assert("FromCache",!0)}isBufferedMessage(){return this.assert("BufferedMessage",!0)}isFromArchive(){return this.assert("FromArchive",!0)}isInvitation(e){return void 0!==e?this.assert("MessageType",e):getKeys(InvitationType).some((e=>this.assert("MessageType",e)))}getInvitationType(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}class ChatManager extends(createEventBase()){constructor(e){super(e,"ChatManager"),this.dialogueLru=new TLRUCache(void 0,{maxlen:LRU_MAX_ITEMS,ttl:DIALOGUE_EXPIRE_TIMEOUT})}getChatInfo(e){const t=this.dialogueLru.get(e);if(this.dialogueLru.prune(),t){const{dialogue:r,sequence:n}=t,o=n.add(1),a={dialogue:r,sequence:o};return this.dialogueLru.set(e,{dialogue:r,sequence:o}),a}const r={dialogue:getRandomUInt64(),sequence:long_1.fromNumber(1,!0)};return this.dialogueLru.set(e,r),r}}const{inflate:inflate$3,deflate:deflate$3}=pako;class Session$2 extends(createEventBase()){static sendMessageAck(e,t){const r=new MessageOption(e.options);(r.isInvitation()||r.isPeerMessage())&&t.sendPacket("Ack",{code:0,dialogue:e.dialogue,instance:e.instance,sequence:e.sequence})}constructor(e,t,r,n){super(n,"Session"),this.context=e,this.connection=t,this.instanceId=r,this.chatManager=new ChatManager(this.logger),this.joinedChannels=new Set,this.msgDedupLru=new LRUCache(void 0,{maxlen:MSG_DEDUP_MAX_LEN}),this.startTime=Date.now(),this.seq=long_1.fromNumber(1,!0),this.userJoinOptions=new UserJoinOptions(!1),this.seqSentStatuses=[!1,!1],this.dialogueSequenceLru=new LRUCache(void 0,{maxlen:LRU_MAX_ITEMS}),this.messageSentTimes=[],this.curLoginSockets=[void 0,void 0],this.loginSocketSubs=[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}],this.lastLoginSockets=[new ReplaySubject(1),new ReplaySubject(1)],this.dialPendingMsgSubjectMaps=[new Map,new Map],this.registerSocketsFailureListener=()=>{this.connection.once("socketsFailure",(()=>{this.log("socketsFailure, creating a new connection"),defer((()=>(this.connection.removeAllListeners(),this.connection=new Connection(this.context,this.logger),this.loginHandler(6e3,!0)))).pipe(retryWhen((e=>e.pipe(delay(2e3)))),takeUntil(this.connection.apClient.apFinish$)).subscribe((()=>{this.log("new connection connected")}))})),0===this.connection.listenerCount("tokenExpired")&&this.connection.on("tokenExpired",(()=>{this.emit("tokenExpired")}))},this.log("The instanceId is %s",this.instanceId.toString())}loginHandler(e=CLIENT_LOGIN_TIMEOUT,t=!1){t&&this.registerSocketsFailureListener(),this.connection.initConnection();const{seq:r}=this,n=this.getSocketLoginObservables(this.connection.lastOpenSockets,r),o=Date.now();return n.forEach(((e,r)=>{const{login:n}=this.loginSocketSubs[r];void 0!==n&&n.unsubscribe(),this.loginSocketSubs[r].login=e.pipe(tap((e=>{this.curLoginSockets[r]=e;const n=Date.now();sendReport("Link",{ackedServerIp:e.address,destServerIp:e.ip,ec:0,sc:0,elapse:getElapse(this.startTime),lts:long_1.fromNumber(n),responseTime:o-n,sid:getSid(this.instanceId),userId:this.context.uid}),this.emit("userJoined",e.env),t&&this.connection.apClient.apFinish$.next(void 0)}))).subscribe(this.lastLoginSockets[r])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),merge(...n,fromEvent(this.connection,"connectionInitFailure").pipe(tap((e=>{if(isRtmError(e)||isTimeout(e))throw e;throw new RtmUnavailableError("Login failure",{code:LOGIN_ERR_UNKNOWN,originalError:e})})))).pipe(first(),timeout(e),catchError((e=>(e instanceof TimeoutError&&this.warn("Client login timeout"),e&&e.code===LOGIN_ERR_TOKEN_EXPIRED&&(this.connection.emit("tokenExpired"),this.connection.apClient.apFinish$.next(void 0)),this.clearSockets(0,t),throwError(e)))),tap((()=>{t||this.registerSocketsFailureListener()})),finalize((()=>{t||this.connection.apClient.apFinish$.next(void 0)})))}async logoutHandler(){const e=this.getLoginSockets(),t=e.map((e=>(e.sendPacket("UserQuit",{}),this.connection.waitClosing(e))));this.clearSockets(LOGOUT_SOCKET_CLOSE_TIMEOUT);const r=e.map((e=>e.env));return[0,1].filter((e=>!r.includes(e))).forEach((e=>{this.connection.closeSocket(e,0)})),merge(...t).toPromise()}async requestChannelJoin(e,t){if(0===this.getLoginSockets().length)throw new RtmInvalidStatusError("Client is not logged in. Cannot join the channel",JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN);const r=fromEvent(this,"channelLeft").pipe(filter((t=>t===e)),take(1)),n=this.incGetSeq(),o=this.lastLoginSockets.map((e=>e.pipe(switchMap(((e,r)=>{0!==r&&this.incSeqIfNeeded(e.env);const o=0===r?n:this.seq;return e.sendPacket("GroupEnter",{account:t,seq:o}),e.fromReceived("GroupReply").pipe(first((({seq:e})=>o.eq(e))),tap((({code:e})=>{if(0!==e)throw new RtmUnavailableError(["Channel join failure. The response code is %d",e],JOIN_CHANNEL_ERR_FAILURE)})))})),takeUntil(r),share())));o.forEach(((t,r)=>{const n=()=>this.loginSocketSubs[r].channels.delete(e.channelId);this.loginSocketSubs[r].channels.set(e.channelId,t.subscribe({error:n,complete:n}))})),await merge(...o).pipe(first(),timeout(COMMON_REQUEST_TIMEOUT),catchError((e=>(e instanceof TimeoutError&&this.warn("Channel join timeout"),throwError(e))))).toPromise(),this.joinedChannels.add(e)}requestSetChannelAttributes(e,t,r){const n=this.getLoginSockets();if(0===n.length)throw new RtmInvalidStatusError("Client is not logged in");const o=this.incGetSeq();return n.forEach((n=>{n.sendPacket("GroupAttributeSet",{broadcast:r,group:e,attributeInfos:Object.entries(t).map((([e,t])=>({key:e,value:t}))),seq:o})})),race(...n.map((e=>e.fromReceived("GroupAttributeErr").pipe(first((({seq:e})=>o.eq(e))),map$1((({code:e})=>{throw new RtmUnavailableError(["The group attributes set failure, code %d",e],ATTRIBUTE_OPERATION_ERR_FAILURE)}))))),Session$2.genTimeoutError(ATTRIBUTE_OPERATION_ERR_TIMEOUT),...n.map((e=>e.fromReceived("GroupAttributeRsp").pipe(first((({seq:e})=>o.eq(e)))))))}requestGetChannelAttributesByKeys(e,t){const r=this.getLoginSockets();if(0===r.length)throw new RtmInvalidStatusError("Client is not logged in");const n=this.incGetSeq();return r.forEach((r=>{r.sendPacket("GroupAttributeGet",{group:e,seq:n,attributes:t})})),race(Session$2.genTimeoutError(ATTRIBUTE_OPERATION_ERR_TIMEOUT),...r.map((e=>e.fromReceived("GroupAttributeErr").pipe(first((({seq:e})=>n.eq(e))),map$1((({code:e})=>{throw new RtmUnavailableError(["The channel attributes get failure, code %d",e],ATTRIBUTE_OPERATION_ERR_FAILURE)}))))),...r.map((e=>e.fromReceived("GroupAttributeRet").pipe(first((({seq:e})=>n.eq(e)))))))}requestAddOrUpdateChannelAttributes(e,t,r){const n=this.getLoginSockets();if(0===n.length)throw new RtmInvalidStatusError("Client is not logged in");const o=this.incGetSeq();return n.forEach((n=>{n.sendPacket("GroupAttributeMod",{broadcast:r,group:e,attributeInfos:Object.entries(t).map((([e,t])=>({key:e,value:t}))),seq:o})})),race(...n.map((e=>e.fromReceived("GroupAttributeErr").pipe(first((({seq:e})=>o.eq(e))),map$1((({code:e})=>{throw new RtmUnavailableError(["The group attributes add or update failure, code %d",e],ATTRIBUTE_OPERATION_ERR_FAILURE)}))))),Session$2.genTimeoutError(ATTRIBUTE_OPERATION_ERR_TIMEOUT),...n.map((e=>e.fromReceived("GroupAttributeRsp").pipe(first((({seq:e})=>o.eq(e)))))))}requestGetChannelAttributesKeys(e){const t=this.getLoginSockets();if(0===t.length)throw new RtmInvalidStatusError("Client is not logged in");const r=this.incGetSeq();return t.forEach((t=>{t.sendPacket("GroupAttributeKeysGet",{group:e,seq:r})})),race(Session$2.genTimeoutError(ATTRIBUTE_OPERATION_ERR_TIMEOUT),...t.map((e=>e.fromReceived("GroupAttributeErr").pipe(first((({seq:e})=>r.eq(e))),map$1((({code:e})=>{throw new RtmUnknownError(["Channel attribute operation unknown error code: %d",e],ATTRIBUTE_OPERATION_ERR_FAILURE)}))))),...t.map((e=>e.fromReceived("GroupAttributeKeysRet").pipe(first((({seq:e})=>r.eq(e)))))))}requestDeleteChannelAttributesByKeys(e,t,r){const n=this.getLoginSockets();if(0===n.length)throw new RtmInvalidStatusError("Client is not logged in");const o=this.incGetSeq();return n.forEach((n=>{n.sendPacket("GroupAttributeDel",{group:e,broadcast:r,attributes:t,seq:o})})),race(...n.map((e=>e.fromReceived("GroupAttributeErr").pipe(first((({seq:e})=>o.eq(e))),map$1((({code:e})=>{throw new RtmUnavailableError(["The channel attributes delete failure, code %d",e],ATTRIBUTE_OPERATION_ERR_FAILURE)}))))),Session$2.genTimeoutError(ATTRIBUTE_OPERATION_ERR_TIMEOUT),...n.map((e=>e.fromReceived("GroupAttributeRsp").pipe(first((({seq:e})=>o.eq(e)))))))}requestClearChannelAttributes(e,t){const r=this.getLoginSockets();if(0===r.length)throw new RtmInvalidStatusError("Client is not logged in");const n=this.incGetSeq();return r.forEach((r=>{r.sendPacket("GroupAttributeSet",{group:e,seq:n,attributeInfos:[],broadcast:t})})),race(...r.map((e=>e.fromReceived("GroupAttributeErr").pipe(first((({seq:e})=>n.eq(e))),map$1((({code:e})=>{throw new RtmUnavailableError(["The channel attributes clear failure, code %d",e],ATTRIBUTE_OPERATION_ERR_FAILURE)}))))),Session$2.genTimeoutError(ATTRIBUTE_OPERATION_ERR_TIMEOUT),...r.map((e=>e.fromReceived("GroupAttributeRsp").pipe(first((({seq:e})=>n.eq(e)))))))}requestChannelLeave(e,t){this.emit("channelLeft",e),this.joinedChannels.delete(e);this.getLoginSockets().forEach((e=>{e.sendPacket("GroupLeave",{account:t})}))}requestChannelMemberList(e){const t=this.getLoginSockets();if(0===t.length)throw new RtmInvalidStatusError("Client is not logged in. Cannot get the channel members",GET_MEMBERS_ERR_REJECTED);const r=this.incGetSeq();return t.forEach((t=>{t.sendPacket("GroupAllUsersList",{group:e,pageNumber:0,pageSize:200,seq:r})})),race(Session$2.genTimeoutError(COMMON_REQUEST_TIMEOUT),...t.map((t=>t.fromReceived("GroupAllUsersResult").pipe(first((({group:t,seq:n})=>t===e&&r.eq(n)))))))}async sendTextMessage(e,t,r,{enableOfflineMessaging:n,enableHistoricalMessaging:o},a){if(!isValidId(t))throw new RtmInvalidArgumentError("The send message arguments are not valid",r?PEER_MESSAGE_ERR_INVALID_USERID:CHANNEL_MESSAGE_ERR_FAILURE);const c=getUtf8StringSize(e);if(c>TEXT_MESSAGE_MAX_TEXT_BYTES)throw new RtmLimitExceededError("The message size is over the 32KB limit",r?PEER_MESSAGE_ERR_INVALID_MESSAGE:CHANNEL_MESSAGE_ERR_INVALID_MESSAGE);const l=!AgoraRTM.getParameter("DISABLE_MESSAGE_COMPRESSION")&&c>=MESSAGE_MIN_COMPRESSION_LEN,{dialogue:u,sequence:_}=this.chatManager.getChatInfo(t),p=this.instanceId;this.log(`A%s %s message is sending to %s: "${p}-${u}#${_}"`,l?" compressed":"",r?"peer":"channel",t);const{code:f}=await from(this.sendMessageToRetry((a=>({MiscMap:{},sequence:_,dialogue:u,instance:p,dst:t,ms:long_1.fromNumber(Date.now(),!0),options:new MessageOption({IterationNumber:a,CompressionMethod:l?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:n,ToArchive:o}).toLong(),payload:l?deflate$3(e):encodeStringToUint8Array(e),src:this.context.uid})),!0)).pipe(timeout(void 0===a?COMMON_REQUEST_TIMEOUT:a),catchError((e=>(e instanceof TimeoutError&&this.warn("Send message timeout"),throwError(e))))).toPromise();return{hasPeerReceived:0===f}}async sendInvitationMessage({peerId:e,callId:t,extra:r,isAcceptAck:n,channelId:o,type:a}){"0"===t&&this.info("[rtm-API] EndCall message send api is called");const c={callId:t};if(void 0!==n){if("CallAccept"!==a)throw new Error("invalid invitation type");c.type=n?"ack":"request"}c.channel=o;("CallInvite"===a||"CallCancel"===a||"CallReject"===a||"CallAccept"===a&&!1===n)&&void 0!==r&&(c.extra=r);const l=getRandomUInt64();this.log("The sent invitation body is %o",c);const{code:u,retryTimes:_}=await from(this.sendMessageToRetry((t=>({MiscMap:{},sequence:long_1.fromNumber(1),dialogue:l,instance:this.instanceId,dst:e,ms:long_1.fromNumber(Date.now(),!0),options:new MessageOption({IterationNumber:t,MessageType:a}).toLong(),payload:encodeStringToUint8Array(JSON.stringify(c)),src:this.context.uid})),!0)).pipe(timeout(MESSAGE_SEND_TIMEOUT),catchError((e=>(e instanceof TimeoutError&&this.warn("Send invitation timeout"),throwError(e))))).toPromise();return{hasPeerReceived:0===u,hasReSent:0!==_}}cleanLoginSubs(e,t){Object.entries(this.loginSocketSubs[e]).forEach((([e,r])=>{"channels"===e&&t||(Array.isArray(r)||r instanceof Map?r.forEach((e=>e.unsubscribe())):r&&r.unsubscribe())})),this.loginSocketSubs[e]={channels:t?this.loginSocketSubs[e].channels:new Map,receivers:[]}}async sendMessageToRetry(e,t,r=0){this.log("Attempt to send the message "+(t?" with retrying, %o":"without retrying"),{retryTimes:r});const n=this.getLoginSockets();if(0===n.length)throw new Error("no logged-in sockets");const o=e(r);n.forEach((e=>{e.sendPacket("Message",o)}));const{dialogue:a,sequence:c,instance:l}=o,u=n.map((e=>e.fromReceived("Ack").pipe(filter((e=>a.eq(e.dialogue)&&c.eq(e.sequence)&&l.eq(e.instance))))));try{const{code:e}=await merge(...u).pipe(timeout(MESSAGE_RETRY_TIMEOUT),catchError((e=>(isTimeout(e)&&this.warn("Send message retry timeout"),throwError(e)))),first()).toPromise();return this.log("The message has been acked, %o",{code:e}),{code:e,retryTimes:r}}catch(n){if(n instanceof TimeoutError&&t)return this.sendMessageToRetry(e,!1,r+1);throw n}}initKeepAliveSender(){this.lastLoginSockets.map((e=>e.pipe(switchMap((e=>timer(0,KEEPALIVE_INTERVAL).pipe(tap((()=>{this.incSeqIfNeeded(e.env),e.sendPacket("Ping",{ms:long_1.fromNumber(Date.now(),!0),seq:this.seq})})))))))).forEach(((e,t)=>{const{keepAlive:r}=this.loginSocketSubs[t];void 0!==r&&r.unsubscribe(),this.loginSocketSubs[t].keepAlive=e.subscribe({error:()=>{}})}))}initKeepAliveReconnector(){this.lastLoginSockets.map((e=>e.pipe(switchMap((e=>{let t,r=!1;const n=e.userJoin$.pipe(tap((()=>{r=!0}))),o=e.input$.pipe(tap((e=>{"Ping"!==uriToPacketName(e.uri)&&(r=!1)})));return merge(timer(LOGIN_RESP_TIMEOUT,SOCKET_KEEPALIVE_TIMEOUT).pipe(withLatestFrom(e.receivedPacket),tap((([,[,n]])=>{t!==n||r||e.forceReconnect(),t=n}))),n,o)}))))).forEach(((e,t)=>{const{keepAliveReconnector:r}=this.loginSocketSubs[t];void 0!==r&&r.unsubscribe(),this.loginSocketSubs[t].keepAliveReconnector=e.subscribe({error:()=>{}})}))}initLoginReceiver(){this.lastLoginSockets.map((e=>e.pipe(switchMap((e=>merge(fromEvent(e,"reconnect").pipe(tap(this.onSocketReconnect(e))),e.fromReceived("Message").pipe(tap(this.onMessage(e))),e.fromReceived("GroupEnterNotice").pipe(tap(this.onGroupEnterNotice())),e.fromReceived("GroupLeaveNotice").pipe(tap(this.onGroupLeaveNotice())),e.fromReceived("GroupAttributeAlt").pipe(tap(this.onGroupAttributeAlt()))).pipe(mapTo(void 0))))))).forEach(((e,t)=>{this.loginSocketSubs[t].receivers.push(e.subscribe({error:()=>{}}))}))}requestSocketLogin(e,t,r){return concat(defer((()=>{this.userJoinOptions=new UserJoinOptions(t),e.sendPacket("UserJoin",{account:this.context.uid,instance:this.instanceId,opt:this.userJoinOptions.toLong(),seq:r,ticket:e.ticket})})),e.fromReceived("UserResp").pipe(first((e=>r.eq(e.seq))),tap((({code:t})=>{if(0!==t)throw this.clearSockets(),this.logError("Connected to gateway success but the Rtm server rejected login"),new RtmUnavailableError(["Login failure. The response code from the RTM service is %d",t],LOGIN_ERR_REJECTED);this.log("ENV_%d logged in",e.env)})),mapTo(e),timeout(LOGIN_RESP_TIMEOUT))).pipe(filter((e=>void 0!==e)),catchError((e=>(e instanceof TimeoutError&&this.warn("Login response timeout, rejoin: %s",t),throwError(e)))))}getSocketLoginObservables(e,t){return e.map((e=>e.pipe(tap((e=>{0===e.listenerCount("socketUserDrop")&&e.on("socketUserDrop",(t=>this.onUserDrop(t,e)))})),switchMap(((e,r)=>(this.incSeqIfNeeded(e.env),this.requestSocketLogin(e,0!==r,0===r?t:this.seq)))),share())))}incSeqIfNeeded(e){if(![0,1].includes(e))throw new CommonError({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[e]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[e]=!0}incGetSeq(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}getLoginSockets(){return compact_1(this.curLoginSockets)}emitMessage(e,t){const{options:r,payload:n,src:o,dst:a,instance:c,dialogue:l,sequence:u,ms:_}=e;this.dialogueSequenceLru.set(l.toString(),u);const p=`${c}-${l}#${u}`;if(this.msgDedupLru.has(p))return void this.warn("Env_%d: Messages out-of-order or not start with 1: %s",t,p);this.msgDedupLru.set(p,void 0);const f=new MessageOption(r);this.getLoginSockets().forEach((t=>{Session$2.sendMessageAck(e,t)}));const E=f.isZlibCompressed();if(f.isInvitation()){const e=E?inflate$3(n,{to:"string"}):decodeUint8ArrayToString(n),t=JSON.parse(e);this.log("The received invitation body is %o",t),this.emit("invitationMessage",{body:t,type:f.getInvitationType(),peerId:o,serverReceivedTs:_.toNumber()})}else if(f.isTextMessage()){const e=f.isPeerTextMessage(),t=E?inflate$3(n,{to:"string"}):decodeUint8ArrayToString(n);if(this.info("Received a%s %s text message from %s to %s, %s",E?" compressed":"",e?"peer":"channel",o,a,p),e){const e={text:t,peerId:o,properties:{serverReceivedTs:_.toNumber(),isOfflineMessage:f.isFromCache(),isHistoricalMessage:f.isFromArchive()}};this.emit("peerTextMessage",e)}else this.emit("channelTextMessage",{channelId:a,memberId:o,text:t,properties:{serverReceivedTs:_.toNumber(),isOfflineMessage:!1,isHistoricalMessage:f.isFromArchive()}})}}onSocketReconnect(e){return()=>{const t=[0,1].filter((t=>t!==e.env))[0],r=this.connection.curOpenSockets[t];r&&!r.loggedIn&&this.emit("connectionLost")}}onUserDrop({code:e},t){if(sendReport("KickedOff",{code:0,elapse:getElapse(this.startTime),linkId:parseInt(t.name.split("-")[1],10),lts:long_1.fromNumber(Date.now()),server:t.address,serverCode:e,sid:getSid(this.instanceId),userId:this.context.uid}),10006===e||10001===e)return void this.warn("Login too often and kicked off, reconnect and login");if(10009===e)return this.warn("The instance ID conflicts, reconnecting"),this.instanceId=getRandomUInt64(),this.context.sid=getSid(this.instanceId),void this.emit("instanceChanged",this.instanceId);[11,14,15,16].includes(e)&&(this.emit("userDrop",e),this.clearSockets())}clearSockets(e=0,t=!1){[0,1].forEach((r=>{this.cleanLoginSubs(r,t),this.connection.lastOpenSockets[r].complete(),this.connection.closeSocket(r,e)}))}onMessage(e){return t=>{const{dialogue:r,instance:n,sequence:o,options:a,src:c}=t;if(c===this.context.uid)return void this.log("The message is from the local account, ignored");const l=r.toString(),u=this.dialPendingMsgSubjectMaps[e.env].get(l),_=`${n}-${r}#${o}`;if(u)return u.next(t),void this.log("Env_%d: The dialogue has pending messages, next: %s",e.env,_);const p=this.dialogueSequenceLru.get(l),f=!p&&o.eq(1),E=void 0!==p&&o.sub(p).eq(1);if(f||E)return void this.emitMessage(t,e.env);if(p){if(o.lte(p))return;this.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",e.env,_)}else this.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",e.env,_);const g=new Subject;this.dialPendingMsgSubjectMaps[e.env].set(l,g);const b=g.pipe(observeOn(asyncScheduler),scan(((e,t)=>[...e,t]),[]),map$1((e=>e.sort((({sequence:e},{sequence:t})=>e.eq(t)?0:e.gt(t)?1:-1)))),shareReplay(1)),v=new MessageOption(a),T=!v.isFromCache()&&!v.isBufferedMessage();b.pipe(takeUntil(timer(T?ONLINE_MESSAGE_DEDUP_DELAY:OFFLINE_MESSAGE_DEDUP_DELAY)),first((e=>{if(e.length<2)return!1;for(let t=void 0===p?long_1.fromNumber(1,!0):p.add(1),r=0;r<e.length;t=t.add(1),r++){if(!e[r].sequence.eq(t))return!1}return!0})),finalize((()=>{this.dialPendingMsgSubjectMaps[e.env].delete(l)}))).subscribe((t=>{t.forEach((t=>{this.emitMessage(t,e.env),this.log("Env_%d: The message queue has fully ordered, emitting: %s",e.env,`${t.instance}-${t.dialogue}#${t.sequence}`)}))}),(t=>{t instanceof EmptyError&&b.pipe(first()).subscribe((t=>t.forEach((t=>{this.log("Env_%d: The message pending queue expired, emitting: %s",e.env,`${t.instance}-${t.dialogue}#${t.sequence}`),this.emitMessage(t,e.env)}))))})),g.next(t)}}onGroupEnterNotice(){return({group:e,instance:t,seq:r,user:n,size:o})=>{this.emit("memberNotice",{channelId:e,seq:r,instance:t,memberId:n,type:"MemberJoined",size:o})}}onGroupLeaveNotice(){return({group:e,instance:t,seq:r,user:n,size:o})=>{this.emit("memberNotice",{channelId:e,seq:r,instance:t,memberId:n,type:"MemberLeft",size:o})}}onGroupAttributeAlt(){return({group:e,...t})=>{this.emit("channelAttributesUpdated",{channelId:e,...t})}}}function genGetSession(e){return()=>{const t=e();if(!t)throw new RtmInvalidStatusError("Client is not logged in. Cannot do the operation");return t}}Session$2.genTimeoutError=(e,t)=>of(void 0).pipe(delay(void 0===t?COMMON_REQUEST_TIMEOUT:t),map$1((()=>{throw new RtmTimeoutError(["Request timed out after %ds",void 0===t?COMMON_REQUEST_TIMEOUT:t],e)})));class InvitationManager extends(createEventBase()){constructor(e,t){super(t,"InvitationManager"),this.logger=t,this.getSession=void 0,this.invitationDispatcher=new events.EventEmitter,this.outgoingLocalInvitations=new Map,this.receivedRemoteInvitations=new LRUCache(void 0,{maxlen:LRU_MAX_ITEMS}),this.getSession=genGetSession(e),this.invitationDispatcher.on("remoteInvitationToManager",(({callId:e,extra:r,callerId:n,channelId:o})=>{if(this.receivedRemoteInvitations.has(e))return;const a=new RtmRemoteInvitation({callerId:n,callId:e,getSession:this.getSession,logger:t,extraContent:r,invitationChannel:o});a.remoteInvitationEnd$.subscribe((()=>{this.receivedRemoteInvitations.delete(e)})),this.receivedRemoteInvitations.set(e,a),this.emit("remoteInvitationInstance",a)})),this.invitationDispatcher.on("acceptAckToRemoteInvitation",(({callId:e})=>{const t=this.receivedRemoteInvitations.get(e);t&&t.onAcceptAckReceived()})),this.invitationDispatcher.on("cancelToRemoteInvitation",(({callId:e,extra:t})=>{const r=this.receivedRemoteInvitations.get(e);r&&r.onCancelReceived(t)})),this.invitationDispatcher.on("acceptToLocalInvitation",(({callId:e,extra:t})=>{const r=this.outgoingLocalInvitations.get(e);r&&r.onAcceptReceived(t)})),this.invitationDispatcher.on("refuseToLocalInvitation",(({callId:e,extra:t})=>{const r=this.outgoingLocalInvitations.get(e);r&&r.onRefuseReceived(t)}))}invitationMessageHandler({body:{callId:e,extra:t="",type:r,channel:n=""},type:o,peerId:a,serverReceivedTs:c}){switch(o){case"CallAccept":return void("ack"===r?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:e}):"request"===r&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:e,extra:t}));case"CallInvite":return void this.invitationDispatcher.emit("remoteInvitationToManager",{callId:e,callerId:a,extra:t,channelId:n});case"CallCancel":if("0"===e){const e=`${END_CALL_PREFIX}_${n}_${t}`;return void this.getSession().emit("peerTextMessage",{peerId:a,properties:{serverReceivedTs:c,isOfflineMessage:!1,isHistoricalMessage:!1},text:e})}return void this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:e,extra:t});case"CallReject":return void this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:e,extra:t});default:throw assertNever("invitationType",o)}}genLocalInvitation(e){const t=new RtmLocalInvitation(e,this.getSession,this.logger);return t.localInvitationEnd$.subscribe((()=>{this.outgoingLocalInvitations.delete(t.callId)})),this.outgoingLocalInvitations.set(t.callId,t),t}}var _class$1,_temp$1;const MemberJoinState={JOINED:0,LEFT:1},{ConnectionState}=RtmStatusCode$1;let Channel=(_temp$1=class Channel extends(createEventBase()){constructor(e,t,r,n){super(n,"RtmChannel",!0),this.channelId=e,this.client=r,this.getSession=void 0,this.memberJoinedLru=new LRUCache(void 0,{maxlen:LRU_MAX_ITEMS}),this.memberLeftLru=new LRUCache(void 0,{maxlen:LRU_MAX_ITEMS}),this.memberJoinStateLru=new LRUCache(void 0,{maxlen:LRU_MAX_ITEMS}),this.attributesSeqLru=new LRUCache(void 0,{maxlen:LRU_MAX_ITEMS}),this.onChannelTextMessage=({memberId:e,text:t,channelId:r,properties:n})=>{r===this.channelId&&this.emit("ChannelMessage",{text:t,messageType:RtmStatusCode$1.MessageType.TEXT},e,n)},this.onAttributesUpdated=({channelId:e,attributeMaps:t,instance:r,seq:n})=>{const o=r.toString(),a=this.attributesSeqLru.get(o);if((!a||n.greaterThan(a))&&(this.attributesSeqLru.set(o,n),e===this.channelId)){const e={};for(const{key:r,ms:n,value:o,origin:a}of t){if("string"!=typeof r||!long_1.isLong(n)||"string"!=typeof o||!isValidId(a))break;e[r]={value:o,lastUpdateUserId:a,lastUpdateTs:n.toNumber()}}this.emit("AttributesUpdated",e)}},this.onMemberNotice=({channelId:e,instance:t,memberId:r,seq:n,type:o})=>{if(e!==this.channelId)return;const a=t.toString(),c=n.toString(),l={MemberLeft:this.memberLeftLru,MemberJoined:this.memberJoinedLru,MemberCountUpdated:void 0}[o];if(l){if(l.has(a+c))return void this.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",o,c,this.channelId,r);if(l.set(a+c,void 0),"string"!=typeof r)return;if(r!==this.getSession().context.uid){const e=this.memberJoinStateLru.get(r);if(e===MemberJoinState.JOINED&&"MemberJoined"===o)return void this.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",o,c,this.channelId,r);if(e===MemberJoinState.LEFT&&"MemberLeft"===o)return void this.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",o,c,this.channelId,r)}this.memberJoinStateLru.set(r,"MemberJoined"===o?MemberJoinState.JOINED:MemberJoinState.LEFT)}this.info("Channel %s - %s, memberId: %s",o,this.channelId,"MemberCountUpdated"===o?"[unknown]":r);const u=r===this.getSession().context.uid;("MemberLeft"===o&&isValidId(r)||"MemberJoined"===o&&isValidId(r))&&(u||this.emit(o,r))},this.getSession=genGetSession(t),this.info("A channel created, id %s",e)}join(){if(!isValidId(this.channelId))throw new RtmInvalidArgumentError([invalidArgumentMessage,"channelId"],JOIN_CHANNEL_ERR_INVALID_ARGUMENT);try{var e=this.getSession()}catch{throw new RtmInvalidStatusError("The client is not logged in. Cannot do the operation",JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN)}if(e.joinedChannels.has(this))throw sendReport("ChnJoin",{cname:this.channelId,lts:long_1.fromNumber(Date.now()),userId:e.context.uid,elapse:getElapse(e.startTime),errCode:JOIN_CHANNEL_ERR_ALREADY_JOINED,sid:getSid(e.instanceId)}),new RtmInvalidStatusError("The channel has joined. Cannot rejoin",JOIN_CHANNEL_ERR_ALREADY_JOINED);try{if(this.log("Joining the channel %s",this.channelId),this.hasOtherChannelJoined())throw sendReport("ChnJoin",{cname:this.channelId,lts:long_1.fromNumber(Date.now()),userId:e.context.uid,elapse:getElapse(e.startTime),errCode:JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,sid:getSid(e.instanceId)}),new RtmInvalidStatusError("A channel of the same channel ID has already joined. Cannot rejoin",JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID);if(e.joinedChannels.size===MAX_JOINED_CHANNELS)throw sendReport("ChnJoin",{cname:this.channelId,lts:long_1.fromNumber(Date.now()),userId:e.context.uid,elapse:getElapse(e.startTime),errCode:JOIN_CHANNEL_ERR_EXCEED_LIMIT,sid:getSid(e.instanceId)}),new RtmLimitExceededError("The joined channels has exceeded the limit of 20",JOIN_CHANNEL_ERR_EXCEED_LIMIT);return sendReport("ChnJoin",{cname:this.channelId,lts:long_1.fromNumber(Date.now()),userId:e.context.uid,elapse:getElapse(e.startTime),errCode:0,sid:getSid(e.instanceId)}),e.requestChannelJoin(this,this.channelId).then((()=>{this.info("The channel %s joined successfully",this.channelId),e.on("channelTextMessage",this.onChannelTextMessage),e.on("memberNotice",this.onMemberNotice),e.on("channelAttributesUpdated",this.onAttributesUpdated)}))}catch(t){if(this.logError(t),isRtmError(t))throw t;if(isTimeout(t))throw sendReport("ChnJoinRes",{cname:this.channelId,lts:long_1.fromNumber(Date.now()),elapse:getElapse(e.startTime),errCode:JOIN_CHANNEL_TIMEOUT,sid:getSid(e.instanceId),serverErrCode:0,userId:e.context.uid}),new RtmTimeoutError(["Join channel %s timed out",this.channelId],JOIN_CHANNEL_TIMEOUT);throw new RtmUnknownError(["The channel %s join failure",this.channelId],{code:JOIN_CHANNEL_ERR_FAILURE,originalError:t})}}async leave(){try{var e=this.getSession()}catch{throw new RtmInvalidStatusError("The client is not logged in. Cannot do the operation",LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN)}if(!e.joinedChannels.has(this))throw new RtmInvalidStatusError("The channel does not join. Cannot do the operation",LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL);try{e.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.memberJoinStateLru.empty(),e.removeListener("channelTextMessage",this.onChannelTextMessage),e.removeListener("memberNotice",this.onMemberNotice),e.removeListener("channelAttributesUpdated",this.onAttributesUpdated)}catch(t){if(this.logError(t),isRtmError(t))throw void 0===t.code&&(t.code=LEAVE_CHANNEL_ERR_REJECTED),sendReport("ChnLeave",{cname:this.channelId,lts:long_1.fromNumber(Date.now()),elapse:getElapse(e.startTime),errCode:LEAVE_CHANNEL_ERR_REJECTED,sid:getSid(e.instanceId),userId:e.context.uid}),t;throw sendReport("ChnLeave",{cname:this.channelId,lts:long_1.fromNumber(Date.now()),elapse:getElapse(e.startTime),errCode:LEAVE_CHANNEL_ERR_FAILURE,sid:getSid(e.instanceId),userId:e.context.uid}),new RtmUnknownError("The channel leave failure",{code:LEAVE_CHANNEL_ERR_FAILURE,originalError:t})}sendReport("ChnLeave",{cname:this.channelId,lts:long_1.fromNumber(Date.now()),elapse:getElapse(e.startTime),errCode:0,sid:getSid(e.instanceId),userId:e.context.uid})}sendMessage(e,{enableHistoricalMessaging:t=!1}={}){validMessage(e,CHANNEL_MESSAGE_ERR_INVALID_MESSAGE);try{var r=this.getSession()}catch{throw new RtmInvalidStatusError("The client is not logged in. Cannot do the operation",CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN)}if(!r.joinedChannels.has(this))throw new RtmInvalidStatusError("The channel does not join. Cannot do the operation",CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN);if(this.client.connectionState===ConnectionState.RECONNECTING){const r=Date.now();return new Promise(((n,o)=>{let a;const c=()=>{const c=Date.now()-r;try{n(commonSendMessage({message:e,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,TOO_OFTEN:CHANNEL_MESSAGE_ERR_TOO_OFTEN},diff:c,options:{enableHistoricalMessaging:t,enableOfflineMessaging:!1}}).then((()=>{})))}catch(e){isTimeout(e)&&o(new RtmTimeoutError(genTimeoutMessage(this.name,"sendMessageToPeer",MESSAGE_SEND_TIMEOUT),CHANNEL_MESSAGE_ERR_TIMEOUT)),isRtmError(e)&&o(e),o(new RtmUnavailableError("Channel message send failure",{code:CHANNEL_MESSAGE_ERR_FAILURE,originalError:e}))}finally{clearTimeout(a)}};this.client.internalEmitter.once("RECONNECTED",c),a=setTimeout((()=>{this.client.internalEmitter.off("RECONNECTED",c),o(new RtmTimeoutError(genTimeoutMessage(this.name,"sendMessageToPeer",MESSAGE_SEND_TIMEOUT),CHANNEL_MESSAGE_ERR_TIMEOUT))}),9e3)}))}if(this.client.connectionState!==ConnectionState.CONNECTED)throw new RtmInvalidStatusError("The client is not logged in. Cannot do the operation",CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN);try{return commonSendMessage({message:e,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,TOO_OFTEN:CHANNEL_MESSAGE_ERR_TOO_OFTEN},diff:0,options:{enableHistoricalMessaging:t,enableOfflineMessaging:!1}}).then((()=>{}))}catch(e){if(isTimeout(e))throw new RtmTimeoutError(genTimeoutMessage(this.name,"sendMessage",MESSAGE_SEND_TIMEOUT),CHANNEL_MESSAGE_ERR_TIMEOUT);if(isRtmError(e))throw this.logError(e),e;throw new RtmUnknownError("The channel message send failure",CHANNEL_MESSAGE_ERR_FAILURE)}}getMembers(){try{try{var e=this.getSession()}catch{throw new RtmInvalidStatusError("The client is not logged in. Cannot do the operation",GET_MEMBERS_ERR_USER_NOT_LOGGED_IN)}if(!e.joinedChannels.has(this))throw new RtmInvalidStatusError("The channel does not join. Cannot do the operation",GET_MEMBERS_ERR_NOT_IN_CHANNEL);return this.getSession().requestChannelMemberList(this.channelId).pipe(map$1((({memberInfos:e})=>e.map((({account:e})=>e))))).toPromise().then((e=>(this.info("Channel %s - get members success, %o",this.channelId,e),e)))}catch(e){if(isRtmError(e))throw this.logError(e),e;throw new RtmUnknownError("The channel members get failure",GET_MEMBERS_ERR_FAILURE)}}hasOtherChannelJoined(){return!this.getSession().joinedChannels.has(this)&&[...this.getSession().joinedChannels].some((e=>e.channelId===this.channelId))}},_class$1=_temp$1,_applyDecoratedDescriptor(_class$1.prototype,"join",[logged],Object.getOwnPropertyDescriptor(_class$1.prototype,"join"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"leave",[logged],Object.getOwnPropertyDescriptor(_class$1.prototype,"leave"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"sendMessage",[logged],Object.getOwnPropertyDescriptor(_class$1.prototype,"sendMessage"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"getMembers",[logged],Object.getOwnPropertyDescriptor(_class$1.prototype,"getMembers"),_class$1.prototype),_class$1);var _class$2,_temp$2;const{ConnectionChangeReason,ConnectionState:ConnectionState$1}=RtmStatusCode$1,connectionStateCodeMap={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},connectionStateChangeReason={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8};let Client=(_temp$2=class Client extends(createEventBase()){constructor(e,t,r,n){super(t,"RtmClient",!0),this.parameters=r,this.setParameters=n,this.connectionState=ConnectionState$1.DISCONNECTED,this.internalEmitter=new events.EventEmitter,this.context=void 0,this.invitationManager=new InvitationManager((()=>this.session),this.logger),this.reconnId=0,this.channelAttributesCacheLru=new LRUCache(void 0,{maxlen:CHANNEL_ATTRIBUTES_CACHE_MAX_LENGTH}),this.loginPromise=void 0,this.session=void 0,this.lastLoginTime=void 0,this.userDropHandler=e=>{if(this.connectionState!==ConnectionState$1.ABORTED)switch(e){case 11:return this.logError("Kicked off by remote session"),void this.onConnectionStateChanged(ConnectionState$1.ABORTED,ConnectionChangeReason.REMOTE_LOGIN);case 14:case 15:case 16:{const t={14:"User ID",15:"IP",16:"Channel Name"};return this.logError(`Server banned because of illegal ${t[e]}`),void this.onConnectionStateChanged(ConnectionState$1.ABORTED,ConnectionChangeReason.BANNED_BY_SERVER)}default:this.logError(`User kicked off for unknown code: ${e}`),this.onConnectionStateChanged(ConnectionState$1.ABORTED,ConnectionChangeReason.INTERRUPTED)}},this.context=new Context(e,t),this.invitationManager.on("remoteInvitationInstance",(e=>{this.emit("RemoteInvitationReceived",e)}))}async renewToken(e){if("string"!=typeof e||0===e.length)throw new RtmInvalidArgumentError("Invalid argument",RENEW_TOKEN_ERR_INVALID_ARGUMENT);if("string"==typeof e&&(e.length<APP_ID_LENGTH||e.slice(3,APP_ID_LENGTH+3)!==this.context.appId))throw new RtmInvalidArgumentError("Invalid token",RENEW_TOKEN_ERR_INVALID_TOKEN);if(this.connectionState===ConnectionState$1.ABORTED&&await new Promise((()=>{})),this.connectionState!==ConnectionState$1.CONNECTED&&this.connectionState!==ConnectionState$1.RECONNECTING)throw new RtmInvalidStatusError("The client is not logged in",RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN);if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});try{var t=this.context.token;this.context.token=e;var{ticket:r}=await this.session.connection.apClient.apEdgeInfo$.pipe(throwIfEmpty((()=>new Error("No available edge address to connect"))),retryWhen((e=>e.pipe(tap((e=>{if(isRtmError(e))throw e})),delay(2e3),take(4)))),first(),timeout(1e4),catchError((e=>(isTimeout(e)&&this.warn("renewToken timed out"),throwError(e))))).toPromise()}catch(e){if(this.context.token=t,e.code===LOGIN_ERR_INVALID_APP_ID||e.code===LOGIN_ERR_INVALID_TOKEN)throw new RtmUnauthenticatedError("Invalid token",RENEW_TOKEN_ERR_INVALID_TOKEN);if(e.code===LOGIN_ERR_TOKEN_EXPIRED)throw new RtmUnauthenticatedError("The token expired",RENEW_TOKEN_ERR_TOKEN_EXPIRED);if(isTimeout(e))throw new RtmTimeoutError("Renew token timed out",RENEW_TOKEN_ERR_FAILURE)}this.session.curLoginSockets.filter((e=>void 0!==e)).forEach((e=>e.ticket=r))}async login(e){const t=getRandomUInt64();let{token:r}=e;if(e.token===this.context.appId&&(r=void 0),wx.getSystemInfo({success:n=>{sendReport("Session",{appId:this.context.appId,did:`${n.platform}-${n.model}-${n.version}`,elapse:getElapse(this.session&&this.session.startTime),index:{index1:e.uid,index2:this.context.appId,index3:`enableLogUpload=${this.parameters.enableLogUpload}`},installId:processId,lts:long_1.fromNumber(Date.now()),os:PLATFORM_TYPE,sid:getSid(t),token:r||"",userId:e.uid,ver:version,buildno:100*VERSION_NO+SUBVERSION,subVersion:SUBVERSION,version:VERSION_NO})}}),!isPlainObject(e)||!isValidId(e.uid))throw new RtmInvalidArgumentError("not a valid user id",LOGIN_ERR_INVALID_ARGUMENT);if("string"==typeof r&&r){if(r.length<APP_ID_LENGTH+3||r.slice(3,APP_ID_LENGTH+3)!==this.context.appId)throw new RtmInvalidArgumentError("Invalid token",LOGIN_ERR_INVALID_TOKEN);this.context.token=r}else if("string"!=typeof r&&!isNil_1(r))throw new RtmInvalidArgumentError('The "token" is not a valid string.',LOGIN_ERR_INVALID_ARGUMENT);const n=Date.now();this.context.sid=getSid(t),this.loginPromise=this.loginImpl({uid:e.uid,instanceId:t}),this.info(`RTM Client logging in as ${e.uid}`);try{await this.loginPromise}catch(r){throw isRtmError(r)&&sendReport("Link",{ackedServerIp:"",destServerIp:"",ec:r.code||1,sc:r.serverCode,elapse:getElapse(this.session&&this.session.startTime),lts:long_1.fromNumber(Date.now()),responseTime:Date.now()-n,sid:getSid(t),userId:e.uid}),this.context.token=void 0,r}finally{this.loginPromise=void 0}}async logout(){if(this.loginPromise&&await this.loginPromise,this.connectionState===ConnectionState$1.DISCONNECTED)throw this.logError("Already in logout state"),new RtmInvalidStatusError("Logout failure. The client has already been logged out",LOGOUT_ERR_USER_NOT_LOGGED_IN);if(this.connectionState===ConnectionState$1.ABORTED)return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),void this.onConnectionStateChanged(ConnectionState$1.DISCONNECTED,ConnectionChangeReason.LOGOUT);void 0!==this.session?(sendReport("Logout",{elapse:getElapse(this.session.startTime),lts:long_1.fromNumber(Date.now()),sid:getSid(this.session.instanceId),userId:this.context.uid}),await this.session.logoutHandler(),this.onConnectionStateChanged(ConnectionState$1.DISCONNECTED,ConnectionChangeReason.LOGOUT),this.log("Log out success")):this.onConnectionStateChanged(ConnectionState$1.DISCONNECTED,ConnectionChangeReason.LOGOUT)}async sendMessageToPeer(e,t,{enableOfflineMessaging:r=!1,enableHistoricalMessaging:n=!1}={}){if(validMessage(e,PEER_MESSAGE_ERR_INVALID_MESSAGE),this.connectionState===ConnectionState$1.RECONNECTING){const o=Date.now();return new Promise(((a,c)=>{let l;const u=async()=>{if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});const u=Date.now()-o;try{a(await commonSendMessage({message:e,peerId:t,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,TOO_OFTEN:PEER_MESSAGE_ERR_TOO_OFTEN},diff:u,options:{enableHistoricalMessaging:n,enableOfflineMessaging:r}}))}catch(e){isTimeout(e)&&c(new RtmTimeoutError(genTimeoutMessage(this.name,"sendMessageToPeer",MESSAGE_SEND_TIMEOUT),PEER_MESSAGE_ERR_TIMEOUT)),isRtmError(e)&&c(e),c(new RtmUnavailableError("Peer-to-peer message send failure",{code:PEER_MESSAGE_ERR_FAILURE,originalError:e}))}finally{clearTimeout(l)}};this.internalEmitter.once("RECONNECTED",u),l=setTimeout((()=>{this.internalEmitter.off("RECONNECTED",u),c(new RtmTimeoutError(genTimeoutMessage(this.name,"sendMessageToPeer",MESSAGE_SEND_TIMEOUT),PEER_MESSAGE_ERR_TIMEOUT))}),9e3)}))}if(this.connectionState!==ConnectionState$1.CONNECTED)throw new RtmInvalidStatusError("Failed to send the peer-to-peer message. The client is not logged in",PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN);if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});try{return await commonSendMessage({message:e,peerId:t,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,TOO_OFTEN:PEER_MESSAGE_ERR_TOO_OFTEN},diff:0,options:{enableHistoricalMessaging:n,enableOfflineMessaging:r}})}catch(e){if(isTimeout(e))throw new RtmTimeoutError(genTimeoutMessage(this.name,"sendMessageToPeer",MESSAGE_SEND_TIMEOUT),PEER_MESSAGE_ERR_TIMEOUT);if(isRtmError(e))throw e;throw new RtmUnavailableError("Peer-to-peer message send failure",{code:PEER_MESSAGE_ERR_FAILURE,originalError:e})}}createChannel(e){if(!isValidId(e))throw new RtmInvalidArgumentError([invalidArgumentMessage,getName({channelId:e})],CREATE_CHANNEL_ERR_INVALID_ARGUMENT);return new Channel(e,(()=>this.session),this,this.logger)}async setChannelAttributes(e,t,{enableNotificationToChannelMembers:r=!1}={}){if(validAttributes({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState!==ConnectionState$1.CONNECTED)throw new RtmInvalidStatusError("The client is not logged in",ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN);if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});const n=this.session.requestSetChannelAttributes(e,t,r).toPromise();try{await n;const r=mapValues_1(t,(e=>getUtf8StringSize(e)));this.channelAttributesCacheLru.set(e,r)}catch(e){if(isRtmError(e))throw e;throw new RtmInvalidArgumentError("arguments is not valid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT)}}async addOrUpdateChannelAttributes(e,t,{enableNotificationToChannelMembers:r=!1}={}){const n={...this.channelAttributesCacheLru.get(e,{}),...mapValues_1(t,(e=>getUtf8StringSize(e)))};if(validAttributes({attributes:t,attrSizeMap:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState!==ConnectionState$1.CONNECTED)throw new RtmInvalidStatusError("The client is not logged in",ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN);if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});const o=this.session.requestAddOrUpdateChannelAttributes(e,t,r).toPromise();try{await o,this.channelAttributesCacheLru.set(e,n)}catch(e){if(isRtmError(e))throw e;throw new RtmInvalidArgumentError("arguments is not valid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT)}}async deleteChannelAttributesByKeys(e,t,{enableNotificationToChannelMembers:r=!1}={}){if(!Array.isArray(t)||0===t.length||!isValidId(e)||t.some((e=>0===e.length||e.length>CHANNEL_ATTRIBUTES_MAX_KEY_COUNT)))throw new RtmInvalidStatusError("arguments is not valid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT);if(this.connectionState!==ConnectionState$1.CONNECTED)throw new RtmInvalidStatusError("The client is not logged in",ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN);if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});const n=this.session.requestDeleteChannelAttributesByKeys(e,t,r).toPromise();try{await n;const r=this.channelAttributesCacheLru.get(e);if(r)for(const e of t)delete r[e]}catch(e){if(isRtmError(e))throw e;throw new RtmInvalidArgumentError("arguments is not valid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT)}}async clearChannelAttributes(e,{enableNotificationToChannelMembers:t=!1}={}){if(this.connectionState!==ConnectionState$1.CONNECTED)throw new RtmInvalidStatusError("The client is not logged in",ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN);if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});const r=this.session.requestClearChannelAttributes(e,t).toPromise();try{await r,this.channelAttributesCacheLru.delete(e)}catch(e){if(isRtmError(e))throw e;throw new RtmInvalidArgumentError("arguments is not valid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT)}}async getChannelAttributes(e){if(!isValidId(e))throw new RtmInvalidArgumentError("Not a valid channel ID",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT);if(this.connectionState!==ConnectionState$1.CONNECTED)throw new RtmInvalidStatusError("The client is not logged in",ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN);if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});try{const{keys:r}=await this.session.requestGetChannelAttributesKeys(e).toPromise();var{attributeMaps:t}=await this.session.requestGetChannelAttributesByKeys(e,r).toPromise()}catch(e){if(isRtmError(e))throw e;throw new RtmInvalidArgumentError("arguments is not valid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT)}const r={};for(const{key:e,ms:n,value:o,origin:a}of t){if("string"!=typeof e||!long_1.isLong(n)||"string"!=typeof o||!isValidId(a))break;r[e]={value:o,lastUpdateUserId:a,lastUpdateTs:n.toNumber()}}return this.channelAttributesCacheLru.set(e,mapValues_1(r,(({value:e})=>getUtf8StringSize(e)))),r}async getChannelAttributesByKeys(e,t){if(this.connectionState!==ConnectionState$1.CONNECTED)throw new RtmInvalidStatusError("The client is not logged in",ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN);if(void 0===this.session)throw new CommonError({SESSION_NOT_FOUND:"Failed to get session of the client"});checkValidAttrGetByKeysArgs(e,t);try{var{attributeMaps:r}=await this.session.requestGetChannelAttributesByKeys(e,t).toPromise()}catch(e){if(isRtmError(e))throw e;throw new RtmInvalidArgumentError("arguments is not valid",ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT)}const n={},o=this.channelAttributesCacheLru.get(e,{});for(const{key:e,ms:t,value:a,origin:c}of r){if("string"!=typeof e||!long_1.isLong(t)||"string"!=typeof a||!isValidId(c))break;o[e]=getUtf8StringSize(a),n[e]={value:a,lastUpdateUserId:c,lastUpdateTs:t.toNumber()}}return this.channelAttributesCacheLru.set(e,o),n}createLocalInvitation(e){if(!isValidId(e))throw new RtmInvalidArgumentError([invalidArgumentMessage,getName({calleeId:e})],INVITATION_API_CALL_ERR_INVALID_ARGUMENT);return this.invitationManager.genLocalInvitation(e)}async loginImpl({uid:e,instanceId:t}){let r=t;if(void 0!==this.lastLoginTime&&Date.now()-this.lastLoginTime<1e3/LOGIN_QPS_LIMIT)throw new RtmInvokeTooOftenError(["The frequency of login exceeded the limit of %d queries per second",LOGIN_QPS_LIMIT],LOGIN_ERR_TOO_OFTEN);if(this.connectionState!==ConnectionState$1.DISCONNECTED)throw new RtmInvalidStatusError("The SDK is either logging in or has logged in the Agora RTM system",LOGIN_ERR_ALREADY_LOGIN);try{this.context.uid=e}catch(t){throw new RtmInvalidArgumentError([invalidArgumentMessage,getName({uid:e})],LOGIN_ERR_INVALID_ARGUMENT)}this.onConnectionStateChanged(ConnectionState$1.CONNECTING,ConnectionChangeReason.LOGIN);const n=new Session$2(this.context,new Connection(this.context,this.logger),r,this.logger);this.session=n;n.on("connectionLost",(()=>{this.connectionState===ConnectionState$1.CONNECTED&&(this.onConnectionStateChanged(ConnectionState$1.RECONNECTING,ConnectionChangeReason.INTERRUPTED),this.session&&this.session.once("userJoined",(()=>{this.onConnectionStateChanged(ConnectionState$1.CONNECTED,ConnectionChangeReason.LOGIN_SUCCESS)})))})),n.on("tokenExpired",(()=>{this.emit("TokenExpired")})),n.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(({peerId:e,text:t,properties:r})=>{const n=()=>this.emit("MessageFromPeer",{text:t,messageType:RtmStatusCode$1.MessageType.TEXT},e,r);this.connectionState!==ConnectionState$1.CONNECTED?Promise.resolve().then(n):n()})),n.on("channelAttributesUpdated",(({channelId:e,attributeMaps:t})=>{const r={};for(const{key:e,ms:n,value:o,origin:a}of t){if("string"!=typeof e||!long_1.isLong(n)||"string"!=typeof o||!isValidId(a))break;r[e]=getUtf8StringSize(o)}this.channelAttributesCacheLru.set(e,r)})),n.on("instanceChanged",(e=>r=e)),n.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),this.lastLoginTime=Date.now();try{await n.loginHandler().toPromise()}catch(e){if(isTimeout(e))throw this.onConnectionStateChanged(ConnectionState$1.DISCONNECTED,ConnectionChangeReason.LOGIN_TIMEOUT),new RtmTimeoutError(genTimeoutMessage(this.name,"login",CLIENT_LOGIN_TIMEOUT),LOGIN_ERR_TIMEOUT);if(this.onConnectionStateChanged(ConnectionState$1.DISCONNECTED,ConnectionChangeReason.LOGIN_FAILURE),isRtmError(e))throw e;throw new RtmUnavailableError("Login failure",{code:LOGIN_ERR_UNKNOWN,originalError:e})}this.onConnectionStateChanged(ConnectionState$1.CONNECTED,ConnectionChangeReason.LOGIN_SUCCESS)}onConnectionStateChanged(e,t){e===ConnectionState$1.RECONNECTING&&(this.reconnId+=1),sendReport("ConnectionStateChange",{elapse:getElapse(this.session&&this.session.startTime),lts:long_1.fromNumber(Date.now()),newState:connectionStateCodeMap[e],oldState:connectionStateCodeMap[this.connectionState],reason:connectionStateChangeReason[t],sid:getSid(this.session&&this.session.instanceId||long_1.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId}),this.connectionState===ConnectionState$1.RECONNECTING&&e===ConnectionState$1.CONNECTED&&this.internalEmitter.emit("RECONNECTED"),this.connectionState=e,e!==ConnectionState$1.ABORTED&&e!==ConnectionState$1.DISCONNECTED||(this.reconnId=0,this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty()),this.session=void 0,this.context.token=void 0),this.emit("ConnectionStateChanged",e,t)}},_class$2=_temp$2,_applyDecoratedDescriptor(_class$2.prototype,"renewToken",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"renewToken"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"login",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"login"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"logout",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"logout"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"sendMessageToPeer",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"sendMessageToPeer"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"createChannel",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"createChannel"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"setChannelAttributes",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"setChannelAttributes"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"addOrUpdateChannelAttributes",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"addOrUpdateChannelAttributes"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"deleteChannelAttributesByKeys",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"deleteChannelAttributesByKeys"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"clearChannelAttributes",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"clearChannelAttributes"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"getChannelAttributes",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"getChannelAttributes"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"getChannelAttributesByKeys",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"getChannelAttributesByKeys"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"createLocalInvitation",[logged],Object.getOwnPropertyDescriptor(_class$2.prototype,"createLocalInvitation"),_class$2.prototype),_class$2);const{ConnectionChangeReason:ConnectionChangeReason$1,ConnectionState:ConnectionState$2,MessageType:MessageType$1}=RtmStatusCode$1;void 0===Number.MAX_SAFE_INTEGER&&(Number.MAX_SAFE_INTEGER=9007199254740991);const LogFilter={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}};function createInstance(e,{enableLogUpload:t=!1,logFilter:r=LogFilter.LOG_FILTER_INFO}={}){if(!isValidAppId(e))throw new RtmInvalidArgumentError([invalidArgumentMessage,getName({appId:e})],CREATE_INSTANCE_ERR_INVALID_ARGUMENT);const n={enableLogUpload:t,logFilter:r},o=initLoggerId(),a=genInfoLogger(n),c=genWarnLogger(n),l=genErrorLogger(n),u=trackLoggerGenerator(o,n),_=debugLoggerGenerator(o,n),p=_("RTM:DEBUG","<Entry> ");return a("The Agora RTM Web SDK version is %s",version),p("Creating an RtmClient instance"),p(`The Git commit ID is "${BUILD}"`),p("The App ID is %s",e),a("The process ID is %s",processId),a("The build is %s",BUILD),p("process.env.NODE_ENV is %s","production"),new Client(e,{genLogger:_,genTracker:u,info:a,warn:c,logError:l,loggerId:o},n,(e=>{for(const t of getKeys(e)){const r=e[t];null!=r&&(n[t]=r)}}))}const MUTABLE_PARAMS={DISABLE_MESSAGE_COMPRESSION:!1};function setParameter(e,t){Object.keys(MUTABLE_PARAMS).includes(e)&&(MUTABLE_PARAMS[e]=t)}function getParameter(e){return MUTABLE_PARAMS[e]}var AgoraRTM={createInstance,BUILD,VERSION:version,processId,ConnectionChangeReason:ConnectionChangeReason$1,ConnectionState:ConnectionState$2,MessageType:MessageType$1,setParameter,getParameter,...LogFilter};module.exports=AgoraRTM;
//# sourceMappingURL=bundle.commonjs.js.map
